//>>built
define("dojox/charting/plot2d/Pie","dojo/_base/lang dojo/_base/array dojo/_base/declare ./Base ./_PlotEvents ./common dojox/gfx dojox/gfx/matrix dojox/lang/functional dojox/lang/utils dojo/has".split(" "),function(E,n,F,I,O,P,w,L,k,G,M){return F("dojox.charting.plot2d.Pie",[I,O],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},
filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(h,b){this.opt=E.clone(this.defaultParams);G.updateWithObject(this.opt,b);G.updateWithPattern(this.opt,b,this.optionalParams);this.axes=[];this.run=null;this.dyn=[];this.runFilter=[]},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(h){return this},addSeries:function(h){this.run=h;return this},getSeriesStats:function(){return E.delegate(P.defaultStats)},getRequiredColors:function(){return this.run?
this.run.data.length:0},render:function(h,b){if(!this.dirty)return this;this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var q=this.group,c=this.chart.theme;if(!this.run||!this.run.data.length)return this;var d=(h.width-b.l-b.r)/2,e=(h.height-b.t-b.b)/2,g=Math.min(d,e),y="font"in this.opt?this.opt.font:c.series.font,x,C=L._degToRad(this.opt.startAngle),m=C,l,u,v,D,G=this.events(),z=n.map(this.run.data,function(a,b){"number"!=typeof a&&a.hidden&&(this.runFilter.push(b),a.hidden=
!1);return n.some(this.runFilter,function(a){return a==b})?"number"==typeof a?0:{y:0,text:a.text}:a},this);this.dyn=[];"radius"in this.opt&&(g=this.opt.radius,D=g-this.opt.labelOffset);var a={cx:b.l+d,cy:b.t+e,r:g};if(this.opt.shadow||c.shadow){l=this.opt.shadow||c.shadow;var A=E.clone(a);A.cx+=l.dx;A.cy+=l.dy;q.createCircle(A).setFill(l.color).setStroke(l)}q.setFilter&&(this.opt.filter||c.filter)&&q.createCircle(a).setFill(c.series.stroke).setFilter(this.opt.filter||c.filter);if("number"==typeof z[0]){l=
k.map(z,"x ? Math.max(x, 0) : 0");if(k.every(l,"\x3c\x3d 0"))return q.createCircle(a).setStroke(c.series.stroke),this.dyn=n.map(l,function(){return{}}),this;u=k.map(l,"/this",k.foldl(l,"+",0));this.opt.labels&&(v=n.map(u,function(a){return 0<a?this._getLabel(100*a)+"%":""},this))}else{l=k.map(z,"x ? Math.max(x.y, 0) : 0");if(k.every(l,"\x3c\x3d 0"))return q.createCircle(a).setStroke(c.series.stroke),this.dyn=n.map(l,function(){return{}}),this;u=k.map(l,"/this",k.foldl(l,"+",0));this.opt.labels&&(v=
n.map(u,function(a,b){if(0>a)return"";var c=z[b];return"text"in c?c.text:this._getLabel(100*a)+"%"},this))}var H=k.map(z,function(a,b){var p=[this.opt,this.run];null!==a&&"number"!=typeof a&&p.push(a);this.opt.styleFunc&&p.push(this.opt.styleFunc(a));return c.next("slice",p,!0)},this);this.opt.labels&&(x=y?w.normalizedLength(w.splitFontString(y).size):0,l=k.foldl1(k.map(v,function(a,b){return w._base._getTextBox(a,{font:H[b].series.font}).w},this),"Math.max(a, b)")/2,0>this.opt.labelOffset&&(g=Math.min(d-
2*l,e-x)+this.opt.labelOffset),D=g-this.opt.labelOffset);var J=Array(u.length);n.some(u,function(c,d){if(0>c)return!1;var p=z[d],r=H[d],f;if(0==c)return this.dyn.push({fill:r.series.fill,stroke:r.series.stroke}),!1;if(1<=c){f=this._plotFill(r.series.fill,h,b);f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});f=this._pseudoRadialFill(f,{x:a.cx,y:a.cy},a.r);var e=q.createCircle(a).setFill(f).setStroke(r.series.stroke);this.dyn.push({fill:f,stroke:r.series.stroke});G&&(p={element:"slice",
index:d,run:this.run,shape:e,x:d,y:"number"==typeof p?p:p.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(p),J[d]=p);return!1}var l=m+2*c*Math.PI;d+1==u.length&&(l=C+2*Math.PI);var e=l-m,k=a.cx+g*Math.cos(m),n=a.cy+g*Math.sin(m),y=a.cx+g*Math.cos(l),x=a.cy+g*Math.sin(l);f=L._degToRad(this.opt.fanSize);if(r.series.fill&&"radial"===r.series.fill.type&&"fan"===this.opt.radGrad&&e>f){var v=q.createGroup(),w=Math.ceil(e/f),B=e/w;f=this._shapeFill(r.series.fill,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});
for(var t=0;t<w;++t){var A=0==t?k:a.cx+g*Math.cos(m+(t-.2)*B),D=0==t?n:a.cy+g*Math.sin(m+(t-.2)*B),E=t==w-1?y:a.cx+g*Math.cos(m+(t+1+.2)*B),F=t==w-1?x:a.cy+g*Math.sin(m+(t+1+.2)*B);v.createPath().moveTo(a.cx,a.cy).lineTo(A,D).arcTo(g,g,0,B>Math.PI,!0,E,F).lineTo(a.cx,a.cy).closePath().setFill(this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,m+(t+.5)*B,m+(t+.5)*B))}v.createPath().moveTo(a.cx,a.cy).lineTo(k,n).arcTo(g,g,0,e>Math.PI,!0,y,x).lineTo(a.cx,a.cy).closePath().setStroke(r.series.stroke);e=v}else e=
q.createPath().moveTo(a.cx,a.cy).lineTo(k,n).arcTo(g,g,0,e>Math.PI,!0,y,x).lineTo(a.cx,a.cy).closePath().setStroke(r.series.stroke),(f=r.series.fill)&&"radial"===f.type?(f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}),"linear"===this.opt.radGrad&&(f=this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,m,l))):f&&"linear"===f.type&&(f=this._plotFill(f,h,b),f=this._shapeFill(f,e.getBoundingBox())),e.setFill(f);this.dyn.push({fill:f,stroke:r.series.stroke});G&&(p={element:"slice",index:d,
run:this.run,shape:e,x:d,y:"number"==typeof p?p:p.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(p),J[d]=p);m=l;return!1},this);if(this.opt.labels){var N=M("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)m=C,n.some(u,function(b,c){if(0>=b)return!1;var d=H[c];if(1<=b)return this.renderLabel(q,a.cx,a.cy+x/2,v[c],d,0<this.opt.labelOffset),!0;var e=m+2*b*Math.PI;c+1==u.length&&(e=C+2*Math.PI);if(this.opt.omitLabels&&.001>e-m)return!1;var f=(m+e)/2,g=a.cx+D*Math.cos(f),f=a.cy+D*
Math.sin(f)+x/2;this.renderLabel(q,N?h.width-g:g,f,v[c],d,0<this.opt.labelOffset);m=e;return!1},this);else if("columns"==this.opt.labelStyle){var m=C,F=this.opt.omitLabels,K=[];n.forEach(u,function(a,c){var b=m+2*a*Math.PI;c+1==u.length&&(b=C+2*Math.PI);var d=(m+b)/2;K.push({angle:d,left:0>Math.cos(d),theme:H[c],index:c,omit:F?.001>b-m:!1});m=b});d=w._base._getTextBox("a",{font:y}).h;this._getProperLabelRadius(K,d,1.1*a.r);n.forEach(K,function(b,c){if(!b.omit){var d=a.cx-2*a.r,e=a.cx+2*a.r,f=w._base._getTextBox(v[c],
{font:b.theme.series.font}).w,g=a.cx+b.labelR*Math.cos(b.angle),l=a.cy+b.labelR*Math.sin(b.angle),e=b.left?d+f:e-f,d=b.left?d:e,m=q.createPath().moveTo(a.cx+a.r*Math.cos(b.angle),a.cy+a.r*Math.sin(b.angle));Math.abs(b.labelR*Math.cos(b.angle))<2*a.r-f&&m.lineTo(g,l);m.lineTo(e,l).setStroke(b.theme.series.labelWiring);this.renderLabel(q,N?h.width-f-d:d,l,v[c],b.theme,!1,"left")}},this)}}var I=0;this._eventSeries[this.run.name]=k.map(z,function(a){return 0>=a?null:J[I++]});M("dojo-bidi")&&this._checkOrientation(this.group,
h,b);return this},_getProperLabelRadius:function(h,b,q){var c,d,e=1,g=1;if(1==h.length)h[0].labelR=q;else{for(var k=0;k<h.length;k++){var n=Math.abs(Math.sin(h[k].angle));h[k].left?e>=n&&(e=n,c=h[k]):g>=n&&(g=n,d=h[k])}c.labelR=d.labelR=q;this._calculateLabelR(c,h,b);this._calculateLabelR(d,h,b)}},_calculateLabelR:function(h,b,k){for(var c=h.index,d=b.length,e=h.labelR;!(b[c%d].left^b[(c+1)%d].left);)b[(c+1)%d].omit||(e=(Math.sin(b[c%d].angle)*e+(b[c%d].left?-k:k))/Math.sin(b[(c+1)%d].angle),e=e<
h.labelR?h.labelR:e,b[(c+1)%d].labelR=e),c++;c=h.index;for(d=0==c?d-1:c-1;!(b[c].left^b[d].left);)b[d].omit||(e=(Math.sin(b[c].angle)*e+(b[c].left?k:-k))/Math.sin(b[d].angle),e=e<h.labelR?h.labelR:e,b[d].labelR=e),c--,d--,c=0>c?c+b.length:c,d=0>d?d+b.length:d}})});