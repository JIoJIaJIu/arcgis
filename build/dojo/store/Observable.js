//>>built
define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(a,n,p,u){a=function(b){function a(q,f){var c=b[q];c&&(b[q]=function(d){var g;"put"===q&&(g=b.getIdentity(d));if(r)return c.apply(this,arguments);r=!0;try{var a=c.apply(this,arguments);p(a,function(b){f("object"==typeof b&&b||d,g)});return a}finally{r=!1}})}var l=[],v=0;b=n.delegate(b);b.notify=function(b,f){v++;for(var c=l.slice(),a=0,g=c.length;a<g;a++)c[a](b,f)};var x=b.query;b.query=function(a,
f){f=f||{};var c=x.apply(this,arguments);if(c&&c.forEach){var d=n.mixin({},f);delete d.start;delete d.count;var g=b.queryEngine&&b.queryEngine(a,d),r=v,t=[],w;c.observe=function(a,q){1==t.push(a)&&l.push(w=function(a,d){p(c,function(e){var c=e.length!=f.count,h,l;if(++r!=v)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var n,m=-1,k=-1;if(void 0!==d)for(h=0,l=e.length;h<l;h++){var p=e[h];if(b.getIdentity(p)==d){n=p;m=h;!g&&a||e.splice(h,1);break}}g?
a&&(g.matches?g.matches(a):g([a]).length)&&(h=-1<m?m:e.length,e.splice(h,0,a),k=u.indexOf(g(e),a),e.splice(h,1),f.start&&0==k||!c&&k==e.length?k=-1:e.splice(k,0,a)):a&&(void 0!==d?k=m:f.start||(k=b.defaultIndex||0,e.splice(k,0,a)));if((-1<m||-1<k)&&(q||!g||m!=k))for(c=t.slice(),h=0;e=c[h];h++)e(a||n,m,k)})});var d={};d.remove=d.cancel=function(){var b=u.indexOf(t,a);-1<b&&(t.splice(b,1),t.length||l.splice(u.indexOf(l,w),1))};return d}}return c};var r;a("put",function(a,f){b.notify(a,f)});a("add",
function(a){b.notify(a)});a("remove",function(a){b.notify(void 0,a)});return b};n.setObject("dojo.store.Observable",a);return a});