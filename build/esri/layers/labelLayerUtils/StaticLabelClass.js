//>>built
define("esri/layers/labelLayerUtils/StaticLabelClass","dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../GraphicsLayer ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(C,F,G,H,D,A,E,B){return C(D,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=
1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,c,f,d,h,l,e,g,n;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];h=a.labelWidth;l=a.labelHeight;g=(e=a.options)&&e.lineLabelPlacement?e.lineLabelPlacement:"PlaceAtCenter";
n=e&&e.lineLabelPosition?e.lineLabelPosition:"Above";c=e&&e.labelRotation?e.labelRotation:!0;f=Math.PI/180*a.angle;d=e&&e.howManyLabels?e.howManyLabels:"OneLabel";var k=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,f,h,l,a.symbolWidth,a.symbolHeight,e,k);else if("multipoint"===a.geometry.type)for(c=0;c<a.geometry.points.length;c++)this._generatePointPositions(a.geometry.points[c][0],a.geometry.points[c][1],a.text,f,h,l,a.symbolWidth,a.symbolHeight,e,
k);else if("polyline"===a.geometry.type)if("PlaceAtStart"===g)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,h,l,2*a.symbolHeight+l,g,n,c,k);else if("PlaceAtEnd"===g)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,h,l,2*a.symbolHeight+l,g,n,c,k);else{e=[];var m=a.geometry.getExtent(),p=this._map.extent;if(m.getWidth()<h*this._scale/this._OVERRUN&&m.getHeight()<h*this._scale/this._OVERRUN)continue;.5*m.getWidth()<p.getWidth()&&.5*m.getHeight()<p.getHeight()?(p=.1*Math.min(this._map.width,
this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(a.geometry,!1,p,a.text,h,l,2*a.symbolHeight+l,g,n,c,e)):(p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(a.geometry,!0,p,a.text,h,l,2*a.symbolHeight+l,g,n,c,e));this._postSorting(m,e,k)}else if("polygon"===a.geometry.type)for(c=0;c<a.geometry.rings.length;c++)g=a.geometry.rings[c],B.prototype.isClockwise(g)&&(n=this._calcRingExtent(g),n.xmax-n.xmin<4*h*this._scale/
this._OVERRUN&&n.ymax-n.ymin<4*l*this._scale/this._OVERRUN||this._generatePolygonPositionsForManyLabels(g,a.geometry.spatialReference,a.text,f,h,l,k));for(c=0;c<k.length&&(g=k[c].x,n=k[c].y,void 0!==k[c].angle&&(f=k[c].angle),e=this._findPlace(a,a.text,g,n,f,h,l),"OneLabel"!==d||!e||!this._labelLayer._isWithinScreenArea(new E(g,n,a.geometry.spatialReference)));c++);}return this._placedLabels},_generatePointPositions:function(b,a,c,f,d,h,l,e,g,n){var k;switch(k=g&&g.pointPriorities?g.pointPriorities:
"AboveRight",c=(l+d)*this._scale,h=(e+h)*this._scale,k.toLowerCase()){case "aboveleft":b-=c;a+=h;break;case "abovecenter":a+=h;break;case "aboveright":b+=c;a+=h;break;case "centerleft":b-=c;break;case "centercenter":break;case "centerright":b+=c;break;case "belowleft":b-=c;a-=h;break;case "belowcenter":a-=h;break;case "belowright":b+=c;a-=h;break;default:return}n.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,c,f,d,h,l,e,g,n){var k,m,p,v,t,q,w,r=f*this._scale,y=this._LINE_STEP_CONST*
Math.min(this._map.width,this._map.height)*this._scale;for(l=0;l<b.paths.length;l++){var u=b.paths[l],z=r,x=0;for(k=0;k<u.length-1;k++)m=u[k][0],p=u[k][1],v=u[k+1][0],t=u[k+1][1],q=v-m,w=t-p,q=Math.sqrt(q*q+w*w),x+q>z?(x=this._generatePositionsOnLine(b.spatialReference,a,z,y,x,m,p,v,t,c,f,d,h,e,g,n),z=y):x+=q}},_generateLinePositionsPlaceAtEnd:function(b,a,c,f,d,h,l,e,g,n){var k,m,p,v,t,q,w,r=f*this._scale,y=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale;for(l=0;l<b.paths.length;l++){var u=
b.paths[l],z=r,x=0;for(k=u.length-2;0<=k;k--)m=u[k+1][0],p=u[k+1][1],v=u[k][0],t=u[k][1],q=v-m,w=t-p,q=Math.sqrt(q*q+w*w),x+q>z?(x=this._generatePositionsOnLine(b.spatialReference,a,z,y,x,m,p,v,t,c,f,d,h,e,g,n),z=y):x+=q}},_generateLinePositionsPlaceAtCenter:function(b,a,c,f,d,h,l,e,g,n,k){var m,p,v,t,q,w,r,y;for(e=0;e<b.paths.length;e++){var u=b.paths[e];if(!(2>u.length)){var z=0;for(m=0;m<u.length-1;m++)v=u[m][0],t=u[m][1],q=u[m+1][0],w=u[m+1][1],r=q-v,y=w-t,z+=Math.sqrt(r*r+y*y);var x=0;for(m=
0;m<u.length-1;m++){v=u[m][0];t=u[m][1];q=u[m+1][0];w=u[m+1][1];r=q-v;y=w-t;r=Math.sqrt(r*r+y*y);if(x+r>z/2)break;x+=r}m==u.length-1&&m--;v=u[m][0];t=u[m][1];q=u[m+1][0];w=u[m+1][1];r=q-v;y=w-t;x=z/2-x;y=Math.atan2(y,r);r=v+x*Math.cos(y);y=t+x*Math.sin(y);q=this._angleAndShifts(v,t,q,w,l,g,n);k.push({x:r+q.shiftX,y:y+q.shiftY,angle:q.angle});var z=r,A=y,x=0;for(p=m;p<u.length-1;p++)p==m?(v=z,t=A):(v=u[p][0],t=u[p][1]),q=u[p+1][0],w=u[p+1][1],r=q-v,y=w-t,r=Math.sqrt(r*r+y*y),x+r>c?x=this._generatePositionsOnLine(b.spatialReference,
a,c,c,x,v,t,q,w,f,d,h,l,g,n,k):x+=r;x=0;for(p=m;0<=p;p--)p==m?(v=z,t=A):(v=u[p+1][0],t=u[p+1][1]),q=u[p][0],w=u[p][1],r=q-v,y=w-t,r=Math.sqrt(r*r+y*y),x+r>c?x=this._generatePositionsOnLine(b.spatialReference,a,c,c,x,v,t,q,w,f,d,h,l,g,n,k):x+=r}}},_generatePositionsOnLine:function(b,a,c,f,d,h,l,e,g,n,k,m,p,v,t,q){n=Math.atan2(g-l,e-h);k=h;m=l;for(var w=k,r=m;;){d=c-d;if(k+=d*Math.cos(n),m+=d*Math.sin(n),!this._belongs(k,m,h,l,e,g))return b=e-w,g-=r,Math.sqrt(b*b+g*g);d=this._angleAndShifts(h,l,e,g,
p,v,t);c=k+d.shiftX;r=m+d.shiftY;a?this._labelLayer._isWithinScreenArea(new A(c,r,c,r,b))&&q.push({x:c,y:r,angle:d.angle}):q.push({x:c,y:r,angle:d.angle});w=k;r=m;d=0;c=f}},_postSorting:function(b,a,c){if(b&&0<a.length){var f=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var d=a[0].x,h=a[0].y,l=Math.sqrt((d-f)*(d-f)+(h-b)*(h-b)),e=a[0].angle,g=0;g<a.length;g++){var n=a[g].x,k=a[g].y,m=Math.sqrt((n-f)*(n-f)+(k-b)*(k-b));l>m&&(d=n,h=k,l=m,e=a[g].angle)}c.push({x:d,y:h,angle:e})}},_belongs:function(b,
a,c,f,d,h){if(d==c&&h==f)return!1;if(d>c){if(b>d||c>b)return!1}else if(d>b||b>c)return!1;if(h>f){if(a>h||f>a)return!1}else if(h>a||a>f)return!1;return!0},_angleAndShifts:function(b,a,c,f,d,h,l){for(b=Math.atan2(f-a,c-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;f=Math.sin(b);var e=Math.cos(b);c=a=0;"Above"==h&&(a=d*f*this._scale,c=d*e*this._scale);"Below"==h&&(a=-d*f*this._scale,c=-d*e*this._scale);d=[];return d.angle=l?-b:0,d.shiftX=-a,d.shiftY=c,d},_generatePolygonPositionsForManyLabels:function(b,
a,c,f,d,h,l){f=this._calcRingExtent(b);if(.75*(f.xmax-f.xmin)>this._map.width*this._scale||.75*(f.ymax-f.ymin)>this._map.height*this._scale){var e=this._findCentroidForRing(b);h=this._map.width*this._scale<f.xmax-f.xmin?this._POLYGON_X_STEP_CONST*this._map.width*this._scale:this._POLYGON_X_STEP_CONST*(f.xmax-f.xmin);d=this._map.height*this._scale<f.ymax-f.ymin?this._POLYGON_Y_STEP_CONST*this._map.height*this._scale:this._POLYGON_Y_STEP_CONST*(f.ymax-f.ymin);var g,n,k=e[0]-Math.round((e[0]-f.xmin)/
h)*h;g=e[1]-Math.round((e[1]-f.ymin)/d)*d;e=!0;for(n=g;n<f.ymax;n+=d)if(e=!e,!(n<this._ymin||n>this._ymax))for(g=k+(e?0:h/2);g<f.xmax;g+=h)this._labelLayer._isWithinScreenArea(new A(g,n,g,n,a))&&this._isPointWithinRing(c,b,g,n)&&l.push({x:g,y:n})}else for(e=this._findCentroidForRing(b),f=0;10>f;f++)if(d=e[0],k=e[1]+(f%2?-1:1)*Math.floor(f/2)*h*this._scale,this._labelLayer._isWithinScreenArea(new A(d,k,d,k,a))&&this._isPointWithinRing(c,b,d,k))return void l.push({x:d,y:k})},_calcRingExtent:function(b){var a,
c;c=new A;for(a=0;a<b.length-1;a++){var f=b[a][0],d=b[a][1];(void 0===c.xmin||f<c.xmin)&&(c.xmin=f);(void 0===c.ymin||d<c.ymin)&&(c.ymin=d);(void 0===c.xmax||f>c.xmax)&&(c.xmax=f);(void 0===c.ymax||d>c.ymax)&&(c.ymax=d)}return c},_isPointWithinPolygon:function(b,a,c,f){var d;for(d=0;d<a.rings.length;d++)if(this._isPointWithinRing(b,a.rings[d],c,f))return!0;return!1},_isPointWithinRing:function(b,a,c,f){var d,h,l,e,g=[],n=a.length;for(b=0;n-1>b;b++)if(d=a[b][0],h=a[b][1],l=a[b+1][0],e=a[b+1][1],d!=
l||h!=e){if(h==e){if(f!=h)continue;g.push(d)}if(d==l)e>h&&f>=h&&e>f&&g.push(d),h>e&&h>=f&&f>e&&g.push(d);else{var k=(l-d)/(e-h)*(f-h)+d;l>d&&k>=d&&l>k&&g.push(k);d>l&&d>=k&&k>l&&g.push(k)}}g.sort(function(a,b){return a-b});for(b=0;b<g.length-1;b++)if(d=g[b],l=g[b+1],c>=d&&l>c)return b%2?!1:!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,c=[0,0],f=0,d=b[0][0],h=b[0][1],l=1;a-1>l;l++){var e=b[l][0],g=b[l][1],n=b[l+1][0],k=b[l+1][1],m=(e-d)*(k-h)-(n-d)*(g-h);c[0]+=m*(d+e+n);c[1]+=m*
(h+g+k);f+=m}return c[0]/=3*f,c[1]/=3*f,c},_findCentroidForFeature:function(b){for(var a=0,c=[0,0],f=0;f<b.rings.length;f++)for(var d=b.rings[f],h=d.length,l=d[0][0],e=d[0][1],g=1;h-1>g;g++){var n=d[g][0],k=d[g][1],m=d[g+1][0],p=d[g+1][1],v=(n-l)*(p-e)-(m-l)*(k-e);c[0]+=v*(l+n+m);c[1]+=v*(e+k+p);a+=v}return c[0]/=3*a,c[1]/=3*a,c},_findPlace:function(b,a,c,f,d,h,l){if(isNaN(c)||isNaN(f))return!1;for(var e=0;e<this._placedLabels.length;e++){var g=this._placedLabels[e].angle,n=this._placedLabels[e].width*
this._scale,k=this._placedLabels[e].height*this._scale,m=this._placedLabels[e].x-c,p=this._placedLabels[e].y-f;if(0===d&&0===g){if(this._findPlace2(-h*this._scale,-l*this._scale,h*this._scale,l*this._scale,m-n,p-k,m+n,p+k))return!1}else{var v=new A(-h*this._scale,-l*this._scale,h*this._scale,l*this._scale,null),t=0,q=1;0!==d&&(t=Math.sin(d),q=Math.cos(d));var w=m*q-p*t,m=m*t+p*q,g=g-d,t=Math.sin(g),q=Math.cos(g),r=-n*q- -k*t,p=-n*t+-k*q,g=+n*q- -k*t,y=+n*t+-k*q,n=w+r,k=m-p,t=w+g,q=m-y,r=w-r,p=m+p,
w=w-g,m=m+y,g=new B;if(g.addRing([[n,k],[t,q],[r,p],[w,m],[n,k]]),v.intersects(g))return!1}}for(;d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;e={};return e.layer=b,e.text=a,e.angle=d,e.x=c,e.y=f,e.width=h,e.height=l,this._placedLabels.push(e),!0},_findPlace2:function(b,a,c,f,d,h,l,e){return(b>=d&&l>=b||c>=d&&l>=c||d>=b&&c>=l)&&(a>=h&&e>=a||f>=h&&e>=f||h>=a&&f>=e)?!0:!1}})});