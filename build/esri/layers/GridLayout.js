//>>built
define("esri/layers/GridLayout","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(l,u,v,w,x,y,z,A){l=l(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,c,a,d){this.origin=b;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=a.width;this.mapHeight=a.height;this.srInfo=d},setResolution:function(b){if(this._resolution=(b.xmax-b.xmin)/this.mapWidth,this.srInfo)b=Math.round(2*
this.srInfo.valid[1]/this._resolution),b=Math.round(b/this.cellWidth),this._frameStats=[b,0,b-1]},getCellCoordinates:function(b){var c=this._resolution,a=this.origin;return{row:Math.floor((a.y-b.y)/(this.cellHeight*c)),col:Math.floor((b.x-a.x)/(this.cellWidth*c))}},normalize:function(b){var c=this._frameStats;if(c){var a=c[0],d=c[1],c=c[2];d>b?(b%=a,b=d>b?b+a:b):b>c&&(b%=a)}return b},intersects:function(b,c){var a=this.srInfo;return a?v.some(c._getParts(a),function(a){return b.intersects(a.extent)}):
b.intersects(c)},getCellExtent:function(b,c){var a=this._resolution,d=this.origin,g=this.cellWidth,m=this.cellHeight;return new z(c*g*a+d.x,d.y-(b+1)*m*a,(c+1)*g*a+d.x,d.y-b*m*a,new y(d.spatialReference.toJson()))},getLatticeID:function(b){var c=this.getCellCoordinates({x:b.xmin,y:b.ymax}),a=this.getCellCoordinates({x:b.xmax,y:b.ymin});b=c.row;var d=a.row,c=this.normalize(c.col),a=this.normalize(a.col);return b+"_"+d+"_"+c+"_"+a},sorter:function(b,c){return c>b?-1:1},getCellsInExtent:function(b,c){var a,
d,g,m,l,t,h=this.getCellCoordinates({x:b.xmin,y:b.ymax}),k=this.getCellCoordinates({x:b.xmax,y:b.ymin}),n=h.row,p=k.row,h=h.col,k=k.col,q=[],e=[],f=[],r=[];for(a=n;p>=a;a++)for(d=h;k>=d;d++)g=this.normalize(d),b=this.getCellExtent(a,g),q.push({row:a,col:g,extent:b,resolution:this._resolution}),c&&(e.push(b.xmin,b.xmax),f.push(b.ymin,b.ymax));h=this.normalize(h);k=this.normalize(k);e.sort(this.sorter);f.sort(this.sorter);d=e.length;for(a=d-1;0<=a;a--)d-1>a&&e[a]===e[a+1]&&e.splice(a,1);d=f.length;
for(a=d-1;0<=a;a--)d-1>a&&f[a]===f[a+1]&&f.splice(a,1);if(e.length&&f.length){g=e[0];m=e[e.length-1];l=f[0];t=f[f.length-1];d=e.length;for(a=0;d>a;a++)r.push([[e[a],t],[e[a],l]]);d=f.length;for(a=0;d>a;a++)r.push([[g,f[a]],[m,f[a]]]);a=new A({paths:r,spatialReference:this.origin.spatialReference.toJson()});q.push({latticeID:n+"_"+p+"_"+h+"_"+k,lattice:a,resolution:this._resolution})}return{minRow:n,maxRow:p,minCol:h,maxCol:k,cells:q}}});return w("extend-esri")&&u.setObject("layers._GridLayout",l,
x),l});