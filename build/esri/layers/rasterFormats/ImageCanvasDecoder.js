//>>built
define("esri/layers/rasterFormats/ImageCanvasDecoder",["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(p,q,r,t){var h;return q(null,{constructor:function(a){this.ctx=a.ctx;this._loadRasterFormatModule()},decode:function(a,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";var g,b=new r,f=new Uint8Array(a),d=this._getFormat(a);if("error"===d)throw"invalid format";"jpeg"===d&&(g=this._getMask(f,e));var c,l,m="";for(c=0;c<f.length;c+=65535)l=
f.subarray(c,c+65535>f.length-1?f.length-1:c+65535),m+=String.fromCharCode.apply(null,l);var h,f="data:image/"+d+";base64,"+window.btoa(m),k=new Image;k.src=f;var n=this;return k.onload=function(){n.ctx.clearRect(0,0,e.width,e.height);n.ctx.drawImage(k,0,0);var a=n.ctx.getImageData(0,0,k.width,k.height);if(h=a.data,g)for(c=0;c<g.length;c++)h[4*c+3]=g[c]?255:0;n.ctx.putImageData(a,0,0);b.resolve(null)},k.onerror=function(){b.reject("cannot load image")},b},_getFormat:function(a){a=new Uint8Array(a,
0,10);var e="error";return 255===a[0]&&216===a[1]?e="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(e="png"),e},_getMask:function(a,e){var g;try{if(!h)throw"The zlib decoder module is not loaded.";var b=0,f=0,d=Math.round(a.length/2);1===d%2&&(d+=1);for(var c=a.length-2,b=d;c>b&&(255!==a[b]||217!==a[b+1]);b++);d=b+=2;if(d<a.length-1){var l=(new h(a.subarray(d))).getBytes();g=new Uint8Array(e.width*e.height);for(b=d=0;b<l.length;b++)for(f=7;0<=f;f--)g[d++]=l[b]>>f&1}}catch(m){}return g},_loadRasterFormatModule:function(){10>
t("ie")||p(["./Zlib"],function(a){h=a})}})});