//>>built
define("esri/layers/rasterFormats/Jpg",[],function(){return function(){function R(){}function S(b,d){for(var c,h,a=0,v=[],e=16;0<e&&!b[e-1];)e--;v.push({children:[],index:0});var g,l=v[0];for(c=0;e>c;c++){for(h=0;h<b[c];h++){l=v.pop();for(l.children[l.index]=d[a];0<l.index;)l=v.pop();l.index++;for(v.push(l);v.length<=c;)v.push(g={children:[],index:0}),l.children[l.index]=g.children,l=g;a++}e>c+1&&(v.push(g={children:[],index:0}),l.children[l.index]=g.children,l=g)}return v[0].children}function T(b,
d,c,h,a,v,e,g,l){function t(){if(0<y)return y--,p>>y&1;if(p=b[d++],255===p){var a=b[d++];if(a)throw"unexpected marker: "+(p<<8|a).toString(16);}return y=7,p>>>7}function w(a){for(;;){if(a=a[t()],"number"==typeof a)return a;if("object"!=typeof a)throw"invalid huffman sequence";}}function z(a){for(var b=0;0<a;)b=b<<1|t(),a--;return b}function k(a){if(1===a)return 1===t()?1:-1;var b=z(a);return b>=1<<a-1?b:b+(-1<<a)+1}function f(a,b){var c=w(a.huffmanTableDC),c=0===c?0:k(c);a.blockData[b]=a.pred+=c;
for(c=1;64>c;){var e=w(a.huffmanTableAC),d=15&e,e=e>>4;if(0!==d)c+=e,a.blockData[b+N[c]]=k(d),c++;else{if(15>e)break;c+=16}}}function r(a,b){var c=w(a.huffmanTableDC),c=0===c?0:k(c)<<l;a.blockData[b]=a.pred+=c}function x(a,b){a.blockData[b]|=t()<<l}function q(a,b){if(0<m)return void m--;for(var c=v;e>=c;){var d=w(a.huffmanTableAC),f=15&d,d=d>>4;if(0!==f)c+=d,a.blockData[b+N[c]]=k(f)*(1<<l),c++;else{if(15>d){m=z(d)+(1<<d)-1;break}c+=16}}}function A(a,b){for(var c,d,f=v,g=0;e>=f;){var h=N[f];switch(G){case 0:if(d=
w(a.huffmanTableAC),c=15&d,g=d>>4,0===c)15>g?(m=z(g)+(1<<g),G=4):(g=16,G=1);else{if(1!==c)throw"invalid ACn encoding";B=k(c);G=g?2:3}continue;case 1:case 2:a.blockData[b+h]?a.blockData[b+h]+=t()<<l:(g--,0===g&&(G=2===G?3:0));break;case 3:a.blockData[b+h]?a.blockData[b+h]+=t()<<l:(a.blockData[b+h]=B<<l,G=0);break;case 4:a.blockData[b+h]&&(a.blockData[b+h]+=t()<<l)}f++}4===G&&(m--,0===m&&(G=0))}var B,n,E,F,D,H=(c.precision,c.samplesPerLine,c.scanLines,c.mcusPerLine),C=c.progressive,u=(c.maxH,c.maxV,
d),p=0,y=0,m=0,G=0,I=h.length;g=C?0===v?0===g?r:x:0===g?q:A:f;var J,K,C=0;K=1===I?h[0].blocksPerLine*h[0].blocksPerColumn:H*c.mcusPerColumn;a||(a=K);for(var L,M;K>C;){for(n=0;I>n;n++)h[n].pred=0;if(m=0,1===I)for(c=h[0],D=0;a>D;D++)g(c,64*((c.blocksPerLine+1)*(C/c.blocksPerLine|0)+C%c.blocksPerLine)),C++;else for(D=0;a>D;D++){for(n=0;I>n;n++)for(c=h[n],L=c.h,M=c.v,E=0;M>E;E++)for(F=0;L>F;F++)g(c,64*((c.blocksPerLine+1)*((C/H|0)*c.v+E)+(C%H*c.h+F)));C++}if(y=0,J=b[d]<<8|b[d+1],65280>=J)throw"marker was not found";
if(!(65488<=J&&65495>=J))break;d+=2}return d-u}function U(b,d){for(var c=d.blocksPerLine,h=d.blocksPerColumn,a=new Int16Array(64),v=0;h>v;v++)for(var e=0;c>e;e++){for(var g=64*((d.blocksPerLine+1)*v+e),l=a,t=void 0,w=void 0,z=void 0,k=void 0,f=void 0,r=void 0,x=void 0,q=void 0,A=void 0,B=void 0,n=void 0,E=void 0,F=void 0,D=void 0,H=void 0,C=void 0,u=void 0,p=d.quantizationTable,y=d.blockData,m=0;64>m;m+=8)A=y[g+m],B=y[g+m+1],n=y[g+m+2],E=y[g+m+3],F=y[g+m+4],D=y[g+m+5],H=y[g+m+6],C=y[g+m+7],A*=p[m],
0!==(B|n|E|F|D|H|C)?(B*=p[m+1],n*=p[m+2],E*=p[m+3],F*=p[m+4],D*=p[m+5],H*=p[m+6],C*=p[m+7],t=I*A+128>>8,w=I*F+128>>8,z=n,k=H,f=J*(B-C)+128>>8,q=J*(B+C)+128>>8,r=E<<4,x=D<<4,t=t+w+1>>1,w=t-w,u=z*K+k*L+128>>8,z=z*L-k*K+128>>8,k=u,f=f+x+1>>1,x=f-x,q=q+r+1>>1,r=q-r,t=t+k+1>>1,k=t-k,w=w+z+1>>1,z=w-z,u=f*M+q*O+2048>>12,f=f*O-q*M+2048>>12,q=u,u=r*P+x*Q+2048>>12,r=r*Q-x*P+2048>>12,x=u,l[m]=t+q,l[m+7]=t-q,l[m+1]=w+x,l[m+6]=w-x,l[m+2]=z+r,l[m+5]=z-r,l[m+3]=k+f,l[m+4]=k-f):(u=I*A+512>>10,l[m]=u,l[m+1]=u,l[m+
2]=u,l[m+3]=u,l[m+4]=u,l[m+5]=u,l[m+6]=u,l[m+7]=u);for(p=0;8>p;++p)A=l[p],B=l[p+8],n=l[p+16],E=l[p+24],F=l[p+32],D=l[p+40],H=l[p+48],C=l[p+56],0!==(B|n|E|F|D|H|C)?(t=I*A+2048>>12,w=I*F+2048>>12,z=n,k=H,f=J*(B-C)+2048>>12,q=J*(B+C)+2048>>12,r=E,x=D,t=(t+w+1>>1)+4112,w=t-w,u=z*K+k*L+2048>>12,z=z*L-k*K+2048>>12,k=u,f=f+x+1>>1,x=f-x,q=q+r+1>>1,r=q-r,t=t+k+1>>1,k=t-k,w=w+z+1>>1,z=w-z,u=f*M+q*O+2048>>12,f=f*O-q*M+2048>>12,q=u,u=r*P+x*Q+2048>>12,r=r*Q-x*P+2048>>12,x=u,A=t+q,C=t-q,B=w+x,H=w-x,n=z+r,D=z-r,
E=k+f,F=k-f,A=16>A?0:4080<=A?255:A>>4,B=16>B?0:4080<=B?255:B>>4,n=16>n?0:4080<=n?255:n>>4,E=16>E?0:4080<=E?255:E>>4,F=16>F?0:4080<=F?255:F>>4,D=16>D?0:4080<=D?255:D>>4,H=16>H?0:4080<=H?255:H>>4,C=16>C?0:4080<=C?255:C>>4,y[g+p]=A,y[g+p+8]=B,y[g+p+16]=n,y[g+p+24]=E,y[g+p+32]=F,y[g+p+40]=D,y[g+p+48]=H,y[g+p+56]=C):(u=I*A+8192>>14,u=-2040>u?0:2024<=u?255:u+2056>>4,y[g+p]=u,y[g+p+8]=u,y[g+p+16]=u,y[g+p+24]=u,y[g+p+32]=u,y[g+p+40]=u,y[g+p+48]=u,y[g+p+56]=u)}return d.blockData}function G(b){return 0>=b?
0:255<=b?255:b}var N=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),Q=4017,P=799,O=3406,M=2276,L=1567,K=3784,I=5793,J=2896;return R.prototype={parse:function(b){function d(){var a=b[e]<<8|b[e+1];return e+=2,a}function c(){var a=d(),a=b.subarray(e,e+a-2);return e+=a.length,a}function h(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/
8/a.maxV),d=0;d<a.components.length;d++){n=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*n.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*n.v/a.maxV);n.blockData=new Int16Array(64*c*n.v*(b*n.h+1));n.blocksPerLine=e;n.blocksPerColumn=f}a.mcusPerLine=b;a.mcusPerColumn=c}var a,v,e=0,g=(b.length,null),l=null,t=[],w=[],z=[],k=d();if(65496!==k)throw"SOI not found";for(k=d();65497!==k;){var f,r;switch(k){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:f=
c();65504===k&&74===f[0]&&70===f[1]&&73===f[2]&&70===f[3]&&0===f[4]&&(g={version:{major:f[5],minor:f[6]},densityUnits:f[7],xDensity:f[8]<<8|f[9],yDensity:f[10]<<8|f[11],thumbWidth:f[12],thumbHeight:f[13],thumbData:f.subarray(14,14+3*f[12]*f[13])});65518===k&&65===f[0]&&100===f[1]&&111===f[2]&&98===f[3]&&101===f[4]&&(l={version:f[5]<<8|f[6],flags0:f[7]<<8|f[8],flags1:f[9]<<8|f[10],transformCode:f[11]});break;case 65499:for(var x=d()+e-2;x>e;){var q=b[e++],A=new Uint16Array(64);if(0===q>>4)for(f=0;64>
f;f++)k=N[f],A[k]=b[e++];else{if(1!==q>>4)throw"DQT: invalid table spec";for(f=0;64>f;f++)k=N[f],A[k]=d()}t[15&q]=A}break;case 65472:case 65473:case 65474:if(a)throw"Only single frame JPEGs supported";d();a={};a.extended=65473===k;a.progressive=65474===k;a.precision=b[e++];a.scanLines=d();a.samplesPerLine=d();a.components=[];a.componentIds={};x=b[e++];for(k=A=q=0;x>k;k++){f=b[e];r=b[e+1]>>4;var B=15&b[e+1];r>q&&(q=r);B>A&&(A=B);r=a.components.push({h:r,v:B,quantizationTable:t[b[e+2]]});a.componentIds[f]=
r-1;e+=3}a.maxH=q;a.maxV=A;h(a);break;case 65476:x=d();for(k=2;x>k;){q=b[e++];A=new Uint8Array(16);for(f=r=0;16>f;f++,e++)r+=A[f]=b[e];B=new Uint8Array(r);for(f=0;r>f;f++,e++)B[f]=b[e];k+=17+r;(0===q>>4?z:w)[15&q]=S(A,B)}break;case 65501:d();v=d();break;case 65498:var n,x=(d(),b[e++]);f=[];for(k=0;x>k;k++)q=a.componentIds[b[e++]],n=a.components[q],q=b[e++],n.huffmanTableDC=z[q>>4],n.huffmanTableAC=w[15&q],f.push(n);k=b[e++];x=b[e++];q=b[e++];k=T(b,e,a,f,v,k,x,q>>4,15&q);e+=k;break;case 65535:255!==
b[e]&&e--;break;default:if(255===b[e-3]&&192<=b[e-2]&&254>=b[e-2]){e-=3;break}throw"unknown JPEG marker "+k.toString(16);}k=d()}this.width=a.samplesPerLine;this.height=a.scanLines;this.jfif=g;this.eof=e;this.adobe=l;this.components=[];for(k=0;k<a.components.length;k++)n=a.components[k],this.components.push({output:U(a,n),scaleX:n.h/a.maxH,scaleY:n.v/a.maxV,blocksPerLine:n.blocksPerLine,blocksPerColumn:n.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(b,
d){var c,h,a,v,e,g,l,t=this.width/b,w=this.height/d,z=0,k=this.components.length,f=b*d*k,r=new Uint8Array(f),x=new Uint32Array(b);for(g=0;k>g;g++){c=this.components[g];h=c.scaleX*t;a=c.scaleY*w;z=g;l=c.output;v=c.blocksPerLine+1<<3;for(e=0;b>e;e++)c=0|e*h,x[e]=(c&4294967288)<<3|7&c;for(h=0;d>h;h++)for(c=0|h*a,c=v*(c&4294967288)|(7&c)<<3,e=0;b>e;e++)r[z]=l[c+x[e]],z+=k}if(l=this.decodeTransform)for(g=0;f>g;)for(a=c=0;k>c;c++,g++,a+=2)r[g]=(r[g]*l[a]>>8)+l[a+1];return r},_isColorConversionNeeded:function(){return this.adobe&&
this.adobe.transformCode?!0:3===this.numComponents?!0:!1},_convertYccToRgb:function(b){for(var d,c,h,a=0,v=b.length;v>a;a+=3)d=b[a],c=b[a+1],h=b[a+2],b[a]=G(d-179.456+1.402*h),b[a+1]=G(d+135.459-.344*c-.714*h),b[a+2]=G(d-226.816+1.772*c);return b},_convertYcckToRgb:function(b){for(var d,c,h,a,v=0,e=0,g=b.length;g>e;e+=4){d=b[e];c=b[e+1];h=b[e+2];a=b[e+3];var l=-122.67195406894+c*(-6.60635669420364E-5*c+4.37130475926232E-4*h-5.4080610064599E-5*d+4.8449797120281E-4*a-.154362151871126)+h*(-9.57964378445773E-4*
h+8.17076911346625E-4*d-.00477271405408747*a+1.53380253221734)+d*(9.61250184130688E-4*d-.00266257332283933*a+.48357088451265)+a*(-3.36197177618394E-4*a+.484791561490776),t=107.268039397724+c*(2.19927104525741E-5*c-6.40992018297945E-4*h+6.59397001245577E-4*d+4.26105652938837E-4*a-.176491792462875)+h*(-7.78269941513683E-4*h+.00130872261408275*d+7.70482631801132E-4*a-.151051492775562)+d*(.00126935368114843*d-.00265090189010898*a+.25802910206845)+a*(-3.18913117588328E-4*a-.213742400323665);d=-20.810012546947+
c*(-5.70115196973677E-4*c-2.63409051004589E-5*h+.0020741088115012*d-.00288260236853442*a+.814272968359295)+h*(-1.53496057440975E-5*h-1.32689043961446E-4*d+5.60833691242812E-4*a-.195152027534049)+d*(.00174418132927582*d-.00255243321439347*a+.116935020465145)+a*(-3.43531996510555E-4*a+.24165260232407);b[v++]=G(l);b[v++]=G(t);b[v++]=G(d)}return b},_convertYcckToCmyk:function(b){for(var d,c,h,a=0,v=b.length;v>a;a+=4)d=b[a],c=b[a+1],h=b[a+2],b[a]=G(434.456-d-1.402*h),b[a+1]=G(119.541-d+.344*c+.714*h),
b[a+2]=G(481.816-d-1.772*c);return b},_convertCmykToRgb:function(b){for(var d,c,h,a,v=0,e=1/255/255,g=0,l=b.length;l>g;g+=4){d=b[g];c=b[g+1];h=b[g+2];a=b[g+3];var t=d*(-4.387332384609988*d+54.48615194189176*c+18.82290502165302*h+212.25662451639585*a-72734.4411664936)+c*(1.7149763477362134*c-5.6096736904047315*h-17.873870861415444*a-1401.7366389350734)+h*(-2.5217340131683033*h-21.248923337353073*a+4465.541406466231)-a*(21.86122147463605*a+48317.86113160301),w=d*(8.841041422036149*d+60.118027045597366*
c+6.871425592049007*h+31.159100130055922*a-20220.756542821975)+c*(-15.310361306967817*c+17.575251261109482*h+131.35250912493976*a-48691.05921601825)+h*(4.444339102852739*h+9.8632861493405*a-6341.191035517494)-a*(20.737325471181034*a+47890.15695978492);d=d*(.8842522430003296*d+8.078677503112928*c+30.89978309703729*h-.23883238689178934*a-3616.812083916688)+c*(10.49593273432072*c+63.02378494754052*h+50.606957656360734*a-28620.90484698408)+h*(.03296041114873217*h+115.60384449646641*a-49363.43385999684)-
a*(22.33816807309886*a+45932.16563550634);b[v++]=0<=t?255:-16581375>=t?0:255+t*e|0;b[v++]=0<=w?255:-16581375>=w?0:255+w*e|0;b[v++]=0<=d?255:-16581375>=d?0:255+d*e|0}return b},getData:function(b,d,c){if(4<this.numComponents)throw"Unsupported color mode";b=this._getLinearizedBlockData(b,d);if(3===this.numComponents)return this._convertYccToRgb(b);if(4===this.numComponents){if(this._isColorConversionNeeded())return c?this._convertYcckToRgb(b):this._convertYcckToCmyk(b);if(c)return this._convertCmykToRgb(b)}return b}},
R}()});