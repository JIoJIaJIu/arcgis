//>>built
define("esri/layers/ArcGISTiledMapServiceLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/io-query ../kernel ../urlUtils ../SpatialReference ./TiledMapServiceLayer ./ArcGISMapServiceLayer ./TileInfo ./TimeInfo ./TileMap".split(" "),function(m,d,h,n,p,q,k,r,l,t,u,v,w,x,y){d=d([u,v],{declaredClass:"esri.layers.ArcGISTiledMapServiceLayer",_agolAttrs:"Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" "),
_isReference:!1,_referenceLayers:"Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Reference Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Reference_Overlay Reference/World_Transportation".split(" "),constructor:function(b,a){a&&(a.roundrobin&&(m.deprecated(this.declaredClass+" : Constructor option 'roundrobin' deprecated. Use option 'tileServers'."),a.tileServers=a.roundrobin),this._setTileServers(a.tileServers),
this._loadCallback=a.loadCallback);this._params=h.mixin({},this._url.query);n.some(["servicesdev.arcgisonline.com/arcgis/rest/services","servicesdevext.arcgisonline.com/arcgis/rest/services","services.arcgisonline.com/arcgis/rest/services","servicesqa.arcgisonline.com/arcgis/rest/services"],function(a){return-1<b.toLowerCase().indexOf(a.toLowerCase())})?(this.resampling=!(a&&!1===a.resampling),this.resampling&&(this.tileMap=new y(this))):this.resampling=a&&null!=a.resampling?a.resampling:void 0;this._initLayer=
h.hitch(this,this._initLayer);var e=a&&a.resourceInfo;e?this._initLayer(e):(this._load=h.hitch(this,this._load),this._load())},_TILE_FORMATS:{PNG:"png",PNG8:"png",PNG24:"png",PNG32:"png",JPG:"jpg",JPEG:"jpg",GIF:"gif"},_setTileServers:function(b){if(b&&0<b.length){this.tileServers=b;var a,e=b.length;for(a=0;e>a;a++)b[a]=l.urlToObject(b[a]).path}},_initLayer:function(b){this.inherited(arguments);this.resourceInfo=p.toJson(b);this.tileInfo=new w(b.tileInfo);this.resampling=null==this.resampling?!!b.resampling:
this.resampling;!this.spatialReference&&this.tileInfo.spatialReference&&(this.spatialReference=new t(this.tileInfo.spatialReference.toJson()));this.isPNG32="PNG24"===this.tileInfo.format||"PNG32"===this.tileInfo.format;b.timeInfo&&(this.timeInfo=new x(b.timeInfo));var a=this._url.path,e=this._loadCallback,z="file:"===window.location.protocol?"http:":window.location.protocol,c=a.match(/^https?\:\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i),c=c&&
c[2];if(!this.tileServers)if(b.tileServers)this._setTileServers(b.tileServers);else{var f=-1!==a.search(/^https?\:\/\/server\.arcgisonline\.com/i),d=-1!==a.search(/^https?\:\/\/services\.arcgisonline\.com/i);(f||d)&&this._setTileServers([a,a.replace(f?/server\.arcgisonline/i:/services\.arcgisonline/i,f?"services.arcgisonline":"server.arcgisonline")])}if(c){for(var c=c.toLowerCase(),g,a=0;a<this._agolAttrs.length;a++)if(g=this._agolAttrs[a],g.toLowerCase()===c){this.hasAttributionData=!0;this.attributionDataUrl=
this.attributionDataUrl||z+"//static.arcgis.com/attribution/"+g;break}for(a=0;a<this._referenceLayers.length;a++)if(g=this._referenceLayers[a],g.toLowerCase()===c){this._isReference=!0;break}}this.loaded=!0;this.onLoad(this);e&&(delete this._loadCallback,e(this))},getTileUrl:function(b,a,e){var d=this.tileServers,c=this._getToken(),f=this._url.query;b=(d?d[a%d.length]:this._url.path)+"/tile/"+b+"/"+a+"/"+e;return this.resampling&&!this.tileMap&&(b+="?blankTile\x3dfalse"),f&&(b+=this.resampling&&!this.tileMap?
"\x26"+k.objectToQuery(f):"?"+k.objectToQuery(f)),!c||f&&f.token||(b+=(-1===b.indexOf("?")?"?":"\x26")+"token\x3d"+c),b=this.addTimestampToURL(b),l.addProxy(b)}});return q("extend-esri")&&h.setObject("layers.ArcGISTiledMapServiceLayer",d,r),d});