//>>built
define("esri/toolbars/edit","require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),function(w,x,n,m,l,h,p,u,y,z,v,H,A,B,C,D,E,k,f,F,G){var c=x(A,{declaredClass:"esri.toolbars.Edit",constructor:function(a,b){if(this._map=a,this._tool=
0,this._map.loaded)this._scratchGL=a.graphics;else var d=m.connect(this._map,"onLoad",this,function(){m.disconnect(d);d=null;this._scratchGL=this._map.graphics});var e=p("esri-mobile");this._defaultOptions=n.mixin({vertexSymbol:new k(k.STYLE_CIRCLE,e?20:12,new f(f.STYLE_SOLID,new h([0,0,0,.5]),1),new h([128,128,128])),ghostVertexSymbol:new k(k.STYLE_CIRCLE,e?18:10,new f(f.STYLE_SOLID,new h([0,0,0,.5]),1),new h([255,255,255,.75])),ghostLineSymbol:new f(f.STYLE_DOT,new h([128,128,128]),2),allowDeleteVertices:!0,
allowAddVertices:!0,rotateHandleOffset:e?24:16,boxLineSymbol:new f(f.STYLE_DASH,new h([64,64,64]),1),boxHandleSymbol:new k(k.STYLE_SQUARE,e?16:9,new f(f.STYLE_SOLID,new h([0,0,0,.5]),1),new h([255,255,255,.75])),textAnchorSymbol:new k(k.STYLE_CIRCLE,10,null,new h([255,0,0]))},b||{})},activate:function(a,b,d){this.deactivate();this._graphic=b;this._options=n.mixin(n.mixin({},this._defaultOptions),d||{});var e=c.MOVE;d=c.EDIT_VERTICES;var g=c.SCALE,f=c.ROTATE,h=c.EDIT_TEXT,k=!1,l=!1,p=!1,q=this._map,
r=q.spatialReference,t=b.geometry.spatialReference;this._geo=!(!r||!t||r.equals(t)||!r.isWebMercator()||4326!==t.wkid);this._isTextPoint=this._prepareTextSymbolEditing(b,a);(a&e)===e&&(k=this._enableMove(b));e=(a&g)===g;f=(a&f)===f;if((e||f)&&(p=this._enableBoxEditing(b,e,f)),(a&d)===d&&(l=this._enableVertexEditing(b)),(a&h)===h&&this._enableTextEditing(b),!(k||l||p))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");
(this._tool=a)&&(this._mapPanEndHandle=m.connect(q,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=m.connect(q,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b));q.snappingManager&&(k||l)&&q.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;if(a){var d=!!this._modified;this._clear();m.disconnect(this._mapPanEndHandle);m.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=
this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:d});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(){},onDeactivate:function(){},onGraphicMoveStart:function(){},onGraphicFirstMove:function(){this._modified=!0},onGraphicMove:function(){},onGraphicMoveStop:function(){},onGraphicClick:function(){},
onVertexMoveStart:function(){},onVertexFirstMove:function(){this._modified=!0},onVertexMove:function(){},onVertexMoveStop:function(){},onVertexAdd:function(){this._modified=!0},onVertexClick:function(){},onVertexMouseOver:function(){},onVertexMouseOut:function(){},onVertexDelete:function(){this._modified=!0},onTextEditStart:function(){},onTextEditEnd:function(){},onScaleStart:function(){},onScaleFirstMove:function(){this._modified=!0},onScale:function(){},onScaleStop:function(){},onRotateStart:function(){},
onRotateFirstMove:function(){this._modified=!0},onRotate:function(){},onRotateStop:function(){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic",
"vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,
b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var d=a.getLayer(),e=d.renderer,d=a.symbol||d._getSymbol(a);if(!d&&(e.hasVisualVariables("sizeInfo",!1)||e.hasVisualVariables("colorInfo",!1)||e.hasVisualVariables("opacityInfo",!1))&&e.addBreak&&e.infos&&1===e.infos.length&&(d=e.infos[0].symbol||e.defaultSymbol),d&&"textsymbol"===d.type){if((b&c.SCALE)===c.SCALE||(b&c.ROTATE)===c.ROTATE||(b&c.EDIT_TEXT)===c.EDIT_TEXT){a.setSymbol(new F(d.toJson()));var g=this;if(this._textSymbolEditor)this._textSymbolEditor.createForm(a),
this._textSymbolEditor.show();else if(this._options&&this._options.textSymbolEditor)this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){g._boxEditor&&g._boxEditor.refresh()});else{var f;f=this._options.textSymbolEditorHolder?u.create("div",null,this._options.textSymbolEditorHolder):u.create("div",null,this._map.root);w(["../dijit/SymbolEditor"],function(b){g._textSymbolEditor=new b({graphic:a},f);b=g._textSymbolEditor.domNode.parentNode.id;y.set(g._textSymbolEditor.domNode,
{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?g._map.width/2-100+"px":"5px",top:"20px","z-index":50});g._textSymbolEditor.startup();g._textSymbolEditor.createForm(a);g._textSymbolEditor.show();g._textSymbolEditor.on("symbol-change",function(){g._boxEditor&&g._boxEditor.refresh()})})}}return((b&c.MOVE)===c.MOVE||(b&c.ROTATE)===c.ROTATE||(b&c.SCALE)===c.SCALE)&&(this._textAnchor=new G(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor)),!0}}return!1},
_enableMove:function(a){var b=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new C(a,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=D.create(a,b,this),!0}return!1},_enableBoxEditing:function(a,b,d){var e=this._map,c=a.geometry.type;return"polyline"===c||"polygon"===c||this._isTextPoint?(this._boxEditor=new B(a,
e,this,b,d,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new E(a,this._map,this),m.connect(this._textEditor,"onEditStart",n.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=
null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();
this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(a,b,d){d&&this._refreshMoveables()},_refreshMoveables:function(a){var b=l.filter([this._graphicMover,this._vertexEditor,this._boxEditor],v.isDefined);l.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){l.forEach(this._getAffectedTools(a),
function(a){a.suspend()})},_endOperation:function(a){l.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return l.filter(b,v.isDefined)}});return n.mixin(c,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16}),p("extend-esri")&&n.setObject("toolbars.Edit",c,z),c});