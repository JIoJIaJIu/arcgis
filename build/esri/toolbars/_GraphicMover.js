//>>built
define("esri/toolbars/_GraphicMover","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(g,l,e,m,t,n,u,v,p,q,r,w,x){var f=g(null,{declaredClass:"esri.toolbars._GraphicMover",constructor:function(a,b,h,d){this.graphic=a;this.map=b;this.toolbar=h;this.tempPt=d;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=
this.graphic.getDojoShape();!b||!a&&b._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var a=this.graphic,b=a.getDojoShape();b&&(b._hostGraphic=a,this._moveable=new u(b,{mover:f.Mover}),this._moveStartHandle=e.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=e.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),
this._movingHandle=e.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=e.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(a=b.getEventSource())&&n.set(a,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=this._moveable;if(a){e.disconnect(this._moveStartHandle);e.disconnect(this._firstMoveHandle);e.disconnect(this._movingHandle);e.disconnect(this._moveStopHandle);var b=a.shape;b&&(b._hostGraphic=null,(b=b.getEventSource())&&n.set(b,
"cursor",null));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},_movingHandler:function(a){a=a.shape.getTransform();this.tempPt&&this.tempPt.getDojoShape().setTransform(a);
this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var b=this.graphic,h=this.toolbar,d=this.map,c=h._geo?r.geographicToWebMercator(b.geometry):b.geometry,e=c.type,f=b.getDojoShape(),k=f.getTransform();if(m.toJson(k)!==m.toJson(this._startTx)){switch(this._moved=!0,e){case "point":var g,e=[k,p.invert(this._startTx)];d.snappingManager&&(g=d.snappingManager._snappingPoint);c=g||d.toMap(p.multiplyPoint(e,d.toScreen(c,!0)));d.snappingManager&&d.snappingManager._killOffSnapping();
break;case "polyline":c=this._updatePolyGeometry(c,c.paths,k);break;case "polygon":c=this._updatePolyGeometry(c,c.rings,k)}f.setTransform(null);b.setGeometry(h._geo?r.webMercatorToGeographic(c,!0):c);this.tempPt&&this.tempPt.setGeometry(new x(b.geometry.toJson()))}else this._moved=!1;(h._endOperation("MOVE"),h.onGraphicMoveStop(b,k),this._moved)||(a=a.__e,d=this.map.position,a=new w(a.pageX-d.x,a.pageY-d.y),h.onGraphicClick(b,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,
b,e){var d,c,f,g;c=this.map;d=a.getPoint(0,0);c=c.toMap(c.toScreen(d).offset(e.dx,e.dy));e=c.x-d.x;var k=c.y-d.y;for(d=0;d<b.length;d++)for(f=b[d],c=0;c<f.length;c++)g=a.getPoint(d,c),a.setPoint(d,c,g.offset(e,k));return a}});return f.Mover=g(v,{declaredClass:"esri.toolbars._Mover",constructor:function(a,b){this.__e=b}}),t("extend-esri")&&(l.setObject("toolbars._GraphicMover",f,q),l.setObject("toolbars._Mover",f.Mover,q)),f});