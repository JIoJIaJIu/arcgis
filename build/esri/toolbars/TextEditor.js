//>>built
define("esri/toolbars/TextEditor","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(d,e,b,l,m,n,p,f,k,q){d=d(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(a,c,b){this._graphic=a;this._map=c;this._toolbar=b;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(a){return this._editBox?
(b.disconnect(this._addEditBoxHandler),void(this._addEditBoxHandler=null)):(this._map.navigationManager.setImmediateClick(!0),void(this._addEditBoxHandler=b.connect(a.getLayer(),"onDblClick",this,function(c){this._map.navigationManager.setImmediateClick(!1);c.graphic==a&&(l.stop(c),b.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(a))})))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(b.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=
null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(a,c){if(!this._editBox){var g;a.symbol.text||(a.symbol.text="Tempt text",a.setSymbol(a.symbol),g="");var d=this._createInputTextStyle(a,this._map);""!==g&&(g=c||a.symbol.text);this._editBox=n.create("input",{type:"text",value:g});f.set(this._editBox,d);p.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=
b.connect(this._editBox,"onkeyup",e.hitch(this,function(a){a.keyCode!=k.ENTER&&a.keyCode!==k.TAB||this._disable()}));this._editBoxBlurHandler=b.connect(this._editBox,"onblur",e.hitch(this,function(){this._disable()}));a.symbol.text="";a.setSymbol(a.symbol);a.hide();var h=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",e.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){f.set(h,{left:this._editBoxLeft+a.delta.x+"px",
top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(f.get(h,"left"));this._editBoxTop=parseFloat(f.get(h,"top"))});this.onEditStart(a,this._editBox);this._toolbar.onTextEditStart(a,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(b.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&
(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(b.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(a){var c=a.getDojoShape().getTransformedBoundingBox(),b=Math.abs(c[0].x-c[1].x)/Math.cos(a.symbol.angle/180*Math.PI);a=a.symbol.font;return{"font-family":a.family,
"font-size":a.size+"px","font-style":a.style,"font-variant":a.variant,"font-weight":a.weight,left:c[0].x+"px",top:c[0].y+"px",width:b+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var a=this._graphic.symbol;a.text=this._editBox.value;this._graphic.setSymbol(a)}else this._graphic.getLayer().remove(this._graphic)}});return m("extend-esri")&&e.setObject("toolbars.TextEditor",d,q),d});