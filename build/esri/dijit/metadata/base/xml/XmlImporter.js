//>>built
define("esri/dijit/metadata/base/xml/XmlImporter","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../etc/docUtil ../etc/matchTopNodeUtil ./XmlFlattener ./xmlUtil ../../../../kernel dojo/sniff".split(" "),function(k,p,g,q,u,r,v,l,t){k=k(null,{constructor:function(c){p.mixin(this,c)},importDocument:function(c,a,b){var d=c.rootElement;c={asTemplate:b,considerGML3andGML32:!0,gxeDocument:c,xmlDocument:a,gxeData:{nsUrisByPrefix:l.makeGxeUrisByPrefix(c.getNamespaces()),nsPrefixesByUri:l.makeGxePrefixesByUri(c.getNamespaces())}};
this._walk(c,d,null)},_findMatchingDomAttribute:function(c,a,b){var d=null;return g.some(b.attributes,function(b){return this._isMatching(c,a,b)?(d=b,!0):void 0},this),d},_findMatchingDomElements:function(c,a,b){var d=null,f=l.nodeTypes.ELEMENT_NODE;return g.forEach(b.childNodes,function(b){b.nodeType===f&&this._isMatching(c,a,b)&&(null===d&&(d=[]),d.push(b))},this),d},_findMatchingSubTarget:function(c,a,b){var d=null,f=l.nodeTypes.ELEMENT_NODE;return g.some(b.childNodes,function(b){if(b.nodeType===
f)if("TopicCatCd@value"===a){if(this._isMatching(c,"TopicCatCd",b)&&g.some(b.attributes,function(a){return this._isMatching(c,"value",a)?(d=a,!0):void 0},this))return!0}else if(this._isMatching(c,a,b))return d=b,!0},this),d},_isMatching:function(c,a,b){var d,f,g=!1,h=null,n=c.gxeData.nsUrisByPrefix,e=a;-1!==e.indexOf(":")&&(d=e.split(":"),f=d[0],e=d[1],f in n?h=n[f]:0===a.indexOf("xml:")?h="http://www.w3.org/XML/1998/namespace":console.log("Warning: namespace prefix was not configured: "+a));8>=q("ie")&&
(h="");c=c.considerGML3andGML32;a=b.namespaceURI===h;return!a&&c&&("http://www.opengis.net/gml/3.2"===h?a="http://www.opengis.net/gml"===b.namespaceURI:"http://www.opengis.net/gml"===h&&(a="http://www.opengis.net/gml/3.2"===b.namespaceURI)),a&&e===b.localName&&(g=!0),g},_getDomNodeText:function(c){return l.getNodeText(c)},_getDomNodeTextValues:function(c,a,b){var d,f,m=[];return g.forEach(a,function(a){d=null;b?(f=this._findMatchingSubTarget(c,b,a),f&&(d=this._getDomNodeText(f))):d=this._getDomNodeText(a);
null!=d&&m.push(d)},this),m},_printGxeReferences:function(c){var a,b="";for(a=0;a<c.depth;a++)b+="  ";console.log(b+c.widget.target);g.forEach(c.attributeRefs,function(a){console.log(b+"    @"+a.widget.target)});g.forEach(c.elementRefs,function(a){this._printGxeReferences(a)},this)},_updateAttribute:function(c,a,b){if(!a.fixed){var d;(b=this._findMatchingDomAttribute(c,a.target,b))&&(d=this._getDomNodeText(b),this._updateXNode(c,a,b,d))}},_updateElementText:function(c,a,b){if(!a.fixed){var d=this._getDomNodeText(b);
this._updateXNode(c,a,b,d)}},_updateXNode:function(c,a,b,d){null!==d&&a.inputWidget&&(a.isDocumentTitle&&(c.gxeDocument.originalTitle=d,c.asTemplate)||(a.inputWidget.importValue({domNode:b,asTemplate:c.asTemplate},d),!a.hide&&a.toggleContent&&a.toggleContent(!0)))},_walk:function(c,a,b){if(!a.fixed){var d,f,m,h,n=!0,e=null;if(b)a._isGxeElement?(e=this._findMatchingDomElements(c,a.target,b),e||(n=!1)):a._isGxeAttribute&&(n=!1,this._updateAttribute(c,a,b));else{if(b=c.xmlDocument.documentElement,!this._isMatching(c,
a.target,b))throw Error("The XML root element does not match the editor definition.");e=[b]}e&&0<e.length&&(e=r.evaluateDomMatch(a,e,c.gxeData.nsPrefixesByUri));var l=a.inputWidget&&a.inputWidget._supportsMultipleValues,k=a.multiplicityHeader;e&&0<e.length&&(a.toggleContent&&a.toggleContent(!0),d=a.getParent(),d&&d._isGxeElementChoice?d.ensureActiveTab(a):d&&(f=d.getParent(),f&&f._isGxeElementChoice?f.ensureActiveTab(d):f&&(m=f.getParent(),m&&m._isGxeElementChoice&&m.ensureActiveTab(f))),l?(n=!1,
h=this._getDomNodeTextValues(c,e,a.inputWidget.subTarget),a.inputWidget.importValues({domNodes:e},h)):1===e.length?(b=e[0],this._updateElementText(c,a,b)):k?(b=e[0],this._updateElementText(c,a,e[0]),g.forEach(e,function(b,d){0<d&&("unbounded"===a.maxOccurs||d!==a.maxOccurs)&&k.repeatElement(a,!1).then(p.hitch(this,function(a){a&&(this._updateElementText(c,a,b),g.forEach(a.getChildren(),function(a){this._walk(c,a,b)},this))}),function(a){console.error(a)})},this)):(b=e[0],this._updateElementText(c,
a,b)));n&&g.forEach(a.getChildren(),function(a){this._walk(c,a,b)},this)}}});return q("extend-esri")&&p.setObject("dijit.metadata.base.xml.XmlImporter",k,t),k});