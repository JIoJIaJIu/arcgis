//>>built
define("esri/dijit/metadata/arcgis/portal/PortalItemAdaptor","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../context/GxeAdaptor ../../../../kernel ../../../../request".split(" "),function(l,k,u,p,h,q,r,m){l=l([q],{itemRequiresRefresh:!1,portalItemContext:null,postCreate:function(){this.inherited(arguments)},afterEditDocumentLoad:function(c,a,b,d){var e,f=this.getItemContext(),h=f.getItem();if(h&&f.getAutoPullItem()&&!d&&(!a||a&&b))try{(e=c.documentType.newPortalItemTransformer(c))&&
e.pull(c,h)}catch(g){console.error(g)}},afterViewDocumentLoad:function(){},deleteMetadata:function(){var c;return this.getItemContext().getAllowDeleteMetadata()?this.writeXml(null):(c=new h,c.reject("Metadata Adaptor: Delete metadata in not allowed."),c)},getAllowEditMetadata:function(){return this.getItemContext().getAllowEditMetadata()},getAllowDeleteMetadata:function(){return this.getItemContext().getAllowDeleteMetadata()},getAllowPullItem:function(){return this.getItemContext().getAllowPullItem()},
getAllowPushToItem:function(){return this.getItemContext().getAllowPushToItem()},getOriginalXml:function(){return this.getItemContext().getOriginalXml()},pullItem:function(c){var a,b=new h,d=this.getItemContext(),e=d.getItem();if(e&&d.getAllowPullItem())try{(a=c.documentType.newPortalItemTransformer(c))&&a.pull(c,e)}catch(f){console.error(f)}return b.resolve(),b},saveXml:function(c,a,b){var d=new h,e=this.getItemContext(),f=e.getItem();if(!e.getAllowEditMetadata())return d.reject("Metadata Adaptor: Write XML in not allowed."),
d;var n,g=null;if(b&&e.getAllowPushToItem()&&f&&window.FormData)try{(n=c.documentType.newPortalItemTransformer(c))&&(g=n.generatePush(c,f))}catch(t){g=null,console.error(t)}return null===g?this.writeXml(a):(this.writeXml(a).then(k.hitch(this,function(){this.updateItem(g).then(k.hitch(this,function(){this.itemRequiresRefresh=!0;d.resolve()}),k.hitch(this,function(a){console.error(a);d.resolve()}))}),k.hitch(this,function(a){d.reject(a)})),d)},getItemContext:function(){return this.portalItemContext},
makeMultiPartFormData:function(c){if(!window.FormData)return null;var a,b=new FormData,d=null;for(a in c)c.hasOwnProperty(a)&&(d=c[a],("snippet"===a||"description"===a||"text"===a)&&null==d&&(d=""),b.append(a,d));return b},readXml:function(c){var a=new h,b=this.getItemContext(),d=b.getRestBaseUrl(),e=b.getToken(),b=b.getItemId();if(null===d)return a.reject("Metadata Adaptor: Unable to read XML, no restBaseUrl"),a;d=d+"content/items/"+encodeURIComponent(b);d+="/info/metadata/metadata.xml";b={};null!==
e&&(b.token=e);e={url:d,content:b,handleAs:c,preventCache:!0};"json"===c&&(e.callbackParamName="callback");return m(e,{usePost:!0}).then(function(b){a.resolve(b)},function(){a.resolve(null)}),a},updateItem:function(c){var a,b=this.getItemContext(),d=b.getRestBaseUrl(),e=b.getToken(),f=b.getItemId(),k=b.getItemOwner(),g=b.getItemFolderId();c.f="json";null!==e&&(c.token=e);c=this.makeMultiPartFormData(c);if(!b.getAllowPushToItem())return a=new h,a.reject("Metadata Adaptor: Update portal item is not allowed."),
a;if(null===c)return a=new h,a.reject("Metadata Adaptor: Unable to update portal item, FormData is not supported on this browser."),a;if(null===d)return a=new h,a.reject("Metadata Adaptor: Unable to update portal item, no restBaseUrl"),a;a=d+"content/users/"+encodeURIComponent(k);"undefined"!=typeof g&&null!==g&&0<g.length&&(a+="/"+encodeURIComponent(g));a+="/items/"+encodeURIComponent(f)+"/update";return m({url:a,form:c,handleAs:"json",callbackParamName:"callback",preventCache:!0},{usePost:!0})},
writeXml:function(c){var a,b=this.getItemContext(),d=b.getRestBaseUrl(),e=b.getToken(),f=b.getItemId(),l=b.getItemOwner(),g=b.getItemFolderId();if(!b.getAllowEditMetadata())return a=new h,a.reject("Metadata Adaptor: Write XML in not allowed."),a;if(null===d)return a=new h,a.reject("Metadata Adaptor: Unable to write XML, no restBaseUrl"),a;b=d+"content/users/"+encodeURIComponent(l);"undefined"!=typeof g&&null!==g&&0<g.length&&(b+="/"+encodeURIComponent(g));b+="/items/"+encodeURIComponent(f);b+=null===
c?"/deleteinfo":"/update";f=[];f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4",'Content-Disposition: form-data; name\x3d"f"',"","json");null!=e&&f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4",'Content-Disposition: form-data; name\x3d"token"',"",e);null===c?f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4",'Content-Disposition: form-data; name\x3d"infoFile"',"","metadata/metadata.xml"):(f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4",'Content-Disposition: form-data; name\x3d"overwrite"',"","true"),
f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4",'Content-Disposition: form-data; name\x3d"metadata"; filename\x3d"metadata.xml"',"Content-Type: text/xml","",c));f.push("--387F8C2A-CFAB-443C-863B-B180E79B05F4--","");e=f.join("\r\n");e={url:b,handleAs:"json",callbackParamName:"callback",preventCache:!0,headers:{"Content-Type":"multipart/form-data; boundary\x3d387F8C2A-CFAB-443C-863B-B180E79B05F4"},postData:e};return this._started||this.startup(),a=new h,m(e,{usePost:!0}).then(k.hitch(this,function(b){a.resolve(b);
null===c?this.emit("metadata-delete",{response:b}):this.emit("metadata-save",{response:b})}),k.hitch(this,function(b){a.reject(b)})),a}});return p("extend-esri")&&k.setObject("dijit.metadata.arcgis.portal.PortalItemAdaptor",l,r),l});