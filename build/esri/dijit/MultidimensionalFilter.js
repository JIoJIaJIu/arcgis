//>>built
require({cache:{"url:esri/dijit/templates/MultidimensionalFilter.html":'\x3cdiv data-dojo-attach-point\x3d"_multidimensionalFilterContainer" class\x3d"esriMultidimensionalFilterContainer"\x3e\n    \x3ctable class\x3d"esriMultidimensionalFilterTable"\x3e\n        \x3ctbody\x3e\n        \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\n        \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\n        \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\n        \x3ctr\x3e\n            \x3ctd colspan\x3d"3"\x3e\n                \x3clabel class\x3d"esriMultidimensionalFilterHeadingLabel" data-dojo-attach-point\x3d"VariableFilterLabel"\x3e${_i18n.widgets.multidimensionalFilter.variableFilter}\n                \x3c/label\x3e\n            \x3c/td\x3e\n        \x3c/tr\x3e\n        \x3ctr\x3e\n            \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"VariableListRow"\x3e\n                \x3cdiv data-dojo-attach-point\x3d"variableList" data-dojo-type\x3d"dijit/form/FilteringSelect" class\x3d"esriMultidimensionalFilterVariableList dijitSelect"\x3e\n                \x3c/div\x3e\n            \x3c/td\x3e\n        \x3c/tr\x3e\n        \x3ctr\x3e\n            \x3ctd colspan\x3d"3" class\x3d"esriMultidimensionalFilterDimensionHeadingLabelTd"\x3e\n                \x3clabel class\x3d"esriMultidimensionalFilterDimensionHeadingLabel" data-dojo-attach-point\x3d"VariableFilterLabel"\x3e${_i18n.widgets.multidimensionalFilter.filterByDimensionalValues}\n                \x3c/label\x3e\n            \x3c/td\x3e\n        \x3c/tr\x3e\n        \x3c/tbody\x3e\n    \x3c/table\x3e\n        \x3cdiv class\x3d"esriMultidimensionalFilterDimensionFilterGrid" data-dojo-attach-point\x3d"dimensionFilterGrid"\x3e\n        \x3c/div\x3e\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-event\x3d"onClick: _onClickApplyMultidimensionalFilter" data-dojo-attach-point\x3d"applyButton"\x3e${_i18n.widgets.multidimensionalFilter.applyLabelTitle}\n      \x3c/div\x3e\n\x3c/div\x3e\n',
"url:esri/dijit/templates/NumericDimensionItem.html":'\x3ctable class\x3d"esriMultidimensionalFilterItemTable"\x3e\n  \x3ctbody\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\n  \x3ctr\x3e\n    \x3ctd colspan\x3d"2"\x3e\n      \x3cinput data-dojo-attach-point\x3d"dimensionCheckbox" name\x3d"dimensionCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onDimensionCheckboxChange" checked/\x3e \x3clabel for\x3d"${dimension}" class\x3d"esriMultidimensionalFilterDimensionText" data-dojo-attach-point\x3d"dimensionAlias"\x3e${dimensionAlias}\x3c/label\x3e \n      \x3cspan data-dojo-attach-point\x3d"dimensionUnit"\x3e\x3c/span\x3e\n      \x3cdiv class\x3d"esriMultidimensionalFilterInfoDiv" id\x3d"${dimension}${id}Info"\x3e\n        \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}Info\',position:[\'after\']"\x3e\n          \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\n            \x3cb\x3e${dimensionAlias}\x3c/b\x3e \n            \x3cspan data-dojo-attach-point\x3d"tooltipUnit"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipNumberFromValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipFromValue"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipNumberToValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipToValue"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipCountText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipValueCount"\x3e\x3c/span\x3e\n            \x3cspan data-dojo-attach-point\x3d"disabledDimText" class\x3d"esriMultidimensionalFilterTooltipDisabledDimensionText"\x3e\x3c/span\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/td\x3e\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"rangeSpan"\x3e\x3cinput data-dojo-attach-point\x3d"rangeCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onRangeCheckboxChange"/\x3e \x3clabel for\x3d"${dimension}RangeCheckbox" class\x3d"rangeText"\x3e${_i18n.widgets.multidimensionalFilter.rangeText}\x3c/label\x3e\n        \x3cdiv class\x3d"esriMultidimensionalFilterRangeInfoDiv" id\x3d"${dimension}${id}hasRangesInfo" data-dojo-attach-point\x3d"hasRangesInfo"\x3e\n          \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}hasRangesInfo\',position:[\'after\']"\x3e\n            \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText1}\x3cbr/\x3e\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText2}\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n  \x3ctr data-dojo-attach-point\x3d"minRow"\x3e\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"minValueText"\x3e${_i18n.widgets.multidimensionalFilter.sliceNumberText}\x3c/span\x3e\x3c/td\x3e\n    \x3ctd colspan\x3d"2"\x3e\n      \x3cspan data-dojo-attach-point\x3d"minNumberSelector"\x3e\x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n  \x3ctr data-dojo-attach-point\x3d"maxRow" class\x3d"esriDomHide"\x3e\n    \x3ctd\x3e${toText}\x3c/td\x3e\n    \x3ctd colspan\x3d"2"\x3e\n      \x3cspan data-dojo-attach-point\x3d"maxNumberSelector"\x3e\x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n\x3c/tbody\x3e\n\x3c/table\x3e',
"url:esri/dijit/templates/TimeDimensionItem.html":'\x3ctable class\x3d"esriMultidimensionalFilterItemTable"\x3e\n  \x3ctbody\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\n  \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\n  \x3ctr\x3e\n    \x3ctd colspan\x3d"2"\x3e\n      \x3cinput data-dojo-attach-point\x3d"dimensionCheckbox" name\x3d"dimensionCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onDimensionCheckboxChange" checked/\x3e \x3clabel for\x3d"${dimension}" class\x3d"esriMultidimensionalFilterDimensionText" data-dojo-attach-point\x3d"dimensionAlias"\x3e${dimensionAlias}\x3c/label\x3e \n      \x3cspan data-dojo-attach-point\x3d"dimensionUnit"\x3e\x3c/span\x3e\n      \x3cdiv class\x3d"esriMultidimensionalFilterInfoDiv" id\x3d"${dimension}${id}Info"\x3e\n        \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}Info\',position:[\'after\']"\x3e\n          \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\n            \x3cb\x3e${dimensionAlias}\x3c/b\x3e\n            \x3cspan data-dojo-attach-point\x3d"tooltipUnit"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipDateFromValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipFromValue"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipDateToValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipToValue"\x3e\x3c/span\x3e\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipCountText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipValueCount"\x3e\x3c/span\x3e\n            \x3cspan data-dojo-attach-point\x3d"disabledDimText" class\x3d"esriMultidimensionalFilterTooltipDisabledDimensionText"\x3e\x3c/span\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/td\x3e\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"rangeSpan"\x3e\x3cinput data-dojo-attach-point\x3d"rangeCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onRangeCheckboxChange"/\x3e \x3clabel for\x3d"${dimension}RangeCheckbox" class\x3d"rangeText"\x3e${_i18n.widgets.multidimensionalFilter.rangeText}\x3c/label\x3e\n        \x3cdiv class\x3d"esriMultidimensionalFilterRangeInfoDiv" id\x3d"${dimension}${id}hasRangesInfo" data-dojo-attach-point\x3d"hasRangesInfo"\x3e\n          \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}hasRangesInfo\',position:[\'after\']"\x3e\n            \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText1}\x3cbr/\x3e\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText2}\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n  \x3ctr data-dojo-attach-point\x3d"minRow"\x3e\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"minDateText"\x3e${_i18n.widgets.multidimensionalFilter.sliceTimeText}\x3c/span\x3e\x3c/td\x3e\n    \x3ctd colspan\x3d"2"\x3e\n      \x3cspan data-dojo-attach-point\x3d"minDateSelector"\x3e\x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n  \x3ctr data-dojo-attach-point\x3d"maxRow" class\x3d"esriDomHide"\x3e\n    \x3ctd\x3e${toText}\x3c/td\x3e\n    \x3ctd  colspan\x3d"2"\x3e\n      \x3cspan data-dojo-attach-point\x3d"maxDateSelector"\x3e\x3c/span\x3e\n    \x3c/td\x3e\n  \x3c/tr\x3e\n\x3c/tbody\x3e\n\x3c/table\x3e',
"url:esri/dijit/templates/PagedDateTimeWidget.html":'\x3cdiv\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsStartButton\', showLabel: false" data-dojo-attach-point\x3d"StartBtn" data-dojo-attach-event\x3d"onClick:_onStartBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.startDateButtonTooltip}\x3c/button\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsPrevButton\', showLabel: false" data-dojo-attach-point\x3d"PreviousBtn" data-dojo-attach-event\x3d"onClick:_onPreviousBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.previousButtonTooltip}\x3c/button\x3e\n  \x3cdiv class\x3d"esriMultidimensionalFilterSelectorDiv"\x3e\x3cspan data-dojo-attach-point\x3d"DateSelector"\x3e\x3c/span\x3e\x3cspan data-dojo-attach-point\x3d"TimeSelector"\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsNextButton\', showLabel: false" data-dojo-attach-point\x3d"NextBtn" data-dojo-attach-event\x3d"onClick:_onNextBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.nextButtonTooltip}\x3c/button\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsEndButton\', showLabel: false" data-dojo-attach-point\x3d"EndBtn" data-dojo-attach-event\x3d"onClick:_onEndBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.endDateButtonTooltip}\x3c/button\x3e\n\x3c/div\x3e',
"url:esri/dijit/templates/PagedNumberWidget.html":'\x3cdiv\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsStartButton\', showLabel: false" data-dojo-attach-point\x3d"StartBtn" data-dojo-attach-event\x3d"onClick:_onStartBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.startNumberButtonTooltip}\x3c/button\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsPrevButton\', showLabel: false" data-dojo-attach-point\x3d"PreviousBtn" data-dojo-attach-event\x3d"onClick:_onPreviousBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.previousButtonTooltip}\x3c/button\x3e\n  \x3cdiv class\x3d"esriMultidimensionalFilterSelectorDiv"\x3e\x3cspan data-dojo-attach-point\x3d"NumberSelector"\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsNextButton\', showLabel: false" data-dojo-attach-point\x3d"NextBtn" data-dojo-attach-event\x3d"onClick:_onNextBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.nextButtonTooltip}\x3c/button\x3e\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsEndButton\', showLabel: false" data-dojo-attach-point\x3d"EndBtn" data-dojo-attach-event\x3d"onClick:_onEndBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.endNumberButtonTooltip}\x3c/button\x3e\n\x3c/div\x3e'}});
define("esri/dijit/MultidimensionalFilter","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/i18n!../nls/jsapi dojo/text!./templates/MultidimensionalFilter.html dojo/text!./templates/NumericDimensionItem.html dojo/text!./templates/TimeDimensionItem.html dojo/text!./templates/PagedDateTimeWidget.html dojo/text!./templates/PagedNumberWidget.html dojo/store/Memory dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DateTextBox dijit/registry dojo/date/locale dojo/dom-style dojo/dom-class ../layers/DimensionalDefinition ../layers/MosaicRule dojo/html dijit/form/FilteringSelect dijit/form/ComboBox dojox/widget/YearlyCalendar dojox/widget/MonthlyCalendar dojox/widget/Calendar3Pane dojo/_base/array ./_EventedWidget dijit/Tooltip dijit/form/CheckBox dijit/form/Button".split(" "),
function(p,q,u,v,w,I,J,x,K,r,L,M,B,C,D,N,O,m,P,k,Q,E,l,R,S,F,G,y,f){var H=p("PagedDimensionWidgetMixin",[B,C,D],{pageCount:100,displayValue:"",dimension:"",_currentIndex:"",values:"",constructor:function(a){p.safeMixin(this,a);this._i18n=v},_checkButtons:function(){var a=this.values,b=this._currentIndex;1===a.length?this._setButtonProperties(!0,!0,!0,!0):0===b?this._setButtonProperties(!0,!0,!1,!1):b===a.length-1?this._setButtonProperties(!1,!1,!0,!0):this._setButtonProperties(!1,!1,!1,!1)},_setButtonProperties:function(a,
b,c,d){this.StartBtn.set("disabled",a);this.PreviousBtn.set("disabled",b);this.NextBtn.set("disabled",c);this.EndBtn.set("disabled",d)},_onStartBtnClick:function(){this._currentIndex=0;this._updateValues()},_onPreviousBtnClick:function(){this._currentIndex--;this._updateValues()},_onNextBtnClick:function(){this._currentIndex++;this._updateValues()},_onEndBtnClick:function(){this._currentIndex=this.values.length-1;this._updateValues()}}),z=p("PagedDateTimeWidget",[H],{dateValue:"",intervalInfo:{},
_fullDateFormat:"yyyy-MM-dd",templateString:x,_setValuesAttr:function(a){var b,c=[];this._set("values",a);this._currentIndex=this.displayValue?f.indexOf(this.values,this.displayValue):0;this.displayValue&&this._set("dateValue",this.displayValue);this._checkButtons();this.dateSelect?(f.forEach(this.values,function(a){c.push({id:a,label:a})},this),b=new r({data:c}),this.dateSelect.set({store:b,value:this.displayValue||this.values[0]}),this.dateSelect.startup()):this._populateValues()},_setDateValueAttr:function(a){a&&
(this._currentIndex=f.indexOf(this.values,a),-1!==this._currentIndex?(this._set("dateValue",a),this._set("displayValue",a)):(this._set("dateValue",this._snapToClosest(a)),this._set("displayValue",this._snapToClosest(a)),this._currentIndex=f.indexOf(this.values,this.dateValue)),this._updateValues())},_getTimeArray:function(){var a,b,c,d,e=[],h=this.values;a=this._currentIndex;c=h[a]-Math.abs(h[a]%864E5);d=c+864E5;for(a=0;a<h.length;a++)if(h[a]>=c&&h[a]<d)b=m.format(this._getUTCTime(new Date(h[a])),
{timePattern:"hh:mm a",selector:"time"}),e.push({id:h[a],label:b});else if(0!==e.length)break;return e},_updateTimeDropDown:function(){var a;a=[];a=this._getTimeArray();this.timeSelect.reset();a=new r({data:a});this.timeSelect.set({store:a,value:this.values[this._currentIndex]})},_populateValues:function(){var a,b,c,d=[];b=this.values;c=m.format(this._getUTCTime(new Date(b[this._currentIndex])),{datePattern:this._fullDateFormat,selector:"date"});d=this._getTimeArray();a=m.format(this._getUTCTime(new Date(b[0])),
{datePattern:this._fullDateFormat,selector:"date"});b=m.format(this._getUTCTime(new Date(b[b.length-1])),{datePattern:this._fullDateFormat,selector:"date"});this.dateSelect=new N({value:c,constraints:{min:a,max:b},popupClass:y,style:"width:95px;","class":"dijitSelect esriMultidimensionalFilterVariableList"},this.DateSelector);this.dateSelect.startup();this.dateSelect.on("change",q.hitch(this,this._dateBoxChange));a=new r({data:d});this.timeSelect=new R({store:a,value:this.displayValue,labelAttr:"label",
labelType:"text",searchAttr:"label",style:"width:85px;","class":"dijitSelect esriMultidimensionalFilterVariableList",maxHeight:-1},this.TimeSelector);this.timeSelect.startup();this.timeSelect.on("change",q.hitch(this,this._timeValueChange));this._checkCalendarControlView()},_checkCalendarControlView:function(){var a,b,c,d,e,h=[],g=[],n=[],t=this.values;a=this.intervalInfo;if(a.intervalUnit)"years"==a.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",F),k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):
"months"==a.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",G),k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):"days"==a.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",y),k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):this.dateSelect.set("popupClass",y);else{e=12>t.length?t.length:12;for(d=0;e>d;d++)a=m.format(this._getUTCTime(new Date(t[d])),{datePattern:"yyyy",selector:"date"}),b=m.format(this._getUTCTime(new Date(t[d])),{datePattern:"yyyyMM",
selector:"date"}),c=m.format(this._getUTCTime(new Date(t[d])),{timePattern:"HH:mm",selector:"time"}),-1===f.indexOf(g,a)&&g.push(a),-1===f.indexOf(n,b)&&n.push(b),-1===f.indexOf(h,c)&&h.push(c);g.length===e?(this.dateSelect.set("popupClass",F),k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):n.length===e?(this.dateSelect.set("popupClass",G),k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):(this.dateSelect.set("popupClass",y),1===h.length&&k.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone"))}},
_timeValueChange:function(a){a&&(this._currentIndex=f.indexOf(this.values,a),this._set("dateValue",a),this._set("displayValue",a),this._checkButtons())},_updateValues:function(){var a;a=m.format(this._getUTCTime(new Date(this.values[this._currentIndex])),{datePattern:this._fullDateFormat,selector:"date"});this.dateSelect.set("_onChangeActive",!1);this.dateSelect.set("value",a,!1);this.dateSelect.set("_onChangeActive",!0);this._updateTimeDropDown();this._checkButtons()},_getUTCTime:function(a){return a&&
a.setTime(a.getTime()+6E4*a.getTimezoneOffset()),a},_snapToClosest:function(a){var b,c,d,e,h,g=0,n=0,f=this.values;a=new Date(a);a=a.getTime()-6E4*a.getTimezoneOffset();b=Math.abs(a-f[0]);c=Math.abs(a-f[0]);e=f[0];for(h=1;h<f.length;h++)d=f[h]-a,0>d?Math.abs(d)<c&&(c=Math.abs(d),g=h):b>d&&(b=d,n=h);return 86399999>b||c>b?(e=f[n],this._currentIndex=n):(e=f[g],this._currentIndex=g),e},_dateBoxChange:function(a){var b,c,d,e=[];a&&(b=(new Date(a)).getTime(),c=this._snapToClosest(parseInt(b,10)),this.dateSelect.set("_onChangeActive",
!1),this.dateSelect.set("value",m.format(this._getUTCTime(new Date(c)),{datePattern:this._fullDateFormat,selector:"date"})),this.dateSelect.set("_onChangeActive",!0),m.format(this._getUTCTime(new Date(c)),{datePattern:this._fullDateFormat,selector:"date"})!=m.format(new Date(b),{datePattern:this._fullDateFormat,selector:"date"})&&(this.dateSelect.focus(),this.dateSelect.set("message",this._i18n.widgets.multidimensionalFilter.dateSnapText)),e=this._getTimeArray(),this.timeSelect.reset(),d=new r({data:e}),
this.timeSelect.set({store:d,value:e[0].id}),this._checkButtons())}}),A=p("PagedNumberWidget",[H],{numValue:"",templateString:K,_setValuesAttr:function(a){var b,c=[];this._set("values",a);this.displayValue||0===this.displayValue?(this._currentIndex=f.indexOf(this.values,this.displayValue),this._set("numValue",this.displayValue)):this._currentIndex=0;this._checkButtons();this.numSelect?(f.forEach(this.values,function(a){c.push({id:a,label:a})},this),b=new r({data:c}),this._currentIndex=this.displayValue?
f.indexOf(this.values,this.displayValue):0,this.numSelect.set({store:b,value:this.displayValue||this.values[0]}),this.numSelect.startup()):this._populateValues()},_setNumValueAttr:function(a){(a||0===a)&&(this._currentIndex=f.indexOf(this.values,a),-1!==this._currentIndex?(this._set("numValue",a),this._set("displayValue",a)):(this._set("numValue",this._snapToClosest(a)),this._set("displayValue",this._snapToClosest(a)),this._currentIndex=f.indexOf(this.values,this.numValue)),this._updateValues())},
_populateValues:function(){var a,b=[];f.forEach(this.values,function(a){b.push({id:a,label:a})},this);a=new r({data:b});this.numSelect=new S({store:a,value:this.displayValue,labelAttr:"label",labelType:"text",searchAttr:"label",pageSize:this.pageCount,scrollOnFocus:!0,style:"width:95px;","class":"dijitSelect esriMultidimensionalFilterVariableList",maxHeight:-1},this.NumberSelector);this.numSelect.startup();this.numSelect.on("change",q.hitch(this,this._numValueChange))},_snapToClosest:function(a){var b,
c,d,e,h=this.values;b=Math.abs(a-h[0]);d=h[0];for(e=1;e<h.length;e++)c=Math.abs(a-h[e]),b>c&&(b=c,d=h[e],this._currentIndex=e);return d},_numValueChange:function(a){var b;a&&(b=this._snapToClosest(a),this.numSelect.set("_onChangeActive",!1),this.numSelect.set("value",b),this.numSelect.set("_onChangeActive",!0),a!=b&&(this.numSelect.focus(),this.numSelect.set("message",this._i18n.widgets.multidimensionalFilter.numSnapText)),this._currentIndex=f.indexOf(this.values,b),this._set("numValue",b),this._set("displayValue",
b),this._checkButtons())},_updateValues:function(){this.numSelect.set("value",this.values[this._currentIndex]);this._checkButtons()}});x=p("DimensionItemMixin",[B,C,D],{dimension:"",fromText:"",toText:"",valueCount:"",values:[],dimensionAlias:"",unit:"",disabled:!1,intervalInfo:{},_unitString:"",_unitReplaceString:"",_disabledDimensionText:"",_valueFieldString:"",_selectWidgetNameString:"",_onDimensionCheckboxChange:function(a){this.hasRanges?a?(k.replace(this.maxRow,"esriRowShow","esriDomHide"),
k.replace(this.minRow,"esriRowShow","esriDomHide"),k.replace(this.rangeSpan,"esriInlineShow","esriDomHide")):(k.replace(this.maxRow,"esriDomHide","esriRowShow"),k.replace(this.minRow,"esriDomHide","esriRowShow"),k.replace(this.rangeSpan,"esriDomHide","esriInlineShow")):a?(this.rangeCheckbox.get("checked")?k.replace(this.maxRow,"esriRowShow","esriDomHide"):k.replace(this.maxRow,"esriDomHide","esriRowShow"),k.replace(this.minRow,"esriRowShow","esriDomHide"),k.replace(this.rangeSpan,"esriInlineShow",
"esriDomHide")):(k.replace(this.maxRow,"esriDomHide","esriRowShow"),k.replace(this.minRow,"esriDomHide","esriRowShow"),k.replace(this.rangeSpan,"esriDomHide","esriInlineShow"))},_setDisabledAttr:function(a){this._set("disabled",a);a?(this.dimensionCheckbox.set("checked",!1),this.dimensionCheckbox.set("disabled",!0),k.replace(this.dimensionAlias,"esriDisabled","esriEnabled"),k.replace(this.dimensionUnit,"esriDisabled","esriEnabled"),l.set(this.disabledDimText,"\x3cbr/\x3e"+this._disabledDimensionText)):
(this.dimensionCheckbox.set("checked",!0),this.dimensionCheckbox.set("disabled",!1),k.replace(this.dimensionAlias,"esriEnabled","esriDisabled"),k.replace(this.dimensionUnit,"esriEnabled","esriDisabled"),l.set(this.disabledDimText,""))},_createNewValues:function(){var a=[],b=[],c={};f.forEach(this.values,function(d){-1===f.indexOf(a,d[0])&&a.push(d[0]);-1===f.indexOf(a,d[1])&&a.push(d[1]);-1===f.indexOf(b,d[0])?(b.push(d[0]),c[d[0]]=[],c[d[0]].push(d[1])):c[d[0]].push(d[1])},this);a.sort(function(a,
b){return a-b});this._distinctRangeValues=a;this._rangeStartArray=b;this._rangeEndArrayMap=c},_setUnitAttr:function(a){a&&(-1<a.indexOf(this._unitString)&&(this.unit=a.replace(this._unitString,this._unitReplaceString)),l.set(this.dimensionUnit,"("+this.unit+")"),l.set(this.tooltipUnit,"\x3cbr/\x3e   \x3cspan class\x3d'esriMultidimensionalFilterTooltipLeftText'\x3eUnit:\x3c/span\x3e "+this.unit))},_refreshMaxBox:function(a){this.rangeCheckbox.get("checked")||this.maxBox.set({displayValue:this._rangeEndArrayMap[a][0],
values:this._rangeEndArrayMap[a]})},getDimensionCheckboxValue:function(){return this.dimensionCheckbox.get("checked")},setDimensionCheckboxValue:function(a){this.dimensionCheckbox.set("checked",a)},getRangeCheckboxValue:function(){return this.rangeCheckbox.get("value")},setRangeCheckboxValue:function(a){this.rangeCheckbox.set("value",a)},getMinValue:function(){return this.minBox.get(this._valueFieldString)},setMinValue:function(a){this.minBox.set(this._valueFieldString,a)},getMaxValue:function(){return this.maxBox.get(this._valueFieldString)},
setMaxValue:function(a){this.maxBox.set(this._valueFieldString,a)},isMinBoxSupportedValue:function(a){return this.minBox[this._selectWidgetNameString].isValid(a)?!0:!1},isMaxBoxSupportedValue:function(a){return this.maxBox[this._selectWidgetNameString].isValid(a)?!0:!1}});var T=p("DateItem",[x],{fromDateValue:"",toDateValue:"",_unitString:"ISO8601",_unitReplaceString:"UTC",_valueFieldString:"dateValue",_selectWidgetNameString:"timeSelect",templateString:J,constructor:function(a){p.safeMixin(this,
a);this._i18n=v;this.fromText=this._i18n.widgets.multidimensionalFilter.fromTimeText;this.toText=this._i18n.widgets.multidimensionalFilter.toTimeText;this._disabledDimensionText=this._i18n.widgets.multidimensionalFilter.disabledTimeDimensionText},_onRangeCheckboxChange:function(a){if(this.hasRanges){var b=this.minBox.dateSelect.value;a?(k.replace(this.hasRangesInfo,"esriRangeInfoHide","esriRangeInfoVisible"),this.minBox.set({displayValue:b,values:this._distinctRangeValues}),this.maxBox.set({displayValue:this._distinctRangeValues[this._distinctRangeValues.length-
1],values:this._distinctRangeValues})):(k.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide"),-1<f.indexOf(this._rangeStartArray,b)&&(this.minBox.set({displayValue:b,values:this._rangeStartArray}),this.maxBox.set({displayValue:this._rangeEndArrayMap[b][0],values:this._rangeEndArrayMap[b]})))}else a?(k.replace(this.maxRow,"esriRowShow","esriDomHide"),l.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.fromTimeText)):(k.replace(this.maxRow,"esriDomHide","esriRowShow"),
l.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.sliceTimeText));this.emit("range-rendered",{})},_updateTooltip:function(){var a=this.values,b=this._distinctRangeValues;this.hasRanges?(this.fromValue=m.format(this._getUTCTime(new Date(b[0])),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),this.toValue=m.format(this._getUTCTime(new Date(b[b.length-1])),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),this.valueCount=a.length):(this.fromValue=m.format(this._getUTCTime(new Date(a[0])),
{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),this.toValue=m.format(this._getUTCTime(new Date(a[a.length-1])),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),this.valueCount=a.length);l.set(this.tooltipFromValue,this.fromValue.toString());l.set(this.tooltipToValue,this.toValue.toString());l.set(this.tooltipValueCount,this.valueCount.toString())},_setValuesAttr:function(a){this.values=a;this.hasRanges?(this._createNewValues(),this._updateTooltip(),this._set("values",this._distinctRangeValues),
this.minBox=new z({values:this._rangeStartArray,dimension:this.dimension,displayValue:this._rangeStartArray[0],intervalInfo:this.intervalInfo},this.minDateSelector),this.minBox.startup(),this.minBox.dateSelect.on("change",q.hitch(this,this._refreshMaxBox)),this.maxBox=new z({values:this._rangeEndArrayMap[this._rangeStartArray[0]],dimension:this.dimension,displayValue:this._rangeEndArrayMap[this._rangeStartArray[0]][this._rangeEndArrayMap[this._rangeStartArray[0]].length-1],intervalInfo:this.intervalInfo},
this.maxDateSelector),this.maxBox.startup(),l.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.fromTimeText),k.replace(this.maxRow,"esriRowShow","esriDomHide"),k.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide")):(this._set("values",a),this._updateTooltip(),this.minBox=new z({values:a,dimension:this.dimension,displayValue:a[0],intervalInfo:this.intervalInfo},this.minDateSelector),this.minBox.startup(),this.maxBox=new z({values:a,dimension:this.dimension,displayValue:a[a.length-
1],intervalInfo:this.intervalInfo},this.maxDateSelector),this.maxBox.startup())},_getUTCTime:function(a){return a&&a.setTime(a.getTime()+6E4*a.getTimezoneOffset()),a}}),U=p("NumericItem",[x],{_unitString:"esri",_unitReplaceString:"",_valueFieldString:"numValue",_selectWidgetNameString:"numSelect",templateString:I,constructor:function(a){p.safeMixin(this,a);this._i18n=v;this.fromText=this._i18n.widgets.multidimensionalFilter.fromNumericText;this.toText=this._i18n.widgets.multidimensionalFilter.toNumericText;
this._disabledDimensionText=this._i18n.widgets.multidimensionalFilter.disabledNumericDimensionText},_onRangeCheckboxChange:function(a){if(this.hasRanges){var b=this.minBox.numSelect.value;a?(k.replace(this.hasRangesInfo,"esriRangeInfoHide","esriRangeInfoVisible"),this.minBox.set({displayValue:b,values:this._distinctRangeValues}),this.maxBox.set({displayValue:this._distinctRangeValues[this._distinctRangeValues.length-1],values:this._distinctRangeValues})):(k.replace(this.hasRangesInfo,"esriRangeInfoVisible",
"esriRangeInfoHide"),-1<f.indexOf(this._rangeStartArray,b)&&(this.minBox.set({displayValue:b,values:this._rangeStartArray}),this.maxBox.set({displayValue:this._rangeEndArrayMap[b][0],values:this._rangeEndArrayMap[b]})));this.emit("range-rendered",{})}else a?(k.replace(this.maxRow,"esriRowShow","esriDomHide"),l.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.fromNumericText)):(k.replace(this.maxRow,"esriDomHide","esriRowShow"),l.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.sliceNumberText))},
_updateTooltip:function(){var a=this.values,b=this._distinctRangeValues;this.hasRanges?(this.fromValue=b[0],this.toValue=b[b.length-1],this.valueCount=a.length):(this.fromValue=a[0],this.toValue=a[a.length-1],this.valueCount=a.length);l.set(this.tooltipFromValue,this.fromValue.toString());l.set(this.tooltipToValue,this.toValue.toString());l.set(this.tooltipValueCount,this.valueCount.toString())},_setValuesAttr:function(a){this.values=a;this.hasRanges?(this._createNewValues(),this._updateTooltip(),
this._set("values",this._distinctRangeValues),this.minBox=new A({values:this._rangeStartArray,dimension:this.dimension,displayValue:this._rangeStartArray[0],intervalInfo:this.intervalInfo},this.minNumberSelector),this.minBox.startup(),this.minBox.numSelect.on("change",q.hitch(this,this._refreshMaxBox)),this.maxBox=new A({values:this._rangeEndArrayMap[this._rangeStartArray[0]],dimension:this.dimension,displayValue:this._rangeEndArrayMap[this._rangeStartArray[0]][this._rangeEndArrayMap[this._rangeStartArray[0]].length-
1],intervalInfo:this.intervalInfo},this.maxNumberSelector),this.maxBox.startup(),l.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.fromNumericText),k.replace(this.maxRow,"esriRowShow","esriDomHide"),k.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide")):(this._set("values",a),this._updateTooltip(),this.minBox=new A({values:a,dimension:this.dimension,displayValue:a[0],intervalInfo:this.intervalInfo},this.minNumberSelector),this.minBox.startup(),this.maxBox=new A({values:a,
dimension:this.dimension,displayValue:a[a.length-1],intervalInfo:this.intervalInfo},this.maxNumberSelector),this.maxBox.startup())}});w=p([B,C,D],{declaredClass:"esri.dijit.MultidimensionalFilter",templateString:w,widgetsInTemplate:!0,layer:null,map:null,hideApplyButton:!1,_multidimensionalInfo:null,_variableStore:null,_variableData:[],_dimensionStore:null,_savedMultidimensionalDefinition:null,_dimensionWithRanges:[],_dimensionWidgets:{},reset:0,constructor:function(a){p.safeMixin(this,a);this._i18n=
v},startup:function(){this.inherited(arguments);u.subscribe("onMultidimensionalFilterApply",q.hitch(this,"_onClickApplyMultidimensionalFilter"));u.subscribe("onMultidimensionalFilterReset",q.hitch(this,"_onClickResetMultidimensionalFilter"))},postCreate:function(){u.connect(this.variableList,"onChange",q.hitch(this,"_onVariableListChange"));this.hideApplyButton&&P.set(this.applyButton.domNode,"display","none")},destroy:function(){this.inherited(arguments)},_setLayerAttr:function(a){if(a){this.inherited(arguments);
this._dimensionStore=this._cachedDimensions=null;this._set("layer",a);var b=q.hitch(this,"_setupDefaults");this.layer.loaded?this._setupDefaults():u.connect(this.layer,"onLoad",b)}},_setupDefaults:function(){this.layer.getMultidimensionalInfo().then(q.hitch(this,function(a){this._multidimensionalInfo=a;this._setupVariableFilterDefaults()}),function(a){console.log(a)});this.layer.getDefaultMultidimensionalDefinition().then(q.hitch(this,function(a){this.defaultMultidimensionalDefinition=a}),function(a){console.log(a)})},
_computeDimensionUnion:function(a){var b,c,d,e,h,g,n,k,l=[],m=[],p=[];if(a){for(b=0;b<a.length;b++)for(h=a[b].dimensions,c=0;c<h.length;c++){g=h[c];for(d=e=0;d<l.length;d++)if(g.name==l[d].name){if(n=l[d].values,k=g.values,g.hasRanges){for(e=0;e<n.length;e++)m.push(n[e][0]),p.push(n[e][1]);for(e=0;e<k.length;e++)-1!==f.indexOf(m,k[e][0])&&-1!==f.indexOf(p,k[e][1])||n.push(k[e])}else for(e=0;e<k.length;e++)-1===f.indexOf(n,k[e])&&n.push(k[e]);e=1}e||l.push(q.clone(g));g.hasRanges&&-1===f.indexOf(this._dimensionWithRanges,
g.name)&&this._dimensionWithRanges.push(g.name)}return 0<this._dimensionWithRanges.length&&(l=this._convertSliceToRange(this._dimensionWithRanges,l)),this._sortDimensionValues(l)}},_sortDimensionValues:function(a){return f.forEach(a,function(a){a&&a.values&&(a.values=a.hasRanges?this._sortRangeDimensionValues(a.values):this._sortNoRangeDimensionValues(a.values))},this),a},_sortRangeDimensionValues:function(a){var b,c=[],d=[],e={},h={},g=[];return f.forEach(a,function(a){-1===f.indexOf(c,a[0])?(c.push(a[0]),
e[a[0]]=[],e[a[0]].push(a)):e[a[0]].push(a)},this),c=c.sort(function(a,b){return a-b}),f.forEach(c,function(a){if(1===e[a].length)g.push(e[a][0]);else{d=[];h={};for(b=0;b<e[a].length;b++)d.push(e[a][b][1]),h[e[a][b][1]]=e[a][b];d=d.sort(function(a,b){return a-b});for(b=0;b<d.length;b++)g.push(h[d[b]])}}),g},_sortNoRangeDimensionValues:function(a){return a.sort(function(a,c){return a-c})},_convertSliceToRange:function(a,b){var c=[];return f.forEach(b,function(b){-1!==f.indexOf(a,b.name)&&(b.hasRanges=
!0,c=[],f.forEach(b.values,function(a){a instanceof Array?(c.push(a),b.extent[0]>a[0]?b.extent[0]=a[0]:b.extent[1]<a[0]&&(b.extent[1]=a[0]),b.extent[0]>a[1]?b.extent[0]=a[1]:b.extent[1]<a[1]&&(b.extent[1]=a[1])):(c.push([a,a]),b.extent[0]>a?b.extent[0]=a:b.extent[1]<a&&(b.extent[1]=a))},this),b.values=c)},this),b},_setupVariableFilterDefaults:function(){var a,b=this._multidimensionalInfo.variables,c=this.layer.mosaicRule;this.layer&&this._multidimensionalInfo&&b&&(this._variableData=[],this._variableData.push({name:this._i18n.widgets.multidimensionalFilter.defaultVariableText,
label:"\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cb\x3e"+this._i18n.widgets.multidimensionalFilter.defaultVariableText+"\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:50ex'\x3e\x3ci\x3eNo user-defined restriction on Variable.\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html",dimensions:this._computeDimensionUnion(b)}),f.forEach(b,function(b){a=b.unit?b.name+" ("+b.unit+")":
b.name;this._variableData.push({name:b.name,dimensions:b.dimensions,description:b.description,label:"\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cb\x3e"+a+"\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:50ex'\x3e\x3ci\x3e"+b.description+"\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html\x3e"})},this),this._variableStore=new r({data:this._variableData,idProperty:"name"}),this.variableList.reset(),
this.variableList.set({store:this._variableStore,labelAttr:"label",labelType:"html",value:this._variableData[0].name}),this._savedMultidimensionalDefinition=null,c&&c.multidimensionalDefinition&&0<c.multidimensionalDefinition.length&&(this._savedMultidimensionalDefinition=c.multidimensionalDefinition,this._setVariableValueDefault()))},_setVariableValueDefault:function(){var a,b=this._savedMultidimensionalDefinition[0];b.variableName&&(a=""==b.variableName?this._i18n.widgets.multidimensionalFilter.defaultVariableText:
b.variableName,this.variableList&&this.reset&&1===this.reset?a!=this.variableList.get("value")?this.variableList.set("value",a):this._onVariableListChange():this.variableList.set("value",a))},_setCachedDimensionProperties:function(){var a,b,c;for(a in this._cachedDimensions)this._cachedDimensions.hasOwnProperty(a)&&(b=a,this._dimensionWidgets[b]&&(c=this._dimensionWidgets[b],this._cachedDimensions[a].selected=c.getDimensionCheckboxValue(),this._cachedDimensions[a].isSlice=!c.getRangeCheckboxValue(),
this._cachedDimensions[a].values=[Number(c.getMinValue()),Number(c.getMaxValue())]))},_onVariableListChange:function(){var a,b=this.variableList.get("value"),c=this._variableStore.query({name:b})[0].dimensions,d=this._variableData[0],e=this._savedMultidimensionalDefinition;!this._cachedDimensions&&this._dimensionStore&&(this._cachedDimensions={},f.forEach(d.dimensions,function(a){this._cachedDimensions[a.field]={}},this));this._cachedDimensions&&this._setCachedDimensionProperties();this._dimensionStore=
null;this._dimensionStore=new r({data:c,idProperty:"name"});this._createDimensionWidgets();this._cachedDimensions?this._displayCachedProperties():e&&0<e.length&&(a=""==e[0].variableName?this._i18n.widgets.multidimensionalFilter.defaultVariableText:e[0].variableName,b==a&&this._setDimensionDefaults())},_createDimensionWidgets:function(){var a,b,c,d,e,h;this._destroyDimensionWidgets();f.forEach(this._dimensionStore.data,function(g){a=g.field;d={hasRegularIntervals:g.hasRegularIntervals,interval:g.interval,
intervalUnit:g.intervalUnit};h=g.hasRanges||!1;"StdTime"==a?(b=new T({dimension:g.name,hasRanges:h,dimensionAlias:this._returnFieldAlias(g.name),unit:g.unit,disabled:this.layer.useMapTime,intervalInfo:d,values:g.values}),b.placeAt(this.dimensionFilterGrid),this._dimensionWidgets[g.name]=b):"StdTime"!=a&&(e=this._isActiveDimension(g.name),c=new U({dimension:g.name,hasRanges:h,dimensionAlias:this._returnFieldAlias(g.name),unit:g.unit,disabled:e,intervalInfo:d,values:g.values}),c.placeAt(this.dimensionFilterGrid),
this._dimensionWidgets[g.name]=c)},this);this._dimensionWidgets.StdTime.setDimensionCheckboxValue(!1)},_getUTCTime:function(a){return a&&a.setTime(a.getTime()+6E4*a.getTimezoneOffset()),a},_destroyDimensionWidgets:function(){var a=O.findWidgets(this.dimensionFilterGrid);f.forEach(a,function(a){a.destroyRecursive()});this._dimensionWidgets={}},_displayCachedProperties:function(){var a,b,c,d,e,h,g=this._cachedDimensions;f.forEach(this._dimensionStore.data,function(f){a=0;for(b in g)if(g.hasOwnProperty(b)&&
b==f.name&&g[b].values){a=1;c=b;d=g[b].isSlice;e=g[b].values;h=g[b].selected;break}a?(-1<c.toLowerCase().indexOf("time")&&!this.layer.useMapTime||-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c))&&this._updateDimensionValues(c,h,d,e[0],e[1]):(c=f.name,(-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c)||-1<c.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&this._updateDimensionValues(c,!1,!0,f.extent[0],f.extent[1]))},this)},_isActiveDimension:function(a){return this.layer.activeMapDimensions&&
0<this.layer.activeMapDimensions.length&&-1<f.indexOf(this.layer.activeMapDimensions,a)},_setDimensionDefaults:function(){var a,b,c,d,e=this._savedMultidimensionalDefinition,h=0;f.forEach(this._dimensionStore.data,function(g){a=0;f.forEach(e,function(e){e.dimensionName!=g.name||(a=1,b=e.dimensionName,c=e.isSlice,d=e.values[1]?e.values:e.values[0],d.length||(d=[d]),this._dimensionWidgets[b].isMinBoxSupportedValue(d[0])&&(2!==d.length||this._dimensionWidgets[b].isMaxBoxSupportedValue(d[1]))||(h=1))},
this);a?(-1<b.toLowerCase().indexOf("time")&&!this.layer.useMapTime||-1===b.toLowerCase().indexOf("time")&&!this._isActiveDimension(b))&&(c&&-1==f.indexOf(this._dimensionWithRanges,b)?this._updateDimensionValues(b,!0,c,d[0],g.extent[1]):this._updateDimensionValues(b,!0,c,d[0],d[1])):(b=g.name,(-1===b.toLowerCase().indexOf("time")&&!this._isActiveDimension(b)||-1<b.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&this._updateDimensionValues(b,!1,!0,g.extent[0],g.extent[1]))},this);h&&this._onClickApplyMultidimensionalFilter();
this.reset=0},_updateDimensionValues:function(a,b,c,d,e){var f=this._dimensionWidgets[a],g=null;f.getRangeCheckboxValue()===c&&(g||(g=f.on("range-rendered",function(){f.setMinValue(d);f.setMaxValue(e);g.remove();g=null})),f.setRangeCheckboxValue(!c));f.setMinValue(d);f.setMaxValue(e);f.setDimensionCheckboxValue(b)},_returnFieldAlias:function(a){var b;return f.forEach(this.layer.fields,function(c){c.name.toLowerCase()==a.toLowerCase()&&(b=c.alias)},this),b||a},_onClickApplyMultidimensionalFilter:function(){var a,
b,c,d,e,h,g,k=this._dimensionWidgets,l=this.layer.mosaicRule,m=[];for(a in k)k.hasOwnProperty(a)&&k[a].getDimensionCheckboxValue()&&m.push(a);b=[];c=this.variableList.get("value")==this._i18n.widgets.multidimensionalFilter.defaultVariableText?"":this.variableList.get("value");f.forEach(m,function(a){d=a;g=this._dimensionWidgets[d];e=g.getRangeCheckboxValue()?[[Number(g.getMinValue()),Number(g.getMaxValue())]]:-1<f.indexOf(this._dimensionWithRanges,d)&&""==c||g.hasRanges&&""!=c?[[Number(g.getMinValue()),
Number(g.getMaxValue())]]:[Number(g.getMinValue())];(-1===d.toLowerCase().indexOf("time")&&!this._isActiveDimension(d)||-1<d.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&b.push(new Q({variableName:c,dimensionName:d,isSlice:!g.getRangeCheckboxValue(),values:e}))},this);l&&l.multidimensionalDefinition&&f.forEach(l.multidimensionalDefinition,function(a){d=a.dimensionName;-1===d.toLowerCase().indexOf("time")&&this._isActiveDimension(d)&&b.push(a)},this);l?(h=l,h.multidimensionalDefinition=
b):this.layer.defaultMosaicRule?(h=this.layer.defaultMosaicRule,h.multidimensionalDefinition=b):h=new E({multidimensionalDefinition:[]});this.layer.setMosaicRule(h)},_onClickResetMultidimensionalFilter:function(){var a,b,c=this.layer.mosaicRule,d=[];this.defaultMultidimensionalDefinition&&0===this.reset&&(this.reset=1,this._cachedDimensions=null,f.forEach(this.defaultMultidimensionalDefinition,function(b){a=b.dimensionName;(-1===a.toLowerCase().indexOf("time")&&!this._isActiveDimension(a)||-1<a.toLowerCase().indexOf("time")&&
!this.layer.useMapTime)&&d.push(b)},this),c&&c.multidimensionalDefinition&&f.forEach(c.multidimensionalDefinition,function(b){a=b.dimensionName;-1===a.toLowerCase().indexOf("time")&&this._isActiveDimension(a)&&d.push(b)},this),0===d.length&&(d=this.defaultMultidimensionalDefinition),c?(b=c,b.multidimensionalDefinition=d):this.layer.defaultMosaicRule?(b=this.layer.defaultMosaicRule,b.multidimensionalDefinition=d):b=new E({multidimensionalDefinition:[]}),this.layer.setMosaicRule(b),this._savedMultidimensionalDefinition=
d,this._savedMultidimensionalDefinition&&(this._dimensionStore=null,this._setVariableValueDefault()))}});return L("extend-esri")&&q.setObject("dijit.MultidimensionalFilter",w,M),w});