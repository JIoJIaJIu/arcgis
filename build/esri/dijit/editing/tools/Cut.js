//>>built
define("esri/dijit/editing/tools/Cut","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(d,e,c,g,h,n,p,k,q,r,t,u,v,w){d=d([v],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:t.POLYLINE,
_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(g.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);c.forEach(this._cutConnects,g.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(x){var f=this._cutLayers=c.filter(this._settings.layers,function(a){return"esriGeometryPolygon"===a.geometryType||"esriGeometryPolyline"===a.geometryType&&a.visible&&a._isMapAtVisibleScale()});
this._cutConnects=this._cutConnects.concat(c.map(f,e.hitch(this,function(a){return g.connect(a,"onEditsComplete",e.hitch(this,function(){if(this._settings.undoRedoManager){var a=this._settings.undoRedoManager;c.forEach(this._edits,e.hitch(this,function(b){a.add(new u({featureLayer:b.layer,addedGraphics:b.adds,preUpdatedGraphics:b.preUpdates,postUpdatedGraphics:b.updates}))}),this)}this.onFinished()}))})));var b=new q;b.geometry=x;c.forEach(f,function(a){this._settings.editor._selectionHelper.selectFeatures([a],
b,r.SELECTION_NEW,e.hitch(this,"_cutFeatures",a,b))},this)},_cutFeatures:function(c,f,b){if(b&&b.length){this._edits=[];var a=[];a.push(this._settings.geometryService.cut(p.getGeometries(b),f.geometry,e.hitch(this,"_cutHandler",c,b)));(new n(a)).addCallback(e.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(d,f,b){var a,g,l=[],m=[],h=c.map(f,function(a){return new k(e.clone(a.toJson()))});c.forEach(b.cutIndexes,function(c,d){a!=c?(a=c,m.push(f[c].setGeometry(b.geometries[d]))):
(g=new k(b.geometries[d],null,e.mixin({},f[c].attributes),null),g.attributes[f[0].getLayer().objectIdField]=null,l.push(g))},this);this._edits.push({layer:d,adds:l,updates:m,preUpdates:h})}});return h("extend-esri")&&e.setObject("dijit.editing.tools.Cut",d,w),d});