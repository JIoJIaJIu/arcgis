//>>built
define("esri/dijit/Attribution","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),function(r,n,h,m,y,z,F,A,t,u,q,p,v,B,w,C,D,E){r=r(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",
lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(c,b){try{n.mixin(this,c);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];var a=this.domNode=A.byId(b),e=this.map,d="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";if(a&&(t.set(a,"innerHTML",d),this.listNode=y.query(".esriAttributionList",a)[0],this.itemNodes={}),this._eventConnections=[m.connect(e,"onLayerAdd",this,this._onLayerAdd),m.connect(e,"onLayerRemove",
this,this._onLayerRemove),m.connect(e,"onLayerSuspend",this,this._onLayerSuspend),m.connect(e,"onLayerResume",this,this._onLayerResume),m.connect(e,"onExtentChange",this,this._onExtentChange)],e.loaded){var f,g,k=e.layerIds.concat(e.graphicsLayerIds),l=k.length;for(g=0;l>g;g++)f=e.getLayer(k[g]),f.loaded&&this._onLayerAdd(f)}}catch(h){}},startup:function(){},destroy:function(){h.forEach(this._eventConnections,m.disconnect);u.destroy(this.listNode);this.map=this.domNode=this._eventConnections=this.listNode=
this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=null},_onLayerAdd:function(c){try{var b=this._attributions,a=c.id;if(!w.isDefined(b[a])&&c.showAttribution)if(c.hasAttributionData){var e=c.getAttributionData();this._pendingDfds[a]=1;b[a]=e;e.addBoth(n.partial(this._onAttributionLoad,this,c))}else b[a]=c.copyright||c.copyrightText||"",b[a]?(c.suspended||this._activeLayers.push(a),this._createNode(a)):this._onLayerRemove(c)}catch(d){}},_onAttributionLoad:function(c,
b,a){var e=c._attributions,d=c._pendingDfds,f=b.id;d&&d[f]&&(delete d[f],(!a||a instanceof Error)&&(a=""),e[f]=a?c._createIndexByLevel(a,-1!==b.declaredClass.toLowerCase().indexOf("vetiledlayer")):b.copyright||b.copyrightText||"",e[f]?(b.suspended||c._activeLayers.push(f),c._createNode(f)):c._onLayerRemove(b))},_onLayerRemove:function(c){try{var b,a=c.id,e=this.itemNodes,d=-1;this._onLayerSuspend(c);delete this._attributions[a];delete this._pendingDfds[a];b=this._getGroupIndex(a);-1!==b&&(d=h.indexOf(this._sharedLayers[b],
a),-1!==d&&(this._sharedLayers[b].splice(d,1),1>=this._sharedLayers[b].length&&this._sharedLayers.splice(b,1)));e[a]&&-1===d&&u.destroy(e[a]);delete e[a];this._updateLastItem()}catch(f){}},_onLayerSuspend:function(c){try{var b=c.id;if(this._attributions[b]){var a=h.indexOf(this._activeLayers,b),e=this.itemNodes[b];-1!==a&&this._activeLayers.splice(a,1);e&&this._toggleItem(e,!1,this._getGroupIndex(b))}}catch(d){}},_onLayerResume:function(c){try{var b=c.id,a=this._attributions[b],e=this.itemNodes[b];
if(a&&(-1===h.indexOf(this._activeLayers,b)&&this._activeLayers.push(b),e)){var d=n.isString(a)?a:this._getContributorsList(a,this.map.extent,this.map.getLevel());n.isString(a)||t.set(e,"innerHTML",d?d+this._getDelimiter():"");d&&this._toggleItem(e,!0,this._getGroupIndex(b))}}catch(f){}},_onExtentChange:function(c,b,a,e){try{var d,f,g,k,l=this._activeLayers,h=this._attributions,p=this.itemNodes,m=l.length||0;for(k=0;m>k;k++)if(f=l[k],g=h[f],d=p[f],d&&!n.isString(g)){var x=this._getContributorsList(g,
c,e?e.level:-1);t.set(d,"innerHTML",x?x+this._getDelimiter():"");this._toggleItem(d,!!x,-1)}}catch(q){}this._adjustCursorStyle()},_createNode:function(c){if(this.domNode){var b,a=this._checkShareInfo(c),e=a&&a.sharedWith,e=e&&this.itemNodes[e],d=this.map,f=this._attributions[c],f=n.isString(f)?f:this._getContributorsList(f,d.extent,d.getLevel()),d=!!f&&!d.getLayer(c).suspended;e?(this.itemNodes[c]=e,this._toggleItem(e,d,a.index)):(b=this.itemNodes[c]=u.create("span",{"class":this.itemClass,innerHTML:f?
f+this._getDelimiter():"",style:{display:d?"inline":"none"}},this.listNode),d&&this._setLastItem(b));this._adjustCursorStyle()}},_checkShareInfo:function(c){var b,a,e,d=this._attributions,f=-1,g=d[c];if(g&&n.isString(g)){for(a in d)if(b=d[a],a!==c&&b&&n.isString(b)&&b.length===g.length&&b.toLowerCase()===g.toLowerCase()){e=a;break}var k;b=this._sharedLayers;d=b.length;if(e){for(a=0;d>a;a++)if(k=b[a],-1!==h.indexOf(k,e)){f=a;k.push(c);break}-1===f&&(f=b.push([e,c])-1)}}return-1<f?{index:f,sharedWith:e}:
null},_getGroupIndex:function(c){var b,a=this._sharedLayers,e=a.length,d=-1;for(b=0;e>b;b++)if(-1!==h.indexOf(a[b],c)){d=b;break}return d},_getDelimiter:function(){var c=this.itemDelimiter;return c?"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+c+"\x3c/span\x3e":""},_toggleItem:function(c,b,a){if(-1<a&&!b){var e=this._sharedLayers[a],d=e.length,f=this._activeLayers;for(a=0;d>a;a++)if(-1!==h.indexOf(f,e[a]))return}q.set(c,"display",b?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var c,
b,a=this.listNode.childNodes;if(c=a.length)for(--c;0<=c;c--)if(b=a[c],"none"!==q.get(b,"display")){this._setLastItem(b);break}this._adjustCursorStyle()},_setLastItem:function(c){var b=this.itemClass,a=this.lastItemClass;this._lastItem&&p.replace(this._lastItem,b,a);c&&(p.replace(c,a,b),this._lastItem=c)},_createIndexByLevel:function(c,b){var a,e,d,f,g,k,l,h=c.contributors,n=h?h.length:0,p=new C(4326),m={};for(f=0;n>f;f++)for(a=h[f],k=(e=a.coverageAreas)?e.length:0,g=0;k>g;g++)for(d=e[g],l=d.bbox,
l={extent:D.geographicToWebMercator(new E(l[1],l[0],l[3],l[2],p)),attribution:a.attribution||"",zoomMin:d.zoomMin-(b&&d.zoomMin?1:0),zoomMax:d.zoomMax-(b&&d.zoomMax?1:0),score:w.isDefined(d.score)?d.score:100,objectId:f},d=l.zoomMin;d<=l.zoomMax;d++)m[d]=m[d]||[],m[d].push(l);return m},_getContributorsList:function(c,b,a){var e="";if(b&&w.isDefined(a)&&-1<a){c=c[a];var e=b.getCenter().normalize(),d=c?c.length:0,f=[],g={};for(a=0;d>a;a++)b=c[a],!g[b.objectId]&&b.extent.contains(e)&&(g[b.objectId]=
1,f.push(b));f.sort(function(a,b){return b.score-a.score||a.objectId-b.objectId});d=f.length;for(a=0;d>a;a++)f[a]=f[a].attribution;e=f.join(", ")}return e},_adjustCursorStyle:function(){var c=v.position(this.listNode.parentNode,!0).h;p.contains(this.listNode.parentNode,"esriAttributionOpen")?(p.remove(this.listNode.parentNode,"esriAttributionOpen"),c>v.position(this.listNode.parentNode,!0).h?(q.set(this.listNode.parentNode,"cursor","pointer"),p.add(this.listNode.parentNode,"esriAttributionOpen")):
q.set(this.listNode.parentNode,"cursor","default")):(p.add(this.listNode.parentNode,"esriAttributionOpen"),c<v.position(this.listNode.parentNode,!0).h?q.set(this.listNode.parentNode,"cursor","pointer"):q.set(this.listNode.parentNode,"cursor","default"),p.remove(this.listNode.parentNode,"esriAttributionOpen"))}});return z("extend-esri")&&n.setObject("dijit.Attribution",r,B),r});