//>>built
define("esri/dijit/analysis/tree","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/query dojo/on dojo/has dojo/aspect dgrid/util/has-css3 dgrid/Grid dojo/has!touch?dgrid/util/touch put-selector/put ../../kernel".split(" "),function(F,y,z,A,t,B,C,d,u,D,v,l,E){function w(c,n,f){var d,b=this.grid.isRTL?"right":"left",h=".dgrid-expando-icon";return n&&(h+=".ui-icon.ui-icon-triangle-1-"+(f?"se":"e")),d=l("div"+h+"[style\x3dmargin-"+b+": "+c*(this.indentWidth||9)+"px; float: "+
b+"]"),d.innerHTML="\x26nbsp;",d}function x(c){var d=this,f=this.style.height;f&&(this.style.display="0px"==f?"none":"block");c&&(l(this,".dgrid-tree-resetting"),setTimeout(function(){l(d,"!dgrid-tree-resetting")}));this.style.height=""}function p(c){var n,f,p=c.renderCell||D.defaultRenderCell;return c||(c={}),c.shouldExpand=c.shouldExpand||function(b,c,f){return f},d.after(c,"init",function(){var b=c.grid,h=".dgrid-content .dgrid-column-"+c.id,g=[];if(b.cleanEmptyObservers=!1,!b.store)throw Error("dgrid tree column plugin requires a store to operate.");
c.renderExpando||(c.renderExpando=w);g.push(b.on(c.expandOn||".dgrid-expando-icon:click,"+h+":dblclick,"+h+":keydown",function(a){var e=b.row(a);b.store.mayHaveChildren&&!b.store.mayHaveChildren(e.data)||"keydown"==a.type&&32!=a.keyCode||"dblclick"==a.type&&f&&1<f.count&&e.id==f.id&&-1<a.target.className.indexOf("dgrid-expando-icon")||b.expand(e);-1<a.target.className.indexOf("dgrid-expando-icon")&&(f&&f.id==b.row(a).id?f.count++:f={id:b.row(a).id,count:1})}));u("touch")&&g.push(b.on(v.selector(h,
v.dbltap),function(){b.expand(this)}));b._expanded||(b._expanded={});g.push(d.after(b,"insertRow",function(a){var b=this.row(a);return c.shouldExpand(b,n,this._expanded[b.id])&&this.expand(a,!0,!0),a}));g.push(d.before(b,"removeRow",function(a,e){var c=a.connected;c&&(t("\x3e.dgrid-row",c).forEach(function(a){b.removeRow(a,!0)}),e||l(c,"!"))}));c.collapseOnRefresh&&g.push(d.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+(b?b.offsetHeight:
0)};b.expand=function(a,e,f){var m=a.element?a:b.row(a),d=u("transitionend");if(a=m.element,a=-1<a.className.indexOf("dgrid-expando-icon")?a:t(".dgrid-expando-icon",a)[0],a&&a.mayHaveChildren&&(f||e!==!!this._expanded[m.id])){var g=void 0===e?!this._expanded[m.id]:e;l(a,".ui-icon-triangle-1-"+(g?"se":"e")+"!ui-icon-triangle-1-"+(g?"e":"se"));var k,h,p,n=a.preloadNode;e=m.element;var r={originalQuery:this.query};if(!n){k=e.connected=l("div.dgrid-tree-container");var n=a.preloadNode=l(e,"+",k,"div.dgrid-preload"),
q=function(a){return b.store.getChildren(m.data,a)};c.allowDuplicates&&(r.parentId=m.id);"level"in a&&(q.level=a.level);z.when(b.renderQuery?b._trackError(function(){return b.renderQuery(q,n,r)}):b.renderArray(q(r),n,"level"in q?{queryLevel:q.level}:{}),function(){if(b._expanded[m.id]&&d){var a=k.scrollHeight;k.style.height=a?a+"px":"auto"}});d?B(k,d,x):x.call(k)}k=e.connected;k.hidden=!g;h=k.style;!d||f?(h.display=g?"block":"none",h.height=""):(g?(h.display="block",p=k.scrollHeight,h.height="0px"):
(l(k,".dgrid-tree-resetting"),h.height=k.scrollHeight+"px"),setTimeout(function(){l(k,"!dgrid-tree-resetting");h.height=g?p?p+"px":"auto":"0px"}));g?this._expanded[m.id]=!0:delete this._expanded[m.id]}};d.after(c,"destroy",function(){y.forEach(g,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})}),c.renderCell=function(b,f,g,a){var e;e=c.grid;var d=Number(a&&a.queryLevel)+1,m=!e.store.mayHaveChildren||e.store.mayHaveChildren(b),l=a.parentId,d=n=isNaN(d)?0:d;e=c.renderExpando(d,m,e._expanded[(l?
l+"-":"")+e.store.getIdentity(b)],b);e.level=d;e.mayHaveChildren=m;a.level=d;p.call(c,b,f,g,a);g.insertBefore(e,g.firstChild)},c}return p.defaultRenderExpando=w,C("extend-esri")&&A.setObject("dijit.analysis.tree",p,E),p});