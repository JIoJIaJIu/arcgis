//>>built
define("esri/dijit/analysis/utils","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/number dojo/_base/window dojo/when dojo/data/ItemFileWriteStore dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter".split(" "),
function(w,h,r,F,G,H,z,I,Y,J,t,K,l,A,B,v,L,m,C,y,M,N,O,P,Q,D,R,k,S,T,U,V,W,Z,X){w={};return h.mixin(w,{_helpDialog:null,i18n:null,initHelpLinks:function(a,b,c){if(this._helpDialog||(this._helpDialog=new T),a){var f=P.byNode(a),d=f?f.get("helpFileName"):c&&c.helpFileName?c.helpFileName:null,e=f?f.get("isSingleTenant"):c&&c.isSingleTenant?c.isSingleTenant:!1;A("[esriHelpTopic]",a).forEach(function(f){f&&(v.set(f,"display",k.isDefined(b)&&!0!==b?"none":""),F.connect(f,"onclick",h.hitch(this,function(b){G.stop(b);
this._helpDialog.show(b,{helpId:z.get(f,"esriHelpTopic"),helpFileName:d,analysisGpServer:c&&c.analysisGpServer?c.analysisGpServer:null,helpParentNode:a,isPortal:e})})))},this)}},constructAnalysisFeatColl:function(a){var b,c={};c.featureCollection=a.layerDefinition;for(b in c.featureCollection)c.featureCollection.hasOwnProperty(b)&&"objectIdField"===b&&(c.featureCollection.objectIdFieldName=h.clone(c.featureCollection.objectIdField),delete c.featureCollection.objectIdField);return c.featureCollection.features=
a.featureSet.features,c},constructAnalysisInputLyrObj:function(a){var b,c,f,d,e={},g=a.getMap()||a._map;if(a.url&&!a._collection){if(e={url:a.url},f=this.isHostedService(a.url),d=10.2<=a.version&&a._useStandardizedQueries,a.getDefinitionExpression&&a.getDefinitionExpression()?e.filter=a.getDefinitionExpression():k.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(e.filter=a.definitionExpression),a.useMapTime&&a.timeInfo&&g.timeExtent&&(d||f||10.2<=a.version))d="",a.timeInfo.startTimeField&&
!a.timeInfo.endTimeField?(g.timeExtent.startTime&&(d=a.timeInfo.startTimeField+" \x3e "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.startTime)+"'"),g.timeExtent.endTime&&(g.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.startTimeField+" \x3c "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.endTime)+"'")):!a.timeInfo.startTimeField&&a.timeInfo.endTimeField?(g.timeExtent.startTime&&(d=a.timeInfo.endTimeField+" \x3e "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.startTime)+"'"),
g.timeExtent.endTime&&(g.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.endTimeField+" \x3c "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.endTime)+"'")):a.timeInfo.startTimeField&&a.timeInfo.endTimeField&&(g.timeExtent.startTime&&(d=a.timeInfo.startTimeField+" \x3e "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.startTime)+"'"),g.timeExtent.endTime&&(g.timeExtent.startTime&&(d+=" AND "),d+=a.timeInfo.endTimeField+" \x3c "+(f?"":"timestamp ")+"'"+this.formatDate(g.timeExtent.endTime)+
"'")),e.filter?e.filter+=" AND "+d:e.filter=d;a.credential&&(e.serviceToken=a.credential.token);-1!==e.url.indexOf("?")&&(b=e.url.substring(e.url.indexOf("?")+1,e.url.length),c=J.queryToObject(b),h.mixin(e,c),e.url=e.url.substring(0,e.url.indexOf("?")))}else if(!a.url||a._collection)try{e=a.toJson()}catch(aa){a._json=K.parse(a._json),e=a.toJson()}return e},formatDate:function(a){return B.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+B.format(a,{selector:"time",timePattern:"HH:mm:ss"})},
isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},buildReport:function(a,b){var c="";return b||(b={},h.mixin(b,t.analysisMsgCodes)),r.forEach(a,function(a){var d,e,g;"string"==typeof a.message?(d=k.isDefined(b[a.messageCode])?b[a.messageCode]:a.message,c+=a.style.substring(0,a.style.indexOf("\x3c/"))+(this._isEmptyObject(a.params)?d:l.substitute(d,a.params))+a.style.substring(a.style.indexOf("\x3c/"))):
h.isArray(a.message)&&(g=[],e=h.clone(a.style),r.forEach(a.message,function(c,n){e=e.replace(/<\//,"${"+n+"}");d=k.isDefined(b[a.messageCode+"_"+n])?b[a.messageCode+"_"+n]:c;d=this._isEmptyObject(a.params)?d:l.substitute(d,a.params);g.push(d+"\x3c/")},this),e=l.substitute(e,g),c+=e)},this),c},getLayerFeatureCount:function(a,b){var c=new U;return c.geometry=b.geometry||"",c.where=b.where||"1\x3d1",c.geometryType=b.geometryType||"esriGeometryEnvelope",a.queryCount(c)},createPolygonFeatureCollection:function(a){var b;
return b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}},b.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",
capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},
{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]},b},createPointFeatureCollection:function(a){var b;return b={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}},b.layerDefinition={objectIdField:"OBJECTID",
templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",
editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]},b},createFolderStore:function(a,b){var c=new O({data:{identifier:"id",label:"name",items:[]}});return c.newItem({name:b,id:""}),r.forEach(a,function(a){c.newItem({name:a.title,
id:a.id})}),c},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",!0);a.folderSelect.set("searchAttr","name");k.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(h.hitch(this,function(b){k.isDefined(b)?a.folderSelect.set("item",b):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:h.hitch(this,function(b){k.isDefined(b)&&0<b.length?a.folderSelect.set("item",
b[0]):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})}):a.username?a.folderSelect.set("displayedValue",a.username):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)},_isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},validateServiceName:function(a,b){var c,f,d=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(a),e=!0;return k.isDefined(b)&&b.textInput&&(f=b.textInput),this.initI18n(),0===a.length||0===l.trim(a).length?(c=this.i18n.requiredValue,
e=!1):d?(c=this.i18n.invalidServiceName,e=!1):98<a.length?(c=this.i18n.invalidServiceNameLength,e=!1):170<encodeURIComponent(a).length&&(c=this.i18n.invalidEncodedServiceNameLength,e=!1),f&&!e&&f.set("invalidMessage",c),e},getStepNumber:function(a){A(".esriAnalysisNumberLabel",a).forEach(function(a,c){var f=this._getNumberLabel(c);z.set(a,"innerHTML",f)},this)},_getNumberLabel:function(a){var b="";switch(this.initI18n(),a){case 0:b=this.i18n.oneLabel;break;case 1:b=this.i18n.twoLabel;break;case 2:b=
this.i18n.threeLabel;break;case 3:b=this.i18n.fourLabel;break;case 4:b=this.i18n.fiveLabel;break;case 5:b=this.i18n.sixLabel;break;case 6:b=this.i18n.sevenLabel;break;case 7:b=this.i18n.eightLabel;break;case 8:b=this.i18n.nineLabel}return b},populateAnalysisLayers:function(a,b,c,f){if(a){var d=[],e=a.get(b);a._titleRow&&v.set(a._titleRow,"display","none");a._analysisLabelRow&&v.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&(v.set(a._selectAnalysisRow,"display","table-row"),
L.add(a._analysisSelect.domNode,"esriTrailingMargin3"),v.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);k.isDefined(f)&&f.chooseLabel&&d.push({value:-1,label:this.i18n.chooseLabel});k.isDefined(f)&&k.isDefined(f.posIncrement)||(k.isDefined(f)||(f={}),f.posIncrement=0);r.forEach(a.get(c),function(a,b){b+=f.posIncrement;var c={value:k.isDefined(f)&&f.chooseLabel?b+1:b,label:a.name};e&&a.name===e.name&&(c.selected=!0);d.push(c)},this);a._analysisSelect.addOption(d);
a._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(a){var b,c,f,d,e,g,h,n,x,m,u,q="",p=!0,E={isValid:p,validationMessage:q},t=0,v=0,w=0;return k.isDefined(a)&&k.isDefined(a.toolName)?(this.initI18n(),k.isDefined(this.i18n.cblPointMsg)||(this.i18n.cblPointMsg="You need to have at least one point feature layer to run ${toolName}.",console.log("was empty initialized")),b=a.toolName,c=a.featureLayers,f=a.analysisLayer,d=b.charAt(0).toLowerCase()+b.substring(1),h=this.i18n,u=a.showReadyToUseLayers||
!1,r.forEach(c,function(a){"esriGeometryPoint"===a.geometryType&&(g=!0,t++);"esriGeometryPoint"!==a.geometryType&&"esriGeometryMultipoint"!==a.geometryType||(n=!0);"esriGeometryPolyline"===a.geometryType&&(x=!0,w++);"esriGeometryPolygon"===a.geometryType&&(e=!0,v++)},this),-1!==r.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],b)&&(!g||f&&"esriGeometryPoint"!==f.geometryType)?(q=l.substitute(this.i18n.selectPointLayer,{toolName:h[d]}),p=!1):"AggregatePoints"!==b&&"InterpolatePoints"!==
b||(!f||"esriGeometryPoint"===f.geometryType||"esriGeometryMultipoint"===f.geometryType)&&n?"CalculateDensity"===b&&(!n&&!x||f&&"esriGeometryPoint"!==f.geometryType&&"esriGeometryMultipoint"!==f.geometryType&&"esriGeometryPolyline"!==f.geometryType)?(q=l.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:h[d]}),p=!1):"FindHotSpots"===b&&(!n&&!e||f&&"esriGeometryPoint"!==f.geometryType&&"esriGeometryMultipoint"!==f.geometryType&&"esriGeometryPolygon"!==f.geometryType)?(q=l.substitute(this.i18n.hotspotsLineFeatureMsg,
{toolName:h[d]}),p=!1):"OverlayLayers"!==b&&"AggregatePoints"!==b&&"SummarizeWithin"!==b&&"SummarizeNearby"!==b&&"FindNearest"!==b&&"MergeLayers"!==b||u||0!==c.length&&(1!==c.length||c[0]!==f&&k.isDefined(f))?"ConnectOriginsToDestinations"===b&&!u&&(0===c.length||2>t)?(q=l.substitute(this.i18n.odPointMsg,{toolName:h[d]}),p=!1):"ChooseBestFacilities"!==b||0!==c.length&&0!==t?"AggregatePoints"===b&&!u&&1<c.length?(e=r.some(c,function(a){return"esriGeometryPolygon"===a.geometryType}),e||(q=l.substitute(this.i18n.aggregatePolyMsg,
{toolName:h[d]}),p=!1)):"MergeLayers"===b&&!u&&1<c.length?(m=1<t||1<w||1<v,m||(q=this.i18n.mergeValidationMsg,p=!1)):"SummarizeWithin"!==b&&"DissolveBoundaries"!==b||(!f||"esriGeometryPolygon"===f.geometryType)&&e?"ExtractData"===b?(p=r.some(c,function(a){return-1!==a.capabilities.indexOf("Extract")}),p||(q=l.substitute(this.i18n.extractValidationMsg))):("ConnectOriginsToDestinations"===b||"ChooseBestFacilities"===b)&&1<c.length&&(g=r.some(c,function(a){var b=k.isDefined(f)&&f.id===a.id;return"esriGeometryPoint"===
a.geometryType&&!b}),g||(q=l.substitute("ChooseBestFacilities"===b?this.i18n.cblPointMsg:this.i18n.odPointMsg,{toolName:h[d]}),p=!1)):(q=l.substitute(this.i18n.selectPolyLayer,{toolName:h[d]}),p=!1):(q=l.substitute(this.i18n.cblPointMsg,{toolName:h[d]}),p=!1):(q=l.substitute(this.i18n.overlayValidationMsg,{toolName:h[d]}),p=!1):(q=l.substitute(this.i18n.selectPointLayer,{toolName:h[d]}),p=!1),E={isValid:p,validationMessage:q}):E},initI18n:function(){this.i18n||(this.i18n={},h.mixin(this.i18n,t.common),
h.mixin(this.i18n,t.analysisTools),h.mixin(this.i18n,t.analysisMsgCodes),h.mixin(this.i18n,t.browseLayersDlg),h.mixin(this.i18n,t.driveTimes))},addBrowseAnalysisDialog:function(a){var b=[];if(a&&a.widget){this.i18n||this.initI18n();b.push({label:this.i18n.categoryAll,value:"analysis ready"});b.push({label:this.i18n.categoryBoundaries,value:"boundaries OR places"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryBoundaries,value:"boundaries"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+
this.i18n.subCategoryPlaces,value:"places"});b.push({label:this.i18n.categoryHexBins,value:"hex"});b.push({label:this.i18n.categoryTransportation,value:"transportation"});var c,f,d=M.doc.createDocumentFragment(),d=m.create("div",{style:"width:100%;height:100%;"},d),e=m.create("div",{style:"width:100%;height:10%;","class":""},d),g=m.create("div",{style:"width:100%"},d),k=new V({portalUrl:a.widget.get("portalUrl"),message:"",plugin:"esri/dijit/analysis/PluginAnalysisLayers",sortDescending:!0,sort:"title",
self:a.widget.get("portalSelf"),categories:b,categoryType:"tags",selectedCategory:"boundaries OR places",pagingLinks:3,itemsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",closePopupPerRow:!1,extent:a.widget.get("map").extent,useExtent:!0,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},formatItemTitle:function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},style:"width:600px;height:90%;clear:both;"},
g),b=m.toDom('\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"esriFloatTrailing"\x3e');m.place(b,e);var n,x,l,u,q,p;return n=m.create("tr",null,b),x=m.create("td",null,n),m.create("td",{innerHTML:"\x26nbsp;"},n),l=m.create("td",null,n),u=m.create("tr",null,b),q=m.create("td",{style:"padding-bottom: 0.5em"},u),m.create("td",{style:"padding-bottom: 0.5em",innerHTML:"\x26nbsp;"},u),p=m.create("td",{style:"padding-bottom: 0.5em"},u),m.create("label",{"for":a.widget.id+"_addlayercheck","class":"",
innerHTML:this.i18n.addLayer},l),c=new D({name:"addlayer",id:a.widget.id+"_addlayercheck","class":"",value:!1,checked:!1},m.create("input",{},x)),m.create("label",{"for":a.widget.id+"_addextentcheck","class":"",innerHTML:this.i18n.withinMapArea},p),new D({name:"extentcheck",id:a.widget.id+"_addextentcheck","class":"",value:!0,checked:!0,onChange:h.hitch(this,function(a){k.set("useExtent",a)})},m.create("input",{},q)),f=new Q({title:this.i18n.browseAnalysisTitle,content:d,doLayout:!0,browseItems:k,
addlayerCheckBox:c,style:"padding:.75em 0;background-color: #fff;"}),a.widget.own(a.widget.get("map").on("extent-change",h.hitch(a.widget,function(){console.log("new extent",a.widget.get("map").extent);k.set("extent",a.widget.get("map").extent)}))),f}},addAnalysisReadyLayer:function(a){if(k.isDefined(a)&&k.isDefined(a.item)&&k.isDefined(a.layersSelect)&&k.isDefined(a.layers)&&k.isDefined(a.browseDialog)){a.browseDialog.browseItems._closePopup();a.browseDialog.hide();var b,c,f,d,e,g={url:a.item.url&&
-1!==window.location.protocol.indexOf("https:")?a.item.url.replace("http:","https:")+"/0":a.item.url+"/0",itemId:a.item.id,title:a.item.title,analysisReady:!0},m=r.some(a.layers,function(a,c){var d=a.analysisReady&&g.analysisReady&&a.itemId===g.itemId;return d&&(b=c),d}),n=new C;return m?(a.posIncrement&&(b+=a.posIncrement),a.browseDialog.addlayerCheckBox.get("checked")&&(a.posIncrement||(a.posIncrement=0),e=a.layers[b-a.posIncrement],a.widget.map.getLayer(e.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),
this._addLayerHandle=a.widget.map.on("layer-add",h.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:e.linfo,item:e})})),a.widget.map.addLayer(e.lyr))),a.layersSelect.set("value",b),a.browseDialog.browseItems.clear(),n.resolve()):(n=S({url:g.url,content:{f:"json"}}),n.then(h.hitch(this,function(b){var e=new W(g.url,{outFields:["*"]});h.mixin(g,e);h.mixin(g,b);g.id=g.title+"_"+b.id;g.title=g.title.replace(/_/g," ");g.name=g.title;g.version=
g.currentVersion;d=a.layersSelect.getOptions();c=d.splice(d.length-2,2);a.layersSelect.removeOption(c);f=a.layers.length;a.posIncrement&&(f+=a.posIncrement);c.unshift({value:f,label:g.title,selected:!0});a.layersSelect.addOption(c);a.layersSelect.set("value",f);g.lyr=e;g.linfo=b;a.layers.push(g);e.name=g.name;a.browseDialog.addlayerCheckBox.get("checked")&&(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",h.hitch(this,function(c){this._addLayerHandle.remove();
a.widget.emit("add-ready-to-use-layer",{layer:c.layer,layerInfo:b,item:g})})),a.widget.map.addLayer(e));a.browseDialog.browseItems.clear()}))),n.promise}},addReadyToUseLayerOption:function(a,b){a&&a.showReadyToUseLayers&&(b||(b=[]),a.signInPromise.then(h.hitch(this,function(){r.forEach(b,function(b){b.addOption({type:"separator",value:""});b.addOption({value:"browse",label:a.i18n.browseAnalysisTitle})},this);k.isDefined(a._browsedlg)||(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",
h.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",h.hitch(a,function(){a._browsedlg.browseItems._closePopup();r.forEach(b,function(a){"browse"===a.get("value")&&a.reset()})}))))})))},getMaxInputByMode:function(a){var b;if(a&&a.units&&a.type)return"StraightLine"===a.type?"Miles"===a.units?b=1E3:"Yards"===a.units?b=176E4:"Kilometers"===a.units?b=y.format(1609.34,{places:2}):"Meters"===a.units?b=y.format(1609340,{places:2}):"Feet"===a.units&&(b=528E4):"DrivingDistance"===a.type||"TruckingDistance"===
a.type||"WalkingDistance"===a.type?"Miles"===a.units?b=300:"Yards"===a.units?b=528E3:"Kilometers"===a.units?b=y.format(482.802,{places:2}):"Meters"===a.units?b=y.format(482802,{places:2}):"Feet"===a.units&&(b=1584E3):("DrivingTime"===a.type||"TruckingTime"===a.type||"WalkingTime"===a.type)&&("Minutes"===a.units?b=300:"Seconds"===a.units?b=18E3:"Hours"===a.units&&(b=5)),b},updateModeConstraints:function(a){var b;a&&a.validateWidget&&a.units&&a.type&&(b=a.validateWidget.get("constraints"),b.max=this.getMaxInputByMode(a),
a.validateWidget.set(b))},getTravelModes:function(a){var b,c,f,d,e=new C;return k.isDefined(this.travelModes)&&0<this.travelModes.length?e.resolve(this.travelModes):a&&a.widget?a.widget.signInPromise.then(h.hitch(this,function(){(d=a.widget.get("helperServices"))&&d.routingUtilities?(f=d.routingUtilities.url,b="sync"):b=a.widget._getSelf(a.widget.portalUrl);N(b,h.hitch(this,function(a){var b={};return a&&a.helperServices&&a.helperServices.routingUtilities&&(f=a.helperServices.routingUtilities.url),
k.isDefined(f)?(c=new X(f+"/GetTravelModes"),void c.execute(b).then(h.hitch(this,function(a){this.travelModes=r.map(a[0].value&&a[0].value.features,function(a){return H.fromJson(a.attributes.TravelMode)});a[1]&&a[1].paramName&&"defaultTravelMode"===a[1].paramName&&(this.defaultTravelModeId=a[1].value);e.resolve(this.travelModes)}),h.hitch(this,function(a){e.reject(a)}))):void e.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(a){e.reject(a)})})):e.reject(Error("Missing parameter: params.widget required parameter")),
e.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var b=[],c=a.allowmode||"all";this.initI18n();a.addStraightLine&&b.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e"});this.getTravelModes({widget:a.widget}).then(h.hitch(this,function(f){r.forEach(f,function(d){var e;e=d.name;
var f=e.replace(/\s/g,a.separator||""),h="AUTOMOBILE"===d.type?"Driving":"TRUCK"===d.type?"Trucking":"WALK"===d.type?"Walking":"Other",m=h.toLowerCase(),l=d.units||e.split(/\s/)[1],r=k.isDefined(a.enableTravelModes)&&!a.enableTravelModes,l=d.impedanceAttributeName===d.timeAttributeName?"Time":d.impedanceAttributeName===d.distanceAttributeName?"Distance":"Other";e={label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+h+l+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
e+"\x3c/div\x3e",value:f,travelMode:d,disabled:r,modei18nKey:m,units:l};"all"!==c&&c!==l.toLowerCase()||("all"!==c&&(e.value=e.value.replace(l,"")),a.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===d.id&&(e.selected=!0),b.push(e))},this);a.selectWidget.removeOption();a.selectWidget.addOption(b);a.selectWidget.set("value",a.value);a.widget.emit("travelmodes-added",{travelOptions:b})}),h.hitch(this,function(){b&&0<b.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(b),
a.selectWidget.set("value",a.value),a.widget.emit("travelmodes-added",{travelOptions:b}))}))}}}),I("extend-esri")&&h.setObject("dijit.analysis.utils",w,R),w});