//>>built
require({cache:{"url:esri/dijit/templates/ImageServiceMeasure.html":'\x3cdiv data-dojo-attach-point\x3d"esriImageServiceMeasure" class\x3d"esriImageServiceMeasure"\x3e\n  \x3cdiv class\x3d"esriImageServiceMeasureToggleButton" data-dojo-attach-point\x3d"toggleButtonDiv"\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"esriImageServiceMeasureDropdownContainer" data-dojo-attach-point\x3d"measureDropDownContainer"\x3e\n  \x3c/div\x3e\n  \x3cdiv data-dojo-attach-point\x3d"measureButtonContainer"\x3e\n  \x3c/div\x3e\n\x3c/div\x3e\n'}});
define("esri/dijit/ImageServiceMeasure","dojo/_base/declare dojo/_base/lang dojo/i18n!../nls/jsapi dojo/text!./templates/ImageServiceMeasure.html dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../toolbars/ImageServiceMeasureTool dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dijit/MenuSeparator dijit/PopupMenuItem dijit/RadioMenuItem dijit/CheckedMenuItem ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/Point dojo/_base/Color dojo/dom-class dojo/_base/array ../tasks/ImageServiceMeasureParameters ../units dojo/dom-construct dijit/form/ToggleButton dojo/html".split(" "),
function(z,h,C,q,D,E,F,G,H,I,v,n,J,w,x,y,A,K,r,B,L,M,t,e,m,g,k,p,N,u){q=z([F,G,H],{declaredClass:"esri.dijit.ImageServiceMeasure",templateString:q,widgetsInTemplate:!0,layer:null,map:null,layout:"dropDown",displayOperations:null,markerSymbol:null,lineSymbol:null,fillSymbol:null,displayMeasureResultInPopup:null,angularUnit:null,linearUnit:null,areaUnit:null,_supportedMeasureOperations:[],_supportedUnits:{},_currentGraphic:null,_defaultUnits:{angularUnit:"DECIMAL_DEGREES",linearUnit:"KILOMETERS",areaUnit:"SQUARE_KILOMETERS"},
_desiredDropDownOrder:"OPERATION_POINT OPERATION_DISTANCE_ANGLE OPERATION_AREA_PERIMETER OPERATION_CENTROID OPERATION_BASE_TOP OPERATION_TOP_TOP_SHADOW OPERATION_BASE_TOP_SHADOW".split(" "),_map3DOperations:{OPERATION_POINT:"OPERATION_POINT_3D",OPERATION_DISTANCE_ANGLE:"OPERATION_DISTANCE_ANGLE_3D",OPERATION_AREA_PERIMETER:"OPERATION_AREA_PERIMETER_3D",OPERATION_CENTROID:"OPERATION_CENTROID_3D",OPERATION_BASE_TOP:"OPERATION_BASE_TOP",OPERATION_TOP_TOP_SHADOW:"OPERATION_TOP_TOP_SHADOW",OPERATION_BASE_TOP_SHADOW:"OPERATION_BASE_TOP_SHADOW"},
_menu:null,_dropDownButton:null,_currentOperation:null,_activeMeasureOpMenuItem:null,_has3DOperations:!1,_enabled3DCheckbox:!1,_dropDownMenuItemMap:{},_toggleButtonMenuItemMap:{},_decimalDegreesConstantValue:"esriDUDecimalDegrees",_decimalDegreesConstantKeyword:"DECIMAL_DEGREES",constructor:function(a){z.safeMixin(this,a);this._setDefaultSymbols();this._i18n=C},startup:function(){this.inherited(arguments)},postCreate:function(){this.map&&this.layer&&(this.measureToolbar=new I({map:this.map,layer:this.layer}),
this.measureToolbar.on("draw-end",h.hitch(this,this._addGraphic)),this.measureToolbar.on("draw-start",h.hitch(this,this._onDrawStart)),this.measureToolbar.on("measure-end",h.hitch(this,this._addInfoWindow)),this.measureToolbar.on("unit-change",h.hitch(this,this._onUnitChange)),this._supportedMeasureOperations=this._getSupportedMeasureOperations(),this._has3DOperations=this._check3DSupported(),this._reorderMeasureOperations(),this._supportedUnits=this._getSupportedUnits(),this._setDefaultUnits());
this._checkValidLayoutValue();0<this._supportedMeasureOperations.length?"dropDown"===this.layout?this._populateMeasureDropdown():"toolbar"===this.layout&&this._populateMeasureButtons():u.set(this.esriImageServiceMeasure,this._i18n.widgets.imageServiceMeasure.mensurationCapabilitiesAbsentText)},_checkValidLayoutValue:function(){"dropdown"===this.layout.toLowerCase()?this.layout="dropDown":"toolbar"===this.layout.toLowerCase()?this.layout="toolbar":(this.layout="dropDown",console.log("Invalid value for layout"))},
_getUnitKeyword:function(a){var b,c=null;if(a===this._decimalDegreesConstantValue)c=this._decimalDegreesConstantKeyword;else for(b in k)k.hasOwnProperty(b)&&k[b]===a&&(c=b);return c||null},_setUnitKeyword:function(a,b){var c,d;return this[a]?(c=this._getUnitKeyword(this[a]),c?d=c:(d=this._defaultUnits[a],console.log("Incorrect "+b+" supplied. "+b+" set to default."))):d=this._defaultUnits[a],d},_setDefaultUnits:function(){this.linearUnit=this._setUnitKeyword("linearUnit","Linear Unit");this.areaUnit=
this._setUnitKeyword("areaUnit","Area Unit");this.angularUnit=this._setUnitKeyword("angularUnit","Angular Unit");this.measureToolbar.setLinearUnit(k[this.linearUnit]);this.measureToolbar.setAreaUnit(k[this.areaUnit]);this.measureToolbar.setAngularUnit(k[this.angularUnit])},_getSupportedMeasureOperations:function(){var a,b=[],c=this.displayOperations||this.measureToolbar.getSupportedMeasureOperations(),d=this.measureToolbar.getSupportedMeasureOperations();return m.forEach(c,function(f){for(a in g)g.hasOwnProperty(a)&&
g[a]===f&&(-1<m.indexOf(d,f)?b.push(a):console.log(f+" is not supported by the service."))},this),b},_getSupportedUnits:function(){var a,b={},c=[],d=[],f=this.measureToolbar.getSupportedUnits();for(a in f)f.hasOwnProperty(a)&&(d=f[a],c=[],m.forEach(d,function(a){c.push(this._getUnitString(a))},this),b[a]=c);return b},_check3DSupported:function(){return this._isSupportedMeasureOperation("OPERATION_POINT_3D")||this._isSupportedMeasureOperation("OPERATION_DISTANCE_ANGLE_3D")||this._isSupportedMeasureOperation("OPERATION_AREA_PERIMETER_3D")||
this._isSupportedMeasureOperation("OPERATION_CENTROID_3D")},_isSupportedMeasureOperation:function(a){return-1<this._supportedMeasureOperations.indexOf(a)},_reorderMeasureOperations:function(){var a=[];m.forEach(this._desiredDropDownOrder,function(b){-1<this._supportedMeasureOperations.indexOf(b)&&a.push(b)},this);this._supportedMeasureOperations=a},_setDefaultSymbols:function(){this.markerSymbol||(this.markerSymbol=new K,this.markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z"),
this.markerSymbol.setColor(new t("#00FFFF")));this.lineSymbol||(this.lineSymbol=new r(r.STYLE_SOLID,new t([255,0,0]),1.5));this.fillSymbol||(this.fillSymbol=new B(B.STYLE_SOLID,new r(r.STYLE_DASHDOT,new t([255,0,0]),2),new t([255,255,0,.25])))},_populateMeasureDropdown:function(){var a,b,c,d;this._menu=new n;m.forEach(this._supportedMeasureOperations,function(b){a=new J({label:this._i18n.widgets.imageServiceMeasure.operationLabel[b],iconClass:g[b]});a.on("click",h.hitch(this,this._onDropDownMenuItemClick,
b,a));this._menu.addChild(a);this._dropDownMenuItemMap[b]=a},this);b=new w;this._menu.addChild(b);this._has3DOperations&&(d=new A({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),d.on("change",h.hitch(this,this._on3DCheckBoxChange)),this._menu.addChild(d),c=new w,this._menu.addChild(c));this._addUnitsMenu();this._dropDownButton=new v({dropDown:this._menu,"class":"esriImageServiceMeasureDropdownContainer"},this.measureDropDownContainer);this._dropDownButton.startup();this._currentOperation=
this._defaultOperation=this._supportedMeasureOperations[0];this._toggleButton=new v({label:this._i18n.widgets.imageServiceMeasure.operationLabel[this._defaultOperation],iconClass:g[this._defaultOperation],"class":"esriImageServiceMeasureToggleButton",dropDown:new n({"class":"esriHiddenDropDownMenu"})},this.toggleButtonDiv);this._toggleButton.startup();this._toggleButton.on("click",h.hitch(this,this._toggle))},_populateMeasureButtons:function(){var a,b,c,d;e.add(this.esriImageServiceMeasure,"esriImageServiceMeasureToolbarLayout");
e.add(this.measureButtonContainer,"esriImageServiceMeasureButtonContainer");this._menu=new n;m.forEach(this._supportedMeasureOperations,function(b){d=p.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.operationLabel[b]},this.measureButtonContainer);a=new N({showLabel:!1,checked:!1,label:this._i18n.widgets.imageServiceMeasure.operationLabel[b],iconClass:g[b],baseClass:"esriMeasureButton"},d);a.on("click",h.hitch(this,this._onButtonMenuItemClick,b));this._toggleButtonMenuItemMap[b]=a},
this);this._has3DOperations&&(c=new A({label:this._i18n.widgets.imageServiceMeasure.measure3DLabel,checked:!1}),c.on("change",h.hitch(this,this._on3DCheckBoxToolbarLayoutChange)),this._menu.addChild(c),b=new w,this._menu.addChild(b));this._addUnitsMenu();b=p.create("span",{innerHTML:"|"},this.measureButtonContainer);d=p.create("div",null,this.measureButtonContainer);this._dropDownButton=new v({dropDown:this._menu,label:this._i18n.widgets.imageServiceMeasure.settings,showLabel:!1,iconClass:"esriMensurationSettingsIcon",
"class":"esriMeasureSettingsButton"},d);this._dropDownButton.startup();"false"!==this.displayMeasureResultInPopup&&!1!==this.displayMeasureResultInPopup&&this.displayMeasureResultInPopup||(this.measureResultContainer=p.create("div",{"class":"measureResultContainer"},this.esriImageServiceMeasure),this.esriMeasurementResultLabel=p.create("div",{innerHTML:this._i18n.widgets.imageServiceMeasure.infoWindowTitle,"class":"esriMeasurementResultLabel"},this.measureResultContainer),this.measureResultStringDiv=
p.create("div",{"class":"esriMeasurementResultString"},this.measureResultContainer))},_addUnitsMenu:function(){var a,b,c,d,f,e;b=new n;m.forEach(this._supportedUnits.angularUnits,function(a){e=this._isCurrentAngularUnit(a);f=new y({group:"angularUnit",checked:e,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":e?"esriSelectedOption":""});e&&(this._currentAngularUnitMenuItem=f);f.on("click",h.hitch(this,this._onAngularUnitClick,a,f));b.addChild(f)},this);a=new x({label:this._i18n.widgets.imageServiceMeasure.angularUnits,
popup:b});this._menu.addChild(a);c=new n;m.forEach(this._supportedUnits.linearUnits,function(a){e=this._isCurrentLinearUnit(a);f=new y({group:"linearUnit",checked:e,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":e?"esriSelectedOption":""});e&&(this._currentLinearUnitMenuItem=f);f.on("click",h.hitch(this,this._onLinearUnitClick,a,f));c.addChild(f)},this);a=new x({label:this._i18n.widgets.imageServiceMeasure.linearUnits,popup:c});this._menu.addChild(a);d=new n;m.forEach(this._supportedUnits.areaUnits,
function(a){e=this._isCurrentAreaUnit(a);f=new y({group:"areaUnit",checked:e,label:this._i18n.widgets.imageServiceMeasure.unitLabel[a],"class":e?"esriSelectedOption":""});e&&(this._currentAreaUnitMenuItem=f);f.on("click",h.hitch(this,this._onAreaUnitClick,a,f));d.addChild(f)},this);a=new x({label:this._i18n.widgets.imageServiceMeasure.areaUnits,popup:d});this._menu.addChild(a)},_on3DCheckBoxChange:function(a){var b=this._currentOperation.replace("_3D","");this._enabled3DCheckbox=a;this._dropDownButton.openDropDown();
this._activeMeasureOpMenuItem&&(this._activeMeasureOpMenuItem=null,this._onDropDownMenuItemClick(b,this._dropDownMenuItemMap[b]))},_on3DCheckBoxToolbarLayoutChange:function(a){this._enabled3DCheckbox=a;this._dropDownButton.openDropDown();this._enabled3DCheckbox||(this._currentOperation=this._currentOperation.replace("_3D",""));this._currentOperation&&this._onButtonMenuItemClick(this._currentOperation)},_onDropDownMenuItemClick:function(a,b){var c=b.domNode;this._enabled3DCheckbox&&(a=this._map3DOperations[a]);
this._disableMapNavigation();this._removeDraws();this._activeMeasureOpMenuItem?(e.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),e.add(c,"esriSelectedOption"),this._activeMeasureOpMenuItem=b,this._currentOperation=a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:g[a.replace("_3D","")]}),this.measureToolbar.activate(g[a]),this.measureToolbar.showDrawTooltip()):(this._activeMeasureOpMenuItem=b,e.add(c,"esriSelectedOption"),this._currentOperation=
a,this._toggleButton.set({label:this._i18n.widgets.imageServiceMeasure.operationLabel[a],iconClass:g[a.replace("_3D","")]}),e.add(this._toggleButton._buttonNode,"esriCheckedMeasureButton"),this.measureToolbar.activate(g[a]),this.measureToolbar.showDrawTooltip())},_uncheckOtherButtons:function(a){for(var b in this._toggleButtonMenuItemMap)this._toggleButtonMenuItemMap.hasOwnProperty(b)&&b!==a&&this._toggleButtonMenuItemMap[b].set("checked",!1)},_onButtonMenuItemClick:function(a){this._removeDraws();
this._enabled3DCheckbox&&(a=this._map3DOperations[a]);this._uncheckOtherButtons(a.replace("_3D",""));this._currentOperation=a;this._toggleButtonMenuItemMap[a.replace("_3D","")].checked?(this._disableMapNavigation(),this.measureToolbar.activate(g[a]),this.measureToolbar.showDrawTooltip()):(this.measureToolbar.deactivate(),this._enableMapNavigation());this.measureResultStringDiv&&u.set(this.measureResultStringDiv,"")},_isCurrentAngularUnit:function(a){return a===this.angularUnit?!0:!1},_isCurrentLinearUnit:function(a){return a===
this.linearUnit?!0:!1},_isCurrentAreaUnit:function(a){return a===this.areaUnit?!0:!1},_onLinearUnitClick:function(a,b){e.remove(this._currentLinearUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");this._currentLinearUnitMenuItem=b;this.linearUnit=a;this.measureToolbar.setLinearUnit(k[a]);this._dropDownButton.openDropDown()},_onAngularUnitClick:function(a,b){e.remove(this._currentAngularUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");
this._currentAngularUnitMenuItem=b;this.angularUnit=a;this.measureToolbar.setAngularUnit(k[a]);this._dropDownButton.openDropDown()},_onAreaUnitClick:function(a,b){e.remove(this._currentAreaUnitMenuItem.domNode,"esriSelectedOption");e.add(b.domNode,"esriSelectedOption");this._currentAreaUnitMenuItem=b;this.areaUnit=a;this.measureToolbar.setAreaUnit(k[a]);this._dropDownButton.openDropDown()},_onDrawStart:function(){this._removeDraws()},_addGraphic:function(a){var b=a.geometry;this.measureToolbar.hideDrawTooltip();
a="point"===b.type?this.markerSymbol:"line"===b.type||"polyline"===b.type?this.lineSymbol:this.fillSymbol;this._removeDraws();this._currentGraphic=a=new L(b,a);this.map.graphics.add(a)},_addInfoWindow:function(a){a=this._measureResultString(a.measureResult,a.error);"dropDown"===this.layout||"toolbar"===this.layout&&("true"===this.displayMeasureResultInPopup||!0===this.displayMeasureResultInPopup)?this._displayInfoWindowMeasureResult(a):"toolbar"===this.layout&&this._displayToolbarMeasureResult(a)},
_measureResultString:function(a){var b,c,d,e,h,k,l,g="";if(a)for(l in a)a.hasOwnProperty(l)&&a[l]&&"name"!==l&&"sensorName"!==l&&(e="point"===l&&0<=this._currentOperation.toLowerCase().indexOf("centroid")?this._i18n.widgets.imageServiceMeasure.measureDialog.Centroid:this._i18n.widgets.imageServiceMeasure.measureDialog[l.charAt(0).toUpperCase()+l.slice(1)],"point"!=l?(b=this._i18n.widgets.imageServiceMeasure.unitLabel[this._getUnitString(a[l].unit)],d=Math.abs(a[l].uncertainty).toFixed(2),c=this._getDisplayValue(a[l]),
g+="\x3cstrong\x3e"+e+"\x3c/strong\x3e: "+c+" (\x26plusmn"+d+") "+b+"\x3cbr/\x3e"):(h=a[l].value.x.toFixed(2),k=a[l].value.y.toFixed(2),g+="\x3cstrong\x3e"+e+"\x3c/strong\x3e\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.X+" : "+h+"\x3cbr/\x3e"+this._i18n.widgets.imageServiceMeasure.measureDialog.Y+" : "+k+"\x3cbr/\x3e"));else g=this._i18n.widgets.imageServiceMeasure.measurementErrorGeneric;return g},_getDisplayValue:function(a){return this.layer.currentVersion&&10.3<=this.layer.currentVersion?
0>a.uncertainty?a.value.toFixed(2):Number(a.displayValue).toString():a.value.toFixed(2)},_getUnitString:function(a){var b,c;for(b in k)k.hasOwnProperty(b)&&(k[b]===a?c=b:a===this._decimalDegreesConstantValue&&(c=this._decimalDegreesConstantKeyword));return c},_displayInfoWindowMeasureResult:function(a){var b,c,d=this._currentGraphic.geometry;this._currentGraphic&&("point"===d.type?this._currentInfowindow=d:"polyline"===d.type?(b=(d.paths[0][0][0]+d.paths[0][1][0])/2,c=(d.paths[0][0][1]+d.paths[0][1][1])/
2,this._currentInfowindow=new M(b,c,this.map.spatialReference)):"polygon"===d.type&&(this._currentInfowindow=d.getCentroid()),this.map.infoWindow.setTitle(this._i18n.widgets.imageServiceMeasure.infoWindowTitle),this.map.infoWindow.setContent(a),this.map.infoWindow.on("hide",h.hitch(this,this._removeAssociatedGeometry)),this.map.infoWindow.show(this._currentInfowindow))},_displayToolbarMeasureResult:function(a){u.set(this.measureResultStringDiv,a)},_removeAssociatedGeometry:function(){this._currentGraphic&&
(this.map.graphics.remove(this._currentGraphic),this._currentGraphic=null)},_removeDraws:function(){this._removeAssociatedGeometry();this._currentInfowindow&&(this.map.infoWindow.hide(this._currentInfowindow),this._currentInfowindow=null)},_onUnitChange:function(a){this._addInfoWindow(a)},_toggle:function(){this._activeMeasureOpMenuItem?(this._removeDraws(),e.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),this._activeMeasureOpMenuItem=null,this.measureToolbar.deactivate(),e.remove(this._toggleButton._buttonNode,
"esriCheckedMeasureButton"),this._enableMapNavigation()):(this._menuItem=this._dropDownMenuItemMap[this._currentOperation.replace("_3D","")],this._onDropDownMenuItemClick(this._currentOperation.replace("_3D",""),this._menuItem))},deactivate:function(){this._removeDraws();this._activeMeasureOpMenuItem&&(e.remove(this._activeMeasureOpMenuItem.domNode,"esriSelectedOption"),this._activeMeasureOpMenuItem=null);this._toggleButton&&e.remove(this._toggleButton._buttonNode,"esriCheckedMeasureButton");this.measureResultStringDiv&&
u.set(this.measureResultStringDiv,"");"toolbar"===this.layout&&this._currentOperation&&this._toggleButtonMenuItemMap[this._currentOperation.replace("_3D","")].set("checked",!1);this.measureToolbar&&this.measureToolbar.deactivate();this._enableMapNavigation()},_disableMapNavigation:function(){this.map.disableMapNavigation();this.map.setInfoWindowOnClick(!1)},_enableMapNavigation:function(){this.map.enableMapNavigation();this.map.setInfoWindowOnClick(!0)},destroy:function(){this.inherited(arguments)}});
return D("extend-esri")&&h.setObject("dijit.ImageServiceMeasure",q,E),q});