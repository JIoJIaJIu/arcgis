//>>built
define("esri/dijit/geoenrichment/AgePyramid","../../declare require dojo/_base/lang ./BaseSelectComparison dojo/dom-construct dojo/number dojo/dom-class ./utils ./theme dojox/charting/Chart dojox/charting/axis2d/Default dojox/charting/plot2d/Bars dojox/charting/plot2d/Lines dojox/charting/action2d/Tooltip dojox/charting/action2d/Highlight dojox/charting/SimpleTheme dojo/i18n!../../nls/jsapi".split(" "),function(u,C,k,v,d,h,m,w,p,x,y,z,A,q,r,B,f){f=f.geoenrichment.dijit.AgePyramid;return u("esri.dijit.geoenrichment.AgePyramid",
v,{baseClass:"Infographics_AgePyramid",chart:null,_currentTheme:null,_themeChangeHandle:null,updateUI:function(){this.inherited(arguments);this._themeChangeHandle||(this._themeChangeHandle=p.on("change",k.hitch(this,this._onThemeChange)));this._currentTheme?this._doUpdateUI():p.load("AgePyramid").then(k.hitch(this,this._onThemeLoad))},_onThemeChange:function(){this._currentTheme=null;this._destroyChart();this.updateUI()},_onThemeLoad:function(b){this._currentTheme=b;this._currentTheme.theme=new B(b.theme);
this._doUpdateUI()},_doUpdateUI:function(){this.ensureChart();var b=this.getDataFields();this.maleIndices=[];this.femaleIndices=[];for(var a,g,n=b.length/2,c=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,t=!0,d=!0,l=0;l<b.length;l++){var f=n>l;f?this.maleIndices.push(b[l]):this.femaleIndices.push(b[l]);var h=this.getValueByIndex(0,b[l]);h>c?(c=h,a=this.getFieldByIndex(b[l]).alias,t=f):e>h&&(e=h,g=this.getFieldByIndex(b[l]).alias,d=f)}n=this.setSeriesData(this.chart.getSeries("male_bars"),0,
this.maleIndices,-1);c=this.setSeriesData(this.chart.getSeries("female_bars"),0,this.femaleIndices,1);this.expanded?(e=this._getComparisonRow(),b=this.setSeriesData(this.chart.getSeries("male_lines"),e,this.maleIndices,-1),e=this.setSeriesData(this.chart.getSeries("female_lines"),e,this.femaleIndices,1)):(this.chart.getSeries("male_lines").update([]),this.chart.getSeries("female_lines").update([]),e=b=Number.NEGATIVE_INFINITY);this.extreme=w.getCeiling(Math.max(n,c,b,e),!0);this.chart.removeAxis("y");
this.chart.addAxis("y",{type:y,min:-this.extreme,max:this.extreme,minorTicks:!1,labelFunc:k.hitch(this,this.getAxisLabel)});this.chart.render();this.expanded&&(t?m.replace(this.max,"AgePyramid_TextMale","AgePyramid_TextFemale"):m.replace(this.max,"AgePyramid_TextFemale","AgePyramid_TextMale"),d?m.replace(this.min,"AgePyramid_TextMale","AgePyramid_TextFemale"):m.replace(this.min,"AgePyramid_TextFemale","AgePyramid_TextMale"),this.max.innerHTML=a,this.min.innerHTML=g)},getAxisLabel:function(b,a){return a=
Math.abs(a),a!=this.extreme?h.format(a,{places:0}):h.format(a/100,{places:0,type:"percent"})},resize:function(){this.inherited(arguments);this.chart&&this.chart.resize()},ensureChart:function(){if(!this.chart){var b=this._currentTheme,a=this.chart=new x(this.chartDiv);a.setTheme(b.theme);a.addPlot("lines",{type:A,markers:!0});a.addPlot("bars",{type:z,gap:this.expanded?1.5:1});a.addSeries("male_bars",[],k.mixin({plot:"bars"},b.male));a.addSeries("female_bars",[],k.mixin({plot:"bars"},b.female));a.addSeries("male_lines",
[],k.mixin({plot:"lines"},b.line));a.addSeries("female_lines",[],k.mixin({plot:"lines"},b.line));var g={text:k.hitch(this,this.getTooltip)};new q(a,"bars",g);new q(a,"lines",g);new r(a,"bars",{duration:1});new r(a,"lines",{duration:1,highlight:b.highlight})}},getTooltip:function(b){var a,g,f=this._currentTheme;switch(b.run.name){case "male_bars":a=this.maleIndices[b.index];g=0;break;case "female_bars":a=this.femaleIndices[b.index];g=0;break;case "male_lines":a=this.maleIndices[b.index];g=this._getComparisonRow();
break;case "female_lines":a=this.femaleIndices[b.index];g=this._getComparisonRow();break;default:return""}var c=this.getFeatureTitle(g),e=this.getFieldByIndex(a).alias;a=h.format(this.getValueByIndex(g,a),{places:0});b=h.format(Math.abs("lines"===b.plot.name?b.x:b.y)/100,{places:1,type:"percent"});return"\x3cdiv class\x3d'AgePyramid_Tooltip_Content'\x3e\x3cspan style\x3d'font:"+f.font+"; color:"+f.color+";'\x3e\x3cb\x3e"+c+"\x3c/b \x3e \x3cbr / \x3e "+e+"\x3cbr/\x3e"+a+" ("+b+")\x3c/span\x3e\x3c/div\x3e"},
setSeriesData:function(b,a,g,f){var c,e,d=[],h=0;for(c=0;c<g.length;c++)e=this.getValueByIndex(a,g[c]),d.push(e),h+=e;a=Number.NEGATIVE_INFINITY;for(c=0;c<g.length;c++)e=d[c]/h*100,d[c]=e*f,e>a&&(a=e);if("lines"===b.plot)for(c=0;c<d.length;c++)d[c]={x:d[c],y:c+1};return b.update(d),a},createUI:function(b){this.inherited(arguments);b.contentClass.push("AgePyramid_ContentPane");this.chartDiv=b.addContent("div",{"class":"AgePyramid_Chart"})},createUIExpanded:function(b){this.inherited(arguments);var a=
b.addContent("div",{"class":"AgePyramid_MinMax"});d.create("div",{innerHTML:f.maxLabel},a);this.max=d.create("div",{"class":"AgePyramid_Text"},a);d.create("div",{"class":"AgePyramid_MinLabel",innerHTML:f.minLabel},a);this.min=d.create("div",{"class":"AgePyramid_Text"},a);a=b.addContent("div",{"class":"AgePyramid_Comparison"});d.create("div",{"class":"AgePyramid_ComparisonLabel",innerHTML:f.compLabel},a);this._createComboBox(a)},createUICollapsed:function(){this.inherited(arguments);d.create("div",
{"class":"MenLabel",innerHTML:f.menLabel},this.chartDiv);d.create("div",{"class":"WomenLabel",innerHTML:f.womenLabel},this.chartDiv)},destroy:function(){this._destroyChart();this._themeChangeHandle&&(this._themeChangeHandle.remove(),this._themeChangeHandle=null);this.inherited(arguments)},_destroyChart:function(){this.chart&&(this.chart.destroy(),this.chart=null)}})});