//>>built
define("esri/dijit/geoenrichment/InfographicsOptions","../../declare dojo/_base/lang dojo/Deferred dojo/string ../../tasks/geoenrichment/studyAreaOptionsFromJson ../../tasks/geoenrichment/GeoenrichmentTask ./lang ./config ./InfographicsOptionsItem".split(" "),function(k,w,A,E,B,C,n,p,x){function D(a,d){var c=parseFloat(a.index),b=parseFloat(d.index);return isNaN(c)&&isNaN(b)?0:isNaN(c)?1:isNaN(b)?-1:c-b}function y(a,d){for(var c=0;c<a.length;c++){var b=a[c];if(b.type==d.type&&n.arraysEqual(b.variables,
d.variables))return{report:b,index:c}}return null}function q(a,d){if(a)for(var c in a)if(a.hasOwnProperty(c)){d[c]=[];for(var b=0;b<a[c].length;b++){var f={};z(a[c][b],f);d[c].push(f)}}}function z(a,d){if(d.type=a.type||("OneVarMultiComparison"==a.report?"OneVar":a.report),a.dataCollection)if(a.vars){d.variables=[];for(var c=0;c<a.vars.length;c++)d.variables.push(a.dataCollection+"."+a.vars[c])}else d.variables=[a.dataCollection+".*"];else d.variables=a.variables;n.isBoolean(a.isVisible)?d.isVisible=
a.isVisible:n.isBoolean(a.checked)&&(d.isVisible=a.checked)}k=k("esri.dijit.geoenrichment.InfographicsOptions",null,{_items:null,_loaded:null,studyAreaOptions:null,theme:"common",constructor:function(a){this._loaded={};this.studyAreaOptions=B(a&&(a.buffer||a.studyAreaOptions));this._items={};a&&(q(a.reports||a.items,this._items),a.theme&&(this.theme=a.theme))},toJson:function(){var a={};return q(this._items,a),{studyAreaOptions:this.studyAreaOptions.toJson(),items:a,theme:this.theme}},getItems:function(a){var d=
new A;if(this._loaded[a])d.resolve(this._items[a]);else{var c=new C(p.server);c.token=p.token;c.getDataCollections(a,null,["id","alias"]).then(w.hitch(this,this._mergeItems,a,d),function(a){d.reject(a)})}return d.promise},_mergeItems:function(a,d,c){try{var b,f,g={AgePyramid:1,TapestryNEW:1,RelatedVariables:1,OneVar:1},l={TapestryNEW:"Tapestry"},m=[];for(b=0;b<c.length;b++){var k=c[b].metadata.infographics||c[b].metadata.infographics2;if(k){var r=JSON.parse(k),h;for(h in r)if(g[h]){var n=h;l[h]&&
(n=l[h]);var t=new x(n,[c[b].id+".*"]),u;for(u in r[h])r[h].hasOwnProperty(u)&&(t[u]=r[h][u]);(f=y(m,t))?m[f.index]=t:m.push(t)}}}var v,e=this._items[a];e||(e=[],e.push(new x("OneVar",["KeyGlobalFacts.AVGHHSZ"])),this._items[a]=e);for(b=e.length-1;0<=b;b--)if(f=y(m,e[b]))z(e[b],f.report),e[b]=f.report,m.splice(f.index,1);else{if("OneVar"==e[b].type&&1==e[b].variables.length){var p,q=e[b].variables[0];if(!v)for(v={},g=0;g<c.length;g++)for(l=0;l<c[g].variables.length;l++)v[c[g].id+"."+c[g].variables[l].id]=
c[g].variables[l];if(p=v[q]){e[b].title=p.alias;continue}}e.splice(b,1);b--}for(b=0;b<m.length;b++)e.push(m[b]);e.sort(D);this._loaded[a]=!0;d.resolve(e)}catch(w){d.reject(w)}}});return k.Item=x,k});