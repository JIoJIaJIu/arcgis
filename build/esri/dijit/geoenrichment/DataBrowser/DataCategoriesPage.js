//>>built
require({cache:{"url:esri/dijit/geoenrichment/DataBrowser/templates/DataCategoriesPage.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"row: 0"\x3e\n    \x3cdiv data-dojo-attach-point\x3d"countryDiv" class\x3d"DataCategoriesPage_Country"\x3e\n        \x3cselect data-dojo-type\x3d"dijit/form/FilteringSelect"\n            data-dojo-attach-point\x3d"countrySelect"\n            data-dojo-props\x3d"maxHeight: 151"\n            data-dojo-attach-event\x3d"onChange: _onCountryChanged"\x3e\n        \x3c/select\x3e\n    \x3c/div\x3e\n    \x3cinput type\x3d"text"\n        data-dojo-type\x3d"esri/dijit/geoenrichment/DataBrowser/SearchTextBox"\n        data-dojo-attach-point\x3d"txbSearch"\n        data-dojo-props\x3d"prompt:\'${nls.search}\'"\n        data-dojo-attach-event\x3d"onSearch: _search"\n        class\x3d"DataCategoriesPage_Search" /\x3e\n\x3c/div\x3e\n\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"itemsPane" data-dojo-props\x3d"row: 1" class\x3d"DataCategoriesPage_Pagination"\x3e\n    \x3cdiv data-dojo-type\x3d"esri/dijit/geoenrichment/Pagination" data-dojo-attach-point\x3d"pagination" data-dojo-attach-event\x3d"onSelect: _onItemClick"\x3e\x3c/div\x3e\n    \x3cdiv data-dojo-attach-point\x3d"progressDiv" class\x3d"Wizard_Progress"\x3e\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"row: 2"\x3e\n\x3c/div\x3e\n'}});
define("esri/dijit/geoenrichment/DataBrowser/DataCategoriesPage","../../../declare dojo/string dojo/_base/lang dojo/aspect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/on dojo/has dojo/i18n!../../../nls/jsapi dojo/text!./templates/DataCategoriesPage.html ../../../tasks/geoenrichment/GeoenrichmentTask ../config ../_WizardPage ../Pagination ../AnimationHelper dojo/store/Memory dijit/layout/ContentPane dijit/form/FilteringSelect ./SearchTextBox".split(" "),function(p,q,r,t,u,k,m,A,B,f,v,
w,n,x,C,y,z){f=f.geoenrichment.dijit.DataCategoriesPage;return p([x],{templateString:v,nls:f,baseClass:"DataCategoriesPage",items:null,countryID:null,countryBox:!0,dataCollections:{},rowsPerPage:8,_task:null,_list:null,_pageCount:0,_pageSize:0,currentPage:0,shoppingCart:null,selection:null,flyAnim:null,scrollAnim:null,constructor:function(){this._task=new w(n.server);this._task.token=n.token;this.scrollAnim=new y;this._ltr=m.isBodyLtr()},buildRendering:function(){this.inherited(arguments);this.pagination.createItemContainer=
this._createItemContainer;this.pagination.updateItemContainer=this._updateItemContainer;t.after(this.layoutGrid,"resize",r.hitch(this.pagination,this.pagination.resize))},startup:function(){this.inherited(arguments);this.countryBox?(this.countrySelect.set("labelAttr","label"),this.countrySelect.set("searchAttr","label"),this.countrySelect.store.idProperty="value",this.countrySelect.set("item",{value:"_",label:f.loading},null,f.loading),this.countrySelect.set("disabled",!0),this.showProgress(this._task.getAvailableCountries(),
"_onCountriesResponse")):(k.destroy(this.countryDiv),this._loadDataCollections())},_createItemContainer:function(){var a=k.create("div",{"class":"DataCategoriesPage_Item"});return k.create("span",null,a),a},_updateItemContainer:function(a,b){a.childNodes[0].innerHTML=b.name;a.className="DataCategoriesPage_Item DataBrowser_Clickable DataCategoriesPage_Item_"+b.id.replace(/ /g,"_");a.data=b},_onItemClick:function(a){if(this.flyAnim){if(!this._ltr){var b=m.position(a);a.style.right=""+(window.innerWidth-
b.x-b.w)+"px"}b=this.flyAnim.fly(a,"Breadcrumb_SelectCategory");b.innerHTML="";u.remove(b,"DataBrowser_Clickable");this._ltr||(a.style.right="auto")}this.onSelect(a.data)},_coerceCurrentPage:function(a){return 0>a?a=0:a>=this._pageCount&&(a=this._pageCount-1),a},_back:function(){this.set("currentPage",this.currentPage-1)},_forward:function(){this.set("currentPage",this.currentPage+1)},_onCountriesResponse:function(a){this.countrySelect.set("disabled",!1);for(var b=[{value:"_",label:f.global}],e=0;e<
a.length;e++)b.push({value:a[e].id,label:a[e].name});a=new z({data:b,idProperty:"value"});this.countrySelect.set("store",a);this.countrySelect.set("value",this.countryID||"_")},_onCountryChanged:function(){var a=this.countrySelect.get("value");"_"==a&&(a=null);this._set("countryID",a);this._loadDataCollections()},_setCountryIDAttr:function(a){this.countryID!=a&&(this._set("countryID",a),this._started&&this._loadDataCollections())},_loadDataCollections:function(){this.cancelProgress("_onDataCollectionsResponse");
this.showProgress(this._task.getDataCollections(this.countryID,null,"id alias type description popularity fieldCategory vintage filteringTags".split(" ")),"_onDataCollectionsResponse")},_onDataCollectionsResponse:function(a){this.dataCollections||(this.dataCollections={});this.dataCollections[this.countryID]=a?a:{};for(var b,e={},f=[],g=this.selection,h=0;h<a.length;h++){var c=a[h];if(c.fieldCategories={},c.metadata.filters)for(b=0;b<c.metadata.filters.length;b++)c.metadata.filters[b].id=c.metadata.filters[b].id.replace("Diposable",
"Disposable");if(c.metadata.categories){if(c.variables)for(var d=0;d<c.variables.length;d++){c.variables[d].id2=c.id+"."+c.variables[d].id;c.variables[d].hidden=0;c.variables[d].idDesc=c.variables[d].id+"."+c.variables[d].description;for(b=0;b<c.variables[d].filteringTags;b++)c.variables[d].filteringTags[b].value=c.variables[d].filteringTags[b].value.replase("$","");if(g&&g.length)for(b=0;b<g.length;b++)if(g[b]===c.variables[d].id2){f.push(c.variables[d]);break}}for(b=0;b<c.metadata.categories.length;b++){var l=
c.metadata.categories[b],d=l.id.toLowerCase();e[d]?e[d].dataCollections.push(c):e[d]={id:d,name:l.alias,dataCollections:[c],displayOrder:l.displayOrder}}}}this.shoppingCart.setVariables(f);a=[];for(l in e)e.hasOwnProperty(l)&&(e[l].dataCollections.sort(function(a,b){return b.metadata.title<a.metadata.title?1:-1}),a.push(e[l]));a.sort(function(a,b){return b.displayOrder-a.displayOrder});this.set("items",a)},_setItemsAttr:function(a){this._set("items",a);this.pagination.set("items",a);this._started&&
this.resize()},onSelect:function(){},_search:function(){if(this.txbSearch.get("value")){for(var a,b,e=this.txbSearch.get("value"),k=this.get("items"),g=[],h=0;h<k.length;h++)for(var c=0;c<k[h].dataCollections.length;c++){b=k[h].dataCollections[c];a={id:b.id,metadata:b.metadata,keywords:b.keywords,variables:[]};for(var d=0;d<b.variables.length;d++)this._match(b.variables[d],e)&&a.variables.push(b.variables[d]);0<a.variables.length&&g.push(a)}0<g.length?(this._set("selectedCollections",g),this.onSearch("'"+
e+"'")):this.txbSearch.showTooltip(q.substitute(f.noResults,{seachKey:e}))}},_match:function(a,b){return a.alias&&-1!==a.alias.toLowerCase().indexOf(b.toLowerCase())||a.description&&-1!==a.description.toLowerCase().indexOf(b.toLowerCase())||a.fieldCategory&&-1!==a.fieldCategory.toLowerCase().indexOf(b.toLowerCase())},onSearch:function(){}})});