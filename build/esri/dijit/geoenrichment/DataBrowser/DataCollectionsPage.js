//>>built
require({cache:{"url:esri/dijit/geoenrichment/DataBrowser/templates/DataCollectionsPage.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"row: 0"\x3e\n    \x3cdiv class\x3d"BreadcrumbHeight"\x3e\x3c/div\x3e\n    \x3cdiv class\x3d"DataCollectionsPage_Panel DataCollectionsPage_PanelTop"\x3e\n        \x3cdiv class\x3d"DataCollectionsPage_Header" data-dojo-attach-point\x3d"categoryName"\x3e\x3c/div\x3e\n        \x3cinput type\x3d"text"\n               data-dojo-type\x3d"esri/dijit/geoenrichment/DataBrowser/SearchTextBox"\n               data-dojo-attach-point\x3d"txbSearch"\n               data-dojo-props\x3d"prompt:\'${nls.search}\'"\n               data-dojo-attach-event\x3d"onSearch: _search"\n               class\x3d"DataCollectionsPage_Search" /\x3e\n        \x3cdiv class\x3d"DataCollectionsPage_Header"\x3e\n            ${nls.mapPopVar}\n        \x3c/div\x3e\n        \x3cdiv data-dojo-attach-point\x3d"divVariables" class\x3d"DataCollectionsPage_PopularVariables"\x3e\x3c/div\x3e\n        \x3cdiv class\x3d"DataCollectionsPage_Header"\x3e\n            ${nls.keepBrowse}\n        \x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"row: 1" class\x3d"DataCollectionsPage_DataCollectionContainer" data-dojo-attach-point\x3d"pane"\x3e\n    \x3cdiv data-dojo-type\x3d"esri/dijit/geoenrichment/Pagination" data-dojo-attach-point\x3d"pagination"  data-dojo-attach-event\x3d"onSelect: _onSelectCollection"\x3e\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"row: 2"\x3e\n    \x3cdiv class\x3d"DataCollectionsPage_Panel DataCollectionsPage_PanelBottom"\x3e\n        \x3cdiv data-dojo-attach-point\x3d"spnShowAll" class\x3d"DataCollectionsPage_ShowAll" data-dojo-attach-event\x3d"onClick: _showAll"\x3e${nls.showAll}\x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n'}});
define("esri/dijit/geoenrichment/DataBrowser/DataCollectionsPage","../../../declare dojo/string dojo/_base/lang dojo/aspect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/query dojo/i18n!../../../nls/jsapi dojo/text!./templates/DataCollectionsPage.html dojo/on ../CheckList ../_WizardPage ../Pagination dojo/store/Memory dgrid/List dgrid/Selection dijit/_WidgetBase ../AnimationHelper dijit/Tooltip dojo/_base/window dojo/has dijit/layout/ContentPane dijit/form/Select ./SearchTextBox".split(" "),
function(p,l,d,q,r,g,m,t,h,u,k,v,w,z,x,A,B,C,D,n,y){return h=h.geoenrichment.dijit.DataCollectionsPage,p([w],{templateString:u,nls:h,baseClass:"DataCollectionsPage",_checkList:null,selectedCategory:null,selectedCollection:null,selectedVariables:[],shoppingCart:null,variableInfo:null,multiSelect:!0,flyAnim:null,icon:null,constructor:function(){this._ltr=m.isBodyLtr()},buildRendering:function(){this.inherited(arguments);this._checkList=new v({onSelect:d.hitch(this,this._onSelectVariable),onDeselect:d.hitch(this,
this._onDeselectVariable),selectionMode:this.multiSelect?"toggle":"single"},this.divVariables);this._checkList.renderRow=d.hitch(this,this._renderRow);this.pagination.createItemContainer=this._createItemContainer;this.pagination.updateItemContainer=this._updateItemContainer;q.after(this.layoutGrid,"resize",d.hitch(this.pagination,this.pagination.resize))},_createItemContainer:function(){return g.create("div",{"class":"DataCollectionButton DataBrowser_Clickable TrimWithEllipses"})},_updateItemContainer:function(a,
c){a.innerHTML=c.metadata.title;a.data=c},_renderRow:function(a){var c=g.create("div",{style:"width:100%"}),b=g.create("div",{"class":"TrimWithEllipses"});"single"!=this.selectionMode&&g.create("div",{"class":"dijit dijitInline dijitCheckBox VarCheck"},b);var e=g.create("div",{"class":"DataBrowserInfoIcon"},b);return g.create("span",{"class":"VarLabel",innerHTML:a.description?a.description:a.alias},b),g.place(b,c),k(e,"click",d.hitch(this,this._toggleTooltip,e,a)),k(e,"mouseenter",d.hitch(this,this._showTooltip,
e,a)),k(e,"mouseleave",d.hitch(this,this._hideTooltip,e,a)),k(e,"mousedown,touchstart,MSPointerDown,dgrid-cellfocusin",function(a){a.stopPropagation&&a.stopPropagation()}),c},_toggleTooltip:function(a,c,b){b.stopPropagation&&b.stopPropagation();this._icon?this._hideTooltip():this._showTooltip(a,c,b)},_showTooltip:function(a,c,b){this._icon=a;this.variableInfo.set("variable",c);n.show(this.variableInfo.domNode.outerHTML,a,["above","below"]);b.stopPropagation&&b.stopPropagation();k.once(y.doc,"click",
d.hitch(this,this._hideTooltip))},_hideTooltip:function(){n.hide(this._icon);this._icon=null},_setSelectedCategoryAttr:function(a){if(this._set("selectedCategory",a),a){var c={categoryName:a.name};this.categoryName.innerHTML=l.substitute(h.categoryName,c);this._checkList.set("store",new x({data:this.theMostPopularVars(a,3)}));this.pagination.set("items",a.dataCollections);this.spnShowAll.innerHTML=l.substitute(h.showAll,c);this._started&&this.resize();this._setState("done")}},theMostPopularVars:function(a,
c){var b=[];if(a){for(var e={},f=0;f<a.dataCollections.length;f++)for(var d=0;d<a.dataCollections[f].variables.length;d++){var g=a.dataCollections[f].variables[d];e[g.idDesc]=g}for(var h in e)e.hasOwnProperty(h)&&b.push(e[h]);b=b.sort(function(a,b){return(b.popularity?b.popularity:0)-(a.popularity?a.popularity:0)}).slice(0,c)}return b},_onSelectVariable:function(a){var c=this._checkList.get("selectedItems");this.flyAnim&&a.parentType&&(a=this._checkList.row(a.rows[0]).element,this.flyAnim.fly(t(".VarLabel",
a)[0],"DataBrowser_SelectVar",["top",this._ltr?"right":"left"]));this._set("selectedVariables",c);for(a=0;a<c.length;a++)this.shoppingCart.addVariable(c[a])},_onDeselectVariable:function(a){this.shoppingCart.removeVariable(a.rows[0].data.idDesc)},_onSelectCollection:function(a){var c=a.data;if(this.flyAnim){if(!this._ltr){var b=m.position(a);a.style.right=""+(window.innerWidth-b.x-b.w)+"px"}b=this.flyAnim.fly(a,"Breadcrumb_SelectDC",null,!0);r.remove(b,["dgrid-row","dgrid-selected","TrimWithEllipses"]);
this._ltr||(a.style.right="auto")}this._set("selectedCollections",[c]);this.onSelect(this._get("selectedCategory"),c.metadata.title)},_showAll:function(){this._set("selectedCollections",this._get("selectedCategory").dataCollections);this.onSelect(this._get("selectedCategory"),this._get("selectedCategory").name)},_gotoCategories:function(){this.gotoCategories()},gotoCategories:function(){},syncWithShoppingCart:function(){for(var a=this._checkList.store.data,c=this.shoppingCart.content,b=0;b<a.length;b++)this._checkList.select(a[b],
null,!!c[a[b].idDesc])},onRemoveElementFromShoppingCart:function(a){for(var c=this._checkList.store.data,b=0;b<c.length;b++)if(a===c[b].idDesc){this._checkList.select(c[b],null,!1);break}},_search:function(){if(this.txbSearch.get("value")){for(var a,c=this.txbSearch.get("value"),b=this._get("selectedCategory").dataCollections,e=[],f=0;f<b.length;f++){a={id:b[f].id,metadata:b[f].metadata,keywords:b[f].keywords,variables:[]};for(var d=0;d<b[f].variables.length;d++)this._match(b[f].variables[d],c)&&
a.variables.push(b[f].variables[d]);0<a.variables.length&&e.push(a)}0<e.length?(this._set("selectedCollections",e),this.onSelect(this._get("selectedCategory"),"'"+c+"' "+l.substitute(h.from,{categoryName:this._get("selectedCategory").name}))):this.txbSearch.showTooltip(l.substitute(h.noResults,{seachKey:c}))}},_match:function(a,c){return a.alias&&-1!==a.alias.toLowerCase().indexOf(c.toLowerCase())||a.description&&-1!==a.description.toLowerCase().indexOf(c.toLowerCase())||a.fieldCategory&&-1!==a.fieldCategory.toLowerCase().indexOf(c.toLowerCase())}})});