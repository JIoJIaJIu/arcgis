//>>built
define("esri/dijit/geoenrichment/Tapestry","dojo/_base/declare ./BaseWidget dojo/_base/lang dojo/_base/array dojo/on require dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/query dojo/i18n!../../nls/jsapi dojox/html/entities ./dom".split(" "),function(w,x,y,z,A,C,h,D,k,E,l,B,r){function t(a){return"Tapestry_LifeMode"+a.match(/\d+/)[0]}function u(a){return"http://downloads.esri.com/esri_content_doc/dbl/us/tapestry/segment"+a+".pdf"}l=l.geoenrichment.dijit.Tapestry;return w(x,{baseClass:"Infographics_Tapestry",
_mainTable:null,_detailsTable:null,updateUIExpanded:function(){this.inherited(arguments);this._updateUI()},updateUICollapsed:function(){this.inherited(arguments);this._updateUI()},createUIExpanded:function(a){this.inherited(arguments);this._createUI(a)},createUICollapsed:function(a){this.inherited(arguments);this._createUI(a)},_createUI:function(a){a=this._mainTable=a.addContent("table",{"class":"Tapestry_Main_Table"});A(a,".Tapestry_Main_Button:click",y.hitch(this,this._toDetailView));this.expanded?
r.createCols(a,[.25,.4,.35]):r.createCols(a,[.55,.45])},_updateUI:function(){function a(){e=n.insertCell(-1)}function f(a){var c=q._getValue(b,"CODE");k.add(a,"Tapestry_Main_Button Tapestry_Details_Image code_"+(3>c.length?"0"+c:c)+" LifeModeBorder "+t(c));a=h.create("div",null,a);h.create("span",{"class":"Tapestry_thumbnail_Code LifeModeBorder "+t(c),innerHTML:c},a)}this._toMainView();var c,b;for(b=0;3>b&&this._getValue(b,"NAME");b++)c=b+1;var d,n,e,q=this;d=this._mainTable;var m,g;for(b=d.rows.length;c>
b;b++)n=d.insertRow(-1),k.add(n,"Tapestry_LifeMode"),this.expanded&&a(),a(),k.add(e,"Tapestry_Main_Name Tapestry_Main_Button LifeModeColor"),a(),k.add(e,"Tapestry_Main_Pct Tapestry_Main_Button LifeModeColor"),this.expanded&&(a(),k.add(e,"Tapestry_Main_Arrow Tapestry_Main_Button"),h.create("div",null,e));for(;d.rows.length>2*c;)d.deleteRow(-1);m=this.expanded?1:0;g=this.expanded?2:1;for(b=0;c>b;b++){var v=d.rows,p=v[b].cells;this.expanded&&(p[0].removeAttribute("class"),h.empty(p[0]),f(p[0]));p[m].innerHTML=
this._getValue(b,"NAME")+"\x3cbr\x3e\x3cspan class\x3d'Tapestry_Main_Value'\x3e"+this._formatValue(b,"VALUE")+" "+l.hhLabel+"\x3c/span\x3e";p[g].innerHTML=this._formatValue(b,"PRC")+"\x3cbr\x3e\x3cspan class\x3d'Tapestry_Main_PctLabel'\x3e"+l.prtHhLabel+"\x3c/span\x3e";v[b].setAttribute("data-index",b.toString())}},_getValue:function(a,f){return this.getValueByName(0,"TOP"+(a+1).toString()+f)},_formatValue:function(a,f){return this.formatByName(0,"TOP"+(a+1).toString()+f)},_toDetailView:function(a){function f(){z.forEach(b.rows,
function(a){k.remove(a,"clicked")})}var c;a=a.target;for(var b=this._mainTable;a&&a!==b;){if(c=a.getAttribute("data-index")){c=+c;break}a=a.parentNode}if(this.expanded){if(this._detailsTableRow){if(this._detailsTableRow.previousSibling===a)return k.remove(a,"clicked"),void this._toMainView();this._toMainView();f()}k.add(a,"clicked");this.createDetailsTable(a);this._createDetailedViewExpanded(c)}else window.open(u(this._getValue(c,"NUM")),"_blank")},createDetailsTable:function(a){this._detailsTableRow=
h.create("tr",null,a,"after");a=h.create("td",{colSpan:"4"},this._detailsTableRow);this._detailsTable=h.create("table",{"class":"Tapestry_Details_Table"},a);r.createCols(this._detailsTable,[.35,.35,.3])},_createDetailedViewExpanded:function(a){function f(){n=q.insertRow(-1)}function c(a){e=n.insertCell(-1);a&&k.add(e,a)}function b(a,b,c){var d={};return a&&(d["class"]=a),b&&(d.innerHTML=B.encode(b)),h.create("div",d,c||e)}function d(d,e){c("Tapestry_Details_FieldCell");var f=b("LifeModeBorder");b("Tapestry_Details_Label",
d,f);b(null,m._formatValue(a,e),f)}var n,e,q=this._detailsTable,m=this,g=m._getValue(a,"CODE");k.add(q,t(g));3>g.length&&(g="0"+g);f();d(l.hhTypeLabel,"TYPE");d(l.medianAgeLabel,"AGE");c("Tapestry_Details_Image household code_"+g);e.rowSpan=2;b();b(null,m._getValue(a,"TYPE"));f();d(l.employmentLabel,"JOB");d(l.educationLabel,"EDUCATION");f();d(l.incomeLabel,"INCOME");d(l.raceEthnicityLabel,"RACE");c("Tapestry_Details_Image housing code_"+g);e.rowSpan=2;b();b(null,m._getValue(a,"HOUSE"));f();c();e.colSpan=
2;g=h.create("a",{href:u(m._getValue(a,"NUM")),target:"_blank"},e);b("Tapestry_Details_Name","View full segment profile",g)},_toMainView:function(){this._detailsTableRow&&(h.destroy(this._detailsTableRow),this._detailsTable=null,this._detailsTableRow=null)}})});