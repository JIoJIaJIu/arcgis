//>>built
require({cache:{"url:esri/dijit/LayerList/templates/LayerList.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\n  \x3cdiv role\x3d"menu" data-dojo-attach-point\x3d"_container" class\x3d"${css.container}"\x3e\n    \x3cul role\x3d"group" class\x3d"${css.list}" data-dojo-attach-point\x3d"_layersNode"\x3e\x3c/ul\x3e\n    \x3cdiv class\x3d"${css.noLayersText}" data-dojo-attach-point\x3d"_noLayersNode"\x3e\x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'}});
define("esri/dijit/LayerList","dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel ../kernel dojo/uacss dojo/Deferred dojo/on dojo/query dojo/dom-class dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/i18n!../nls/jsapi dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin ../promiseList ../layerUtils dojo/text!./LayerList/templates/LayerList.html".split(" "),function(m,v,l,L,M,N,A,n,E,h,B,k,p,w,C,O,P,Q,R,S){var T=m.some(["ar","he"],function(a){return-1!==L.locale.indexOf(a)});
v=v([O,P],{templateString:S,defaults:{theme:"esriLayerList",map:null,layers:null,showSubLayers:!0,showOpacitySlider:!1,showLegend:!1,removeUnderscores:!0,visible:!0},constructor:function(a){a=l.mixin({},this.defaults,a);this.set(a);this.css={container:"esriContainer",noLayers:"esriNoLayers",noLayersText:"esriNoLayersText",slider:"esriSlider",sliderLabels:"esriSliderLabels",legend:"esriLegend",tabContainer:"esriTabContainer",tabs:"esriTabs",tabMenu:"esriTabMenu",tabMenuItem:"esriTabMenuItem",tabMenuSelected:"esriTabMenuSelected",
tabMenuVisible:"esriTabMenuVisible",tab:"esriTab",tabSelected:"esriTabSelected",toggleButton:"esriToggleButton",iconCollapse:"esri-icon-down",iconExpand:T?"esri-icon-left":"esri-icon-right",list:"esriList",listExpand:"esriListExpand",subListExpand:"esriSubListExpand",listVisible:"esriListVisible",subList:"esriSubList",hasSubList:"esriHasSubList",hasButton:"esriHasButton",hasTabContent:"esriHasTabContent",subListLayer:"esriSubListLayer",layer:"esriLayer",layerScaleInvisible:"esriScaleInvisible",title:"esriTitle",
titleContainer:"esriTitleContainer",checkbox:"esriCheckbox",label:"esriLabel",button:"esriButton",content:"esriContent",clearFix:"esriClearFix",clear:"esriClear"}},postCreate:function(){this.inherited(arguments);var a=this;this.own(n(this._layersNode,n.selector("."+this.css.checkbox,"change"),function(){var c,b;c=p.get(this,"data-layer-index");b=p.get(this,"data-sublayer-index");a._toggleLayer(c,b);a._toggleState(c,b)}));this.own(n(this._layersNode,n.selector("."+this.css.tabMenuItem,C.press),function(){var c=
p.get(this,"data-layer-index"),b=p.get(this,"data-tab-id");a._toggleTab(c,b)}));this.own(n(this._layersNode,n.selector("."+this.css.toggleButton,C.press),function(){var c=p.get(this,"data-layer-index");a._toggleExpand(c)}))},startup:function(){this.inherited(arguments);this._mapLoaded(this.map).then(l.hitch(this,this._init))},destroy:function(){this._removeEvents();this.inherited(arguments)},refresh:function(){var a=this.layers;this._nodes=[];var c=[];if(a&&a.length)for(var b=0;b<a.length;b++)c.push(this._layerLoaded(b));
return Q(c).always(l.hitch(this,function(a){this._loadedLayers=a;this._removeEvents();this._createLayerNodes();this._setLayerEvents();this.emit("refresh")}))},_mapLoaded:function(a){var c=new A;return a?a.loaded?c.resolve():n.once(a,"load",l.hitch(this,function(){c.resolve()})):c.resolve(),c.promise},_toggleExpand:function(a){a=parseInt(a,10);if(a=this._nodes[a]){var c=a.layer;h.toggle(c,this.css.listExpand);c=h.contains(c,this.css.listExpand);p.set(a.toggle,"title",c?w.widgets.layerList.collapse:
w.widgets.layerList.expand);h.toggle(a.toggle,this.css.iconCollapse,c);h.toggle(a.toggle,this.css.iconExpand,!c)}},_toggleTab:function(a,c){a=parseInt(a,10);var b=this._nodes[a];if(b){var d;d=b.tabMenu;var b=E("[data-tab-id]",b.tabs),f=E("[data-tab-id]",d);for(d=0;d<b.length;d++){var e=p.get(b[d],"data-tab-id");h.toggle(b[d],this.css.tabSelected,c===e)}for(d=0;d<f.length;d++)b=p.get(f[d],"data-tab-id"),h.toggle(f[d],this.css.tabMenuSelected,c===b)}},_layerLoaded:function(a){var c=this.layers[a],b=
c.layer,d={layer:b,layerInfo:c,layerIndex:a},f=new A;if(b)if(b.loaded)f.resolve(d);else if(b.loadError)f.reject(b.loadError);else{var e,g;e=n.once(b,"load",l.hitch(this,function(){g.remove();f.resolve(d)}));g=n.once(b,"error",l.hitch(this,function(a){e.remove();f.reject(a)}))}else f.resolve(d);return f.promise},_checkboxStatus:function(a){return!!a.visibility},_WMSVisible:function(a,c){var b=[];return a&&a.layer&&(b=a.layer.visibleLayers),-1<m.indexOf(b,c.name)},_subCheckboxStatus:function(a,c){var b;
switch(a.layer.declaredClass){case "esri.layers.KMLLayer":b=c.visible;break;case "esri.layers.WMSLayer":b=this._WMSVisible(a,c);break;default:c.defaultVisibility=a.layer&&a.layer.visibleLayers&&-1!==a.layer.visibleLayers.indexOf(c.id)?!0:!1,b=c.defaultVisibility}return b},_getLayerTitle:function(a){var c="",b=a.layer;a=a.layerInfo;return a&&a.title?c=a.title:b&&b.arcgisProps&&b.arcgisProps.title?c=b.arcgisProps.title:b&&b.name?c=b.name:a&&a.id?c=a.id:b&&b.id&&(c=b.id),this.removeUnderscores?c.replace(/_/g,
" "):c},_showSublayers:function(a){return a.hasOwnProperty("showSubLayers")?a.showSubLayers:this.showSubLayers},_opacityChange:function(a){if(this.layer)this.layer.setOpacity(a);else if(this.layers)for(var c=0;c<this.layers.length;c++)this.layers[c].layerObject&&this.layers[c].layerObject.setOpacity(a)},_legend:function(a,c,b){var d=k.create("div",{role:"tabpanel","data-tab-id":"legend",className:this.css.tab+" "+this.css.legend},a);require(["esri/dijit/Legend"],l.hitch(this,function(a){var e=[c];
if(c&&c.featureCollection&&c.featureCollection.layers)for(var e=c.featureCollection.layers,g=0;g<e.length;g++)e[g].layer=e[g].layerObject;a=new a({map:this.map,layerInfos:e},k.create("div"));k.place(a.domNode,d);a.startup();this._nodes[b].legend=a}))},_slider:function(a,c,b,d){a=k.create("div",{role:"tabpanel","data-tab-id":"opacity",className:this.css.tab+" "+this.css.slider},a);var f=k.create("div",{},a),e=k.create("div",{},a);require(["dijit/form/HorizontalSlider","dijit/form/HorizontalRuleLabels"],
l.hitch(this,function(a,h){var k=new a({showButtons:!1,minimum:.1,maximum:1,layer:c,layers:b,discreteValues:.1,intermediateChanges:!0,value:d,onChange:this._opacityChange},f),p=new h({container:"bottomDecoration",count:0,className:this.css.sliderLabels,labels:["0","50","100"]},e);k.startup();p.startup()}))},_createLayerNodes:function(){this._layersNode.innerHTML="";this._noLayersNode.innerHTML="";h.remove(this._container,this.css.noLayers);var a=this._loadedLayers;if(a&&a.length)for(var c=0;c<a.length;c++){var b=
a[c];if(b){var d=b.layer,f=b.layerIndex,e=b.layerInfo;if(e){if(e.featureCollection&&!e.hasOwnProperty("visibility")){var g=e.featureCollection.layers[0];g&&g.layerObject&&(e.visibility=g.layerObject.visible)}d&&!e.hasOwnProperty("visibility")&&(e.visibility=e.layer.visible);d&&!e.hasOwnProperty("id")&&(e.id=e.layer.id);var y,g=k.create("li",{role:"menuitem",className:this.css.layer});d&&!d.visibleAtMapScale&&h.add(g,this.css.layerScaleInvisible);k.place(g,this._layersNode,"first");var l,m=k.create("div",
{className:this.css.title},g),n=k.create("div",{className:this.css.tabContainer},g),D=k.create("ul",{role:"tablist",className:this.css.tabMenu+" "+this.css.clearFix},n),n=k.create("div",{className:this.css.tabs},n),v=[];d&&(l=d.declaredClass);var x=this._checkboxStatus(e),t=k.create("div",{className:this.css.titleContainer},m),r=this.id+"_checkbox_"+f,u=k.create("input",{type:"checkbox",id:r,"data-layer-index":f,className:this.css.checkbox},t);p.set(u,"checked",x);var F,q=k.create("div",{tabindex:0,
role:"button","data-layer-index":f,title:w.widgets.layerList.expand,className:this.css.toggleButton+" "+this.css.iconExpand},t);e.button&&(F=e.button,h.add(g,this.css.hasButton),h.add(F,this.css.button),k.place(F,t));b=this._getLayerTitle(b);b=k.create("label",{className:this.css.label,textContent:b},t);p.set(b,"for",r);var G,r=k.create("div",{className:this.css.clear},t);e.content&&(G=e.content,h.add(G,this.css.content),k.place(G,m));if(this._nodes[f]={checkbox:u,title:m,tabMenu:D,tabs:n,titleContainer:t,
label:b,layer:g,toggle:q,clear:r,button:F,content:G,subNodes:v},h.toggle(g,this.css.listVisible,x),d&&(y=d.layerInfos,"esri.layers.KMLLayer"===l&&(y=d.folders),this._showSublayers(e)&&"esri.layers.ArcGISTiledMapServiceLayer"!==l&&y&&y.length)){k.create("li",{tabindex:0,"data-tab-id":"sublayers","data-layer-index":f,role:"tab",className:this.css.tabMenuItem,textContent:w.widgets.layerList.sublayers},D);h.add(g,this.css.hasSubList);h.toggle(g,this.css.subListExpand,x);for(var A,m=k.create("div",{className:this.css.tab,
"data-tab-id":"sublayers",role:"tabpanel"},n),m=k.create("ul",{role:"group",className:this.css.subList},m),x=[],t=0;t<y.length;t++){var z,q=y[t],b=-1,u=null;if("esri.layers.ArcGISDynamicMapServiceLayer"===l?(z=q.id,b=q.parentLayerId):"esri.layers.KMLLayer"===l?(z=q.id,b=q.parentFolderId):"esri.layers.WMSLayer"===l&&(z=q.name,b=-1),-1!==b)u=this._nodes[f].subNodes[b],x[b]?u=x[b]:(r=u.subLayer,u=k.create("ul",{role:"group",className:this.css.subList},r),h.add(r,this.css.hasSubList),h.toggle(r,[this.css.listVisible,
this.css.subListExpand],J),x[b]=u);var J=this._subCheckboxStatus(e,q);J&&!A&&(A=!0);var H=this.id+"_checkbox_sub_"+f+"_"+z,b=k.create("li",{role:"menuitem",className:this.css.subListLayer},u||m),r=k.create("div",{className:this.css.title},b),I=k.create("div",{className:this.css.titleContainer},r),B=k.create("input",{type:"checkbox",id:H,"data-layer-index":f,"data-sublayer-index":z,className:this.css.checkbox},I);p.set(B,"checked",J);q=k.create("label",{className:this.css.label,textContent:q.title||
q.name||""},I);p.set(q,"for",H);H=k.create("div",{className:this.css.clear},I);v[z]={subList:m,subSubList:u,subLayer:b,subTitle:r,subTitleContainer:I,subCheckbox:B,subLabel:q,subClear:H}}}if((e.hasOwnProperty("showLegend")?e.showLegend:this.showLegend)&&(k.create("li",{tabindex:0,role:"tab",className:this.css.tabMenuItem,"data-layer-index":f,"data-tab-id":"legend",textContent:w.widgets.layerList.legend},D),this._legend(n,e,f)),e.hasOwnProperty("showOpacitySlider")?e.showOpacitySlider:this.showOpacitySlider){var C,
K;!d&&e.featureCollection?(C=e.featureCollection.layers,K=e.featureCollection.layers[0].opacity):K=d.opacity;k.create("li",{tabindex:0,"data-tab-id":"opacity",role:"tab",className:this.css.tabMenuItem,"data-layer-index":f,textContent:w.widgets.layerList.opacity},D);this._slider(n,d,C,K)}d=E("."+this.css.tab,n);f=d.length;if(f&&(h.add(g,[this.css.hasTabContent]),h.add(d[0],this.css.tabSelected)),1<f)h.add(g,this.css.tabMenuVisible),g=E("li",D),g.length&&h.add(g[0],this.css.tabMenuSelected)}}}else h.add(this._container,
this.css.noLayers),p.set(this._noLayersNode,"textContent",w.widgets.layerList.noLayers)},_removeEvents:function(){if(this._layerEvents&&this._layerEvents.length)for(var a=0;a<this._layerEvents.length;a++)this._layerEvents[a].remove();this._layerEvents=[]},_emitToggle:function(a,c,b){this.emit("toggle",{layerIndex:a,subLayerIndex:c,visible:b})},_toggleVisible:function(a,c){var b=this._nodes[a].checkbox;h.toggle(this._nodes[a].layer,this.css.listVisible,c);var d=p.get(b,"checked");h.contains(this._nodes[a].layer,
this.css.hasSubList)&&h.toggle(this._nodes[a].layer,this.css.subListExpand,d);d!==c&&(p.set(b,"checked",c),this._emitToggle(a,null,c))},_layerVisChangeEvent:function(a,c,b){b=c?a.layerInfo.featureCollection.layers[b].layer:a.layer;var d=n(b,"visibility-change",l.hitch(this,function(b){c?this._featureCollectionVisible(a.layerIndex,b.visible):this._toggleVisible(a.layerIndex,b.visible)}));if(this._layerEvents.push(d),!c)if(d=n(b,"scale-visibility-change",l.hitch(this,function(b){h.toggle(this._nodes[a.layerIndex].layer,
this.css.layerScaleInvisible,!b.target.visibleAtMapScale)})),this._layerEvents.push(d),"esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass)b=n(this.map,"zoom-end",l.hitch(this,function(){this._subLayerScale(a)})),this._layerEvents.push(b),this._subLayerScale(a)},_subLayerScale:function(a){var c=a.layer.createDynamicLayerInfosFromLayerInfos(),b=R._getLayersForScale(this.map.getScale(),c);m.forEach(c,l.hitch(this,function(c){if(!c.subLayerIds){c=c.id;var f=this._nodes[a.layerIndex].subNodes[c];
if(f){var f=f.subLayer,e=!1;-1===m.indexOf(b,c)&&(e=!0);h.toggle(f,this.css.layerScaleInvisible,e)}}}))},_layerEvent:function(a){var c=a.layerInfo;if(c.featureCollection&&c.featureCollection.layers&&c.featureCollection.layers.length){if((c=c.featureCollection.layers)&&c.length)for(var b=0;b<c.length;b++)this._layerVisChangeEvent(a,!0,b)}else this._layerVisChangeEvent(a)},_getVisibleLayers:function(a,c){var b,d=a.layerInfos,f=[-1];"undefined"!=typeof c&&(d[c].defaultVisibility=!d[c].defaultVisibility);
for(b=0;b<d.length;b++){var e=d[b];e.defaultVisibility&&(f.push(e.id),e=m.lastIndexOf(f,-1),-1!==e&&f.splice(e,1))}d=[];for(b=0;b<f.length;b++)e=f[b],this._allIdsPresent(a,e,f)&&d.push(e);b=[];for(f=0;f<d.length;f++)(e=this._getLayerInfo(a,d[f]))&&null===e.subLayerIds&&b.push(d[f]);return b.length||(b=[-1]),b},_toggleState:function(a,c){var b,d;a=parseInt(a,10);var f=this._nodes[a];f.legend&&f.legend.refresh();null!==c?(c=parseInt(c,10),b=f.subNodes[c].subLayer,d=f.subNodes[c].subCheckbox):(b=f.layer,
d=f.checkbox);d=p.get(d,"checked");h.contains(b,this.css.hasSubList)&&h.toggle(b,this.css.subListExpand,d);h.toggle(b,this.css.listVisible,d)},_toggleLayer:function(a,c){if(this.layers&&this.layers.length){var b;a=parseInt(a,10);var d,f=this.layers[a],e=f.layer;e&&(d=e.declaredClass);var g,h=f.featureCollection;if(h)for(b=!f.visibility,f.visibility=b,g=0;g<h.layers.length;g++)h.layers[g].layerObject.setVisibility(b);else if(e)if(null!==c)if("esri.layers.ArcGISDynamicMapServiceLayer"===d)c=parseInt(c,
10),g=this._getVisibleLayers(e,c),e.setVisibleLayers(g);else if("esri.layers.KMLLayer"===d)for(c=parseInt(c,10),h=e.folders,g=0;g<h.length;g++){if(d=h[g],d.id===c){e.setFolderVisibility(d,!d.visible);break}}else"esri.layers.WMSLayer"===d&&(g=e.visibleLayers,h=m.indexOf(g,c),-1===h?g.push(c):g.splice(h,1),e.setVisibleLayers(g));else"esri.layers.ArcGISDynamicMapServiceLayer"===d&&(g=this._getVisibleLayers(e),e.setVisibleLayers(g)),b=!e.visible,f.visibility=b,e.setVisibility(b);else b=!f.visible,f.setVisibility(b);
this._emitToggle(a,c,b)}},_featureCollectionVisible:function(a,c){var b=this.layers[a],d=b.visibleLayers,f=b.featureCollection.layers;(d&&d.length?m.every(d,function(a){return f[a].layer.visible===c}):m.every(f,function(a){return a.layer.visible===c}))&&this._toggleVisible(a,c)},_setLayerEvents:function(){var a=this._loadedLayers;if(a&&a.length)for(var c=0;c<a.length;c++){var b=a[c];b.layer&&this._layerEvent(b)}},_allIdsPresent:function(a,c,b){a=this._walkUpLayerIds(a,c);return m.every(a,function(a){return-1<
m.indexOf(b,a)})},_walkUpLayerIds:function(a,c){var b;b=this._getLayerInfo(a,c);var d=[];if(b)for(;-1!==b.parentLayerId;)(b=this._getLayerInfo(a,b.parentLayerId))&&d.push(b.id);return d},_getLayerInfo:function(a,c){for(var b,d=0;d<a.layerInfos.length;d++){var f=a.layerInfos[d];if(f.id===c){b=f;break}}return b},_isSupportedLayerType:function(a){return a&&!a._basemapGalleryLayerType||a&&"basemap"!==a._basemapGalleryLayerType},_createLayerInfo:function(a){return{layer:a}},_updateAllMapLayers:function(){if(this.map&&
(!this.layers||!this.layers.length)){var a=[];m.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);this._isSupportedLayerType(c)&&a.push(this._createLayerInfo(c))},this);m.forEach(this.map.graphicsLayerIds,function(c){c=this.map.getLayer(c);this._isSupportedLayerType(c)&&c._params&&c._params.drawMode&&a.push(this._createLayerInfo(c))},this);this._set("layers",a)}},_init:function(){this._visible();this._updateAllMapLayers();this.refresh().always(l.hitch(this,function(){this.set("loaded",
!0);this.emit("load")}))},_visible:function(){this.visible?B.set(this.domNode,"display","block"):B.set(this.domNode,"display","none")},_setThemeAttr:function(a){this.domNode&&(h.remove(this.domNode,this.theme),h.add(this.domNode,a));this._set("theme",a)},_setMapAttr:function(a){this._set("map",a);this._created&&this._mapLoaded(this.map).then(l.hitch(this,function(){this._updateAllMapLayers();this.refresh()}))},_setLayersAttr:function(a){this._set("layers",a);this._created&&this.refresh()},_setRemoveUnderscoresAttr:function(a){this._set("removeUnderscores",
a);this._created&&this.refresh()},_setShowSubLayersAttr:function(a){this._set("showSubLayers",a);this._created&&this.refresh()},_setShowOpacitySliderAttr:function(a){this._set("showOpacitySlider",a);this._created&&this.refresh()},_setShowLegendAttr:function(a){this._set("showLegend",a);this._created&&this.refresh()},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()}});return N("extend-esri")&&l.setObject("dijit.LayerList",v,M),v});