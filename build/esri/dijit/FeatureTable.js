//>>built
require({cache:{"url:esri/dijit/FeatureTable/templates/FeatureTable.html":'\x3cdiv class\x3d"${baseClass}" \x3e\n  \x3cdiv id\x3d "${gridBorderContainerId}" class\x3d"esri-feature-table-border-container" data-dojo-attach-point\x3d "_gridBorderContainer" data-dojo-type\x3d"dijit.layout.BorderContainer" gutters\x3d"false"\x3e\n    \x3cdiv id\x3d "${gridHeaderId}" class\x3d"esri-feature-table-content-pane esri-feature-table-menu" data-dojo-attach-point\x3d "_gridHeaderNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'top\'"\x3e\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-loading-indicator" data-dojo-attach-point\x3d "_gridLoadingIndicatorNode" style\x3d"display:none;"\x3e\x3c/div\x3e\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-title" data-dojo-attach-point\x3d "_gridTitleNode"\x3e\x3c/div\x3e\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-closer-container"\x3e\x3ca class\x3d "esri-feature-table-closer toggleOpened" data-dojo-attach-point\x3d"tableCloseButton" href\x3d"JavaScript:void(0);" title\x3d"Hide Table"\x3e\x3c/a\x3e\x3c/div\x3e   \n      \x3cdiv data-dojo-attach-point\x3d "_menuNode" class\x3d"esri-feature-table-menu-item esri-feature-table-menu-options"\x3e\n        \x3cdiv id\x3d"${gridMenuNodeId}"\x3e\x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv id\x3d "${gridContentPaneId}" class\x3d"esri-feature-table-content-pane" data-dojo-attach-point\x3d "_gridContentPane" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\'"\x3e\n      \x3cdiv id\x3d"${gridId}" class\x3d"esri-feature-table-grid" data-dojo-attach-point\x3d"_gridNode"\x3e\x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'}});
define("esri/dijit/FeatureTable","dojo/aspect dojo/on dojo/Deferred dojo/DeferredList dojo/Evented dojo/has dojo/date/locale dojo/promise/all dojo/query dojo/number dojo/string dojo/dom-construct dojo/dom-class dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/text!../dijit/FeatureTable/templates/FeatureTable.html dojo/i18n!../nls/jsapi dojo/store/Cache dojo/store/Memory dojo/store/Observable dojo/fx/Toggler dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dijit/Menu dijit/MenuItem dijit/form/DropDownButton dijit/form/TimeTextBox dijit/form/DateTextBox dijit/form/NumberTextBox dijit/form/Button dijit/form/Select dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/editor dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer ../kernel ../lang ../config ../geometry/Extent ../layers/FeatureLayer ../tasks/query ../tasks/StatisticDefinition ../tasks/QueryTask ../dijit/FeatureLayerQueryStore dijit/layout/BorderContainer dijit/layout/ContentPane dojo/query!css2 dojo/domReady!".split(" "),
function(G,h,z,U,A,V,W,X,Y,w,u,k,q,Z,H,c,n,aa,l,ba,I,ca,da,ea,fa,ga,ha,ia,J,C,ja,ka,K,D,L,E,M,N,O,P,B,la,Q,R,S,ma,x,F,T,na,v,oa,pa,y){A=H([ea,fa,ga,ha,A],{baseClass:"esri-feature-table",loaded:!1,templateString:aa,widgetsInTemplate:!0,i18n:l,dataStore:null,featureCount:0,columns:[],idProperty:"id",grid:null,gridMenu:null,gridMenuAnchor:null,css:{featureTableColumnHeader:"esri-feature-table-column-header",featureTableColumnHeaderTitle:"esri-feature-table-column-header-title",featureTableColumnHeaderType:"esri-feature-table-column-header-type",
collapsed:"collapsed",expando:"expando",headerGear:"esri-feature-table-gear",settingsIcon:"esri-icon-settings",lockedIcon:"esri-icon-locked",menuItem:"esri-feature-table-menu-item",dialog:"esri-feature-table-dialog"},featureLayer:null,map:null,layerInfo:{idArray:[],fieldInfos:[]},fieldInfos:[],gridOptions:{},dateOptions:{},selectedRows:[],selectedRowIds:[],hiddenFields:[],outFields:["*"],editable:!1,syncSelection:!0,zoomToSelection:!0,showDataTypes:!1,showGridHeader:!0,showGridMenu:!0,menuFunctions:[],
_defaultDateOptions:{timeEnabled:!1,timePattern:null,datePattern:null},_defaultGridOptions:{noDataMessage:"No Data",allowSelectAll:!1,cellNavigation:!1,selectionMode:"extended",pagination:!1,allowTextSelection:!1,pageSizeOptions:[10,25,50]},_queryStore:null,_memoryStore:null,_featureSet:null,_orderByFields:null,_editorTrackingInfos:{},_userIds:{},_featureSelectedCount:0,_filteredRowIds:[],_gridQuery:!1,_activeEditors:[],_rollbackInfos:[],_batchCount:0,_defaultBatchCount:1E3,_defaultFeatureCount:2E3,
_toggler:null,_expandedNodes:[],_nestedGrids:[],_i18nStrings:{gridHeader:l.widgets.FeatureTable.gridHeader,loadingData:l.widgets.FeatureTable.loadingData,untitled:l.widgets.FeatureTable.untitled,dataError:l.widgets.FeatureTable.dataError,sortAsc:l.widgets.FeatureTable.sortAsc,sortDesc:l.widgets.FeatureTable.sortDesc,statistics:l.widgets.FeatureTable.statistics,close:l.widgets.FeatureTable.close,defaultSort:l.widgets.FeatureTable.defaultSort,showSelected:l.widgets.FeatureTable.showSelected,clearSelection:l.widgets.FeatureTable.clearSelection,
toggleColumns:l.widgets.FeatureTable.toggleColumns,add:l.widgets.FeatureTable.add,show:l.widgets.FeatureTable.show,hide:l.widgets.FeatureTable.hide,attachments:l.widgets.FeatureTable.attachments,owners:l.widgets.FeatureTable.owners,parenValue:l.widgets.FeatureTable.parenValue,date:l.widgets.FeatureTable.date,number:l.widgets.FeatureTable.number,string:l.widgets.FeatureTable.string},constructor:function(a,b){b&&this.set({gridId:b+"_grid",gridBorderContainerId:b+"_gridBorderContainer",gridHeaderId:b+
"_gridHeaderNode",gridContentPaneId:b+"_gridContentPane",gridMenuNodeId:b+"_menuNode"})},postMixInProperties:function(){this.inherited(arguments);this.set("gridOptions",c.mixin(this._defaultGridOptions,this.gridOptions));this.set("dateOptions",c.mixin(this._defaultDateOptions,this.dateOptions));this._GridDefinition=this._generateGridDefinition()},postCreate:function(){this.inherited(arguments);this._listenerHandles=[]},startup:function(){this.inherited(arguments);var a=this.get("featureLayer");return a&&
a.loadError?void this._showLoadError(a.loadError.message):void(this.domNode&&a.loaded?this._init():this.own(h(a,"load",c.hitch(this,function(){this._init()})),h(a,"error",c.hitch(this,function(){this._showLoadError(a.loadError?a.loadError.message:"")}))))},refresh:function(){this.grid.refresh()},destroy:function(){this.inherited(arguments);n.forEach(this._listenerHandles,function(a){a.remove()});this.gridMenu&&this.gridMenu.destroy();this.statisticsDialog&&this.statisticsDialog.destroy();this.columnMenu&&
this.columnMenu.destroyRecursive();this.grid&&this.grid._destroyColumns();delete this.columns;delete this.layerInfo},resize:function(){this._resize()},selectRows:function(a){this._closeEditors();var b,e=[],d=[];if(this.grid.clearSelection(),a[0]&&"esri.Graphic"===a[0].declaredClass&&(n.forEach(a,function(a){d.push(a.attributes[this.idProperty])},this),a=d),1===a.length){b=a[0];a=this.dataStore.get(a);var g=this.dataStore.data.indexOf(a);this.grid.select(b);this._updateGridSelection().then(c.hitch(this,
function(){this._updateGridHeaderText();this.grid.scrollTo({x:0,y:this.grid.rowHeight*g});this.grid.row(b).element&&this.grid.row(b).element.scrollIntoView()}))}else n.forEach(a,function(a){e.push(this.dataStore.get(a))},this),this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText()}))},filterSelectedRecords:function(a){a?this._showSelectedRecords():(this.grid.set("query",{}),this.set("_gridQuery",!1))},clearSelection:function(){this._clearSelection()},getRowDataById:function(a){return this.grid.row(a).data},
getFeatureDataById:function(a){var b=new v;return b.objectIds=[a],b.outFields=["*"],this.featureLayer.queryFeatures(b,c.hitch(this,function(a){return a.features[0]}))},_init:function(){this.set("idProperty",this.featureLayer.objectIdField);this._getLayerInfo();this._getEditingInfo();var a=x.isDefined(this.featureLayer.maxRecordCount)?this.featureLayer.maxRecordCount:1E3;this._batchCount=Math.min(a,this._defaultBatchCount);this.grid=this._generateGrid();this.grid.startup();this.grid.resize();this._listenerHandles.push(this._gridSelectListener(),
this._gridDeselectListener(),this._gridDataChangeListener(),this._gridRefreshListener(),this._gridColumnStateChangeListener(),this._gridColumnResizeListener(),this._gridErrorListener(),this._gridSortListener(),this._gridFilterListener(),this._gridEditorShowListener(),this._gridEditorHideListener());this.showGridMenu&&this._createTableMenu();this.showGridHeader||Z.set(this._gridHeaderNode.domNode,"display","none");this._toggler=this._createTableToggle();this._listenerHandles.push(this._tableToggleClickCallback(),
this._columnClickCallback(),this._layerClickCallback(),this._applyEditsListener());this.set("loaded",!0);this.emit("load",this.loaded);this.grid.set("noDataMessage","");this._gridTitleNode.innerHTML=this._i18nStrings.loadingData;this._resize();this._toggleLoadingIndicator(!0);this._createStoreFromDataQuery()},_generateGridDefinition:function(){return H(this.gridOptions.pagination?[Q,M,N,B,O,P,R,S,la]:[Q,M,N,B,O,P,R,S])},_generateGrid:function(){var a=this,b=this.get("gridOptions"),e=this.get("columns"),
d=new (this._generateGridDefinition())({columns:e,sort:this.get("idProperty"),noDataMessage:"",selectionMode:b.selectionMode,allowSelectAll:b.allowSelectAll,allowTextSelection:b.allowTextSelection,cellNavigation:b.cellNavigation,keepScrollPosition:!0,pageSizeOptions:b.pageSizeOptions,minRowsPerPage:this.get("_batchCount"),maxRowsPerPage:this.get("_batchCount"),queryRowsOverlap:0,pagingDelay:1E3,renderRow:function(b){return a._renderExpandoRow(b,this)}},this.get("gridId"));return G.before(d,"removeRow",
c.hitch(this,function(a){n.forEach(e.length,function(b,e){var c=d.cell(a,e).element;(c=(c.contents||c).widget)&&c.destroyRecursive()},this)})),G.after(d,"renderHeader",c.hitch(this,function(){d._sortListener.remove()})),d},_renderExpandoRow:function(a,b){var e=k.create("div",{className:"collapsed"});return e.appendChild(this._GridDefinition.prototype.renderRow.apply(b,arguments)),k.create("div",{className:"expando"},e),e},_createStoreFromDataQuery:function(){this.get("dataStore")&&(this._toggleLoadingIndicator(!0),
this._gridTitleNode.innerHTML=this._i18nStrings.loadingData,this.grid.set({store:null,noDataMessage:""}),this.set("dataStore",null));this._getFeatureCount().then(c.hitch(this,this._queryFeatureLayerSetup))},_getFeatureCount:function(){var a=new v;return a.returnGeometry=!1,a.returnIdsOnly=!1,a.where="1\x3d1",F.defaults.io.timeout=1E4,this.featureLayer.queryCount(a).then(c.hitch(this,function(a){return F.defaults.io.timeout=6E4,this.set("featureCount",a),a}),c.hitch(this,function(){return F.defaults.io.timeout=
6E4,this.set("featureCount",this.layerInfo.isFeatureCollection?this.featureLayer.graphics.length:this._defaultFeatureCount),this.featureCount}))},_getAllIds:function(){var a=new z,b=this.get("featureLayer"),e=new v;return e.returnGeometry=!1,e.outFields=[this.idProperty],e.where="1\x3d1",e.returnIdsOnly=!0,b.queryIds(e).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a},_queryFeatureLayer:function(a){var b=new z,e=this.get("featureLayer"),d=new v;return d.where="1\x3d1",d.returnGeometry=
!1,d.objectIds=a,e.queryFeatures(d,function(a){b.resolve(a)}),b},_queryFeatureLayerSetup:function(){var a=this.get("featureLayer");return this.layerInfo.isFeatureCollection?void this._queryFeatureCollection():void this._queryFeatureLayer().then(c.hitch(this,function(b){if(this._updateFieldInfos(b.fields),this._generateColumnsFromFieldInfos(),this.grid.set("columns",this.get("columns")),this._updateGridHeaderText(),b.exceededTransferLimit)if(a.advancedQueryCapabilities&&!a.advancedQueryCapabilities.supportsPagination){if(this.layerInfo.idArray&&
0<this.layerInfo.idArray.length)return this._generateCacheStore(this.layerInfo.idArray),void this.grid.set("store",this.dataStore);this._getAllIds().then(c.hitch(this,function(a){this.layerInfo.idArray=a;this._generateCacheStore(a);this.grid.set("store",this.dataStore)}),function(a){this._showLoadError(a.message)})}else this._generateCacheStore();else this._generateMemoryStore(b.features);this.grid.set("store",this.dataStore)}),c.hitch(this,function(a){this._showLoadError(a.message);this.grid.set("noDataMessage",
this.gridOptions.noDataMessage)}))},_queryFeatureCollection:function(){this.grid.set("noDataMessage",this.gridOptions.noDataMessage);this._updateFieldInfos(this.featureLayer.fields);this._generateColumnsFromFieldInfos();this.grid.set("columns",this.get("columns"));this._updateGridHeaderText();this._generateMemoryStore(this.featureLayer.graphics);this.layerInfo.features=this.featureLayer.graphics;this.grid.set("store",this.dataStore);this._toggleLoadingIndicator(!1)},_generateCacheStore:function(a){var b,
e;b=this.get("featureLayer");a=new y({layer:b,objectIds:a,totalCount:this.featureCount,batchCount:this._batchCount,where:"1\x3d1",orderByFields:this._orderByFields});b=new I;e=new ba(a,b,{});this.set({_queryStore:a,_memoryStore:b,dataStore:e});this.grid.set("noDataMessage",this.gridOptions.noDataMessage);this._toggleLoadingIndicator(!1)},_generateMemoryStore:function(a){var b=[];n.forEach(a,function(a){b.push(a.attributes)},this);this.dataStore=new ca(new I({data:b,idProperty:this.get("idProperty")}));
this.grid.set("noDataMessage",this.gridOptions.noDataMessage);this._toggleLoadingIndicator(!1)},_getAllDataFromCache:function(){var a,b;a=this.get("featureCount");var e=this.featureLayer.maxRecordCount,d=Math.ceil(a/e),g=[];for(b=0;d>b;b++)a=e*b,g.push(this._queryCacheStore(e,a));return new U(g)},_queryCacheStore:function(a,b){var e=new z;return this.dataStore.query(null,{sort:[{attribute:this.idProperty,descending:!0}],count:a,start:b}).then(function(a){e.resolve(a)}),e},_getLayerInfo:function(){var a=
{},b=this.featureLayer,e=b.id||b.layerId;b.credential&&(this._userIds[e]=this.featureLayer.credential.userId);a.userId&&(this._userIds[e]=a.userId);a.isFeatureCollection=b._collection&&!0===b._collection||null===b.url&&null===b._url?!0:!1;a.idProperty=this.get("idProperty");a.layerId=e;a.editable=b.isEditable();a.editCapabilities={};a.typeIdField=b.typeIdField;a.types=b.types;a.fieldInfos=[];a.hasAttachments=b.hasAttachments;this.set("layerInfo",c.clone(a))},_getEditingInfo:function(){this.featureLayer.getEditCapabilities&&
(this.layerInfo.editCapabilities=this.featureLayer.getEditCapabilities());var a=[];this.featureLayer.editFieldsInfo&&(this.featureLayer.editFieldsInfo.creatorField&&a.push(this.featureLayer.editFieldsInfo.creatorField),this.featureLayer.editFieldsInfo.creationDateField&&a.push(this.featureLayer.editFieldsInfo.creationDateField),this.featureLayer.editFieldsInfo.editorField&&a.push(this.featureLayer.editFieldsInfo.editorField),this.featureLayer.editFieldsInfo.editDateField&&a.push(this.featureLayer.editFieldsInfo.editDateField));
this._editorTrackingInfos[this.featureLayer.id]=a},_generateColumnOrder:function(a){var b=[],e=this.outFields;return"*"!==e[0]?(-1===n.indexOf(e,this.idProperty)&&b.push(this._findFirst(a,"name",this.idProperty)),n.forEach(e,function(e){var g=this._findFirst(a,"name",e)||null;g&&e.name!==this.idProperty&&-1===n.indexOf(b,g)&&b.push(g)},this),n.forEach(a,function(a){-1===n.indexOf(b,a)&&b.push(a)},this)):b=c.clone(a),b},_updateFieldInfos:function(a){a=this._generateColumnOrder(a);n.forEach(a,function(a,
e){var d,g,f,r,h=!1,p=this._findFirst(this.featureLayer.fields,"name",a.name)||{},m=this._findFirst(this.fieldInfos,"name",a.name)||null;d=m&&m.alias?m.alias:p.alias;f=p.domain||!1;g=this.layerInfo.typeIdField&&a.name===this.layerInfo.typeIdField||!1;this.layerInfo&&this.layerInfo.types&&n.forEach(this.layerInfo.types,function(e){return e.domains&&e.domains[a.name]?void(h=!0):void 0},this);r=-1!==n.indexOf(this.hiddenFields,a.name)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===a.type||-1!==
n.indexOf(this._editorTrackingInfos[this.featureLayer.id],a.name)||m&&!1===m.visible||"*"!==this.outFields[0]&&-1===n.indexOf(this.outFields,a.name);this.layerInfo.fieldInfos[e]=c.clone({idx:e,name:a.name,alias:d,length:a.length||null,type:a.type,hidden:r,editable:this.editable&&a.name!==this.idProperty&&this.layerInfo.editable&&p&&"undefined"!=typeof p.editable?m&&"undefined"!=typeof m.editable&&!1!==p.editable?m.editable||!1:p.editable:!1,nullable:p.nullable||!1,domain:f,typeId:g,subtypeDomain:h,
format:m&&m.format?m.format:null,dateOptions:m&&m.dateOptions?m.dateOptions:null})},this)},_generateColumnsFromFieldInfos:function(){var a=[];n.forEach(this.layerInfo.fieldInfos,function(b,e){var d=this.layerInfo.fieldInfos[e];"esriFieldTypeDate"===b.type?a.push(b.editable?this._generateDateTimeEditorColumn(b,d):this._generateDateTimeColumn(b,d)):b.domain?a.push(b.editable?this._generateDomainEditorColumn(b,d):this._generateDomainColumn(b,d)):b.typeId?a.push(b.editable?this._generateTypeEditorColumn(b,
d):this._generateTypeColumn(b,d)):b.subtypeDomain?a.push(b.editable?this._generateSubtypeDomainEditorColumn(b,d):this._generateSubtypeDomainColumn(b,d)):"esriFieldTypeInteger"===b.type||"esriFieldTypeSingle"===b.type||"esriFieldTypeDouble"===b.type||"esriFieldTypeSmallInteger"===b.type?a.push(b.editable?this._generateNumberEditorColumn(b,d):this._generateNumberColumn(b,d)):"esriFieldTypeGUID"===b.type||"esriFieldTypeRaster"===b.type||"esriFieldTypeBlob"===b.type||"esriFieldTypeGeometry"===b.type||
"esriFieldTypeXML"===b.type||a.push(b.editable?this._generateStringEditorColumn(b,d):this._generateStringColumn(b,d))},this);this.set("columns",a)},_generateDomainColumn:function(a,b){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(e){e=this._findFirst(b.domain.codedValues,"code",e[a.name]);return null!==e?e.name:null}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateDomainEditorColumn:function(a,b){return{label:a.alias,
field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(e){var d,g;return a.domain.codedValues?(g=this._findFirst(b.domain.codedValues,"code",e[a.name]),d=null!==g?g.name:null):"range"===a.domain.type&&(d=e[a.name]),d}),renderCell:c.hitch(this,function(e,d,g){var f=k.create("div",{innerHTML:d},g),r=[];if(f.innerHTML=d,a.domain.codedValues)n.forEach(b.domain.codedValues,function(b){r.push(e[a.name]===b.code?{label:b.name,value:b.code,selected:!0}:{label:b.name,value:b.code})}),null!==e[a.name]&&
" "!==e[a.name]&&""!==e[a.name]||!a.nullable?null!==e[a.name]&&" "!==e[a.name]&&""!==e[a.name]||a.nullable?a.nullable&&r.push({label:"- empty -",value:"ft_null"}):r.push({label:"- empty -",value:"ft_null",selected:!0,disabled:!0}):r.push({label:"- empty -",value:"ft_null",selected:!0}),h(g,"dblclick",c.hitch(this,function(){this._closeEditors();f.innerHTML="";var d=new E({options:r,style:{width:"100%"}});d.placeAt(f);this.emit("editor-show",{cell:g,editor:d,grid:this.grid});h(d,"blur",c.hitch(this,
function(){var d=this._findFirst(b.domain.codedValues,"code",e[a.name]);f.innerHTML=d?d.name:null}));h(d,"keydown",function(a){13===a.keyCode&&d.focusNode.blur()});h(d,"change",c.hitch(this,function(c){var r={fieldName:a.name,oldValue:e[a.name],rowId:e[this.idProperty],rowObject:e};"ft_null"===c&&(c=null);e[a.name]=c;c=this._findFirst(b.domain.codedValues,"code",c);f.innerHTML=c?c.name:null;d.destroy();this._applyEditsByRow(e,r);this.emit("editor-hide",{cell:g,editor:d,grid:this.grid})}));this._activeEditors.push({id:e[this.idProperty],
widget:d})}));else{if("range"!==a.domain.type)return void this.emit("error","Domain type is not supported.");var qa=a.domain.minValue,p=a.domain.maxValue;h(g,"dblclick",c.hitch(this,function(){this._closeEditors();f.innerHTML="";var b=new D({value:e[a.name],required:!a.nullable,constraints:{min:qa,max:p}});b.placeAt(f);b.focus();b.textbox.select();this.emit("editor-show",{cell:g,editor:b,grid:this.grid});h(b,"blur",c.hitch(this,function(){f.innerHTML=e[a.name]}));h(b,"keydown",function(a){13===a.keyCode&&
b.isValid()&&b.focusNode.blur()});h(b,"change",c.hitch(this,function(d){var c={fieldName:a.name,oldValue:e[a.name],rowId:e[this.idProperty],rowObject:e};b.isValid()?(e[a.name]=d,f.innerHTML=d,b.destroy(),this._applyEditsByRow(e,c)):(f.innerHTML=e[a.name],b.destroy(),this.emit("editor-hide",{cell:g,editor:b,grid:this.grid}))}));this._activeEditors.push({id:e[this.idProperty],widget:b})}))}}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateTypeColumn:function(a){return{label:a.alias,
field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(b){b=this._findFirst(this.layerInfo.types,"id",b[a.name]);return null!==b?b.name:null}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateTypeEditorColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(b){b=this._findFirst(this.layerInfo.types,"id",b[a.name]);return null!==b?b.name:null}),renderCell:c.hitch(this,function(b,e,d){var g=k.create("div",
{innerHTML:e},d),f=[];g.innerHTML=e;n.forEach(this.layerInfo.types,function(e){f.push(b[a.name]===e.id?{label:e.name,value:e.id,selected:!0}:{label:e.name,value:e.id})},this);null!==b[a.name]&&" "!==b[a.name]&&""!==b[a.name]||!a.nullable?null!==b[a.name]&&" "!==b[a.name]&&""!==b[a.name]||a.nullable?a.nullable&&f.push({label:"- empty -",value:"ft_null"}):f.push({label:"- empty -",value:"ft_null",selected:!0,disabled:!0}):f.push({label:"- empty -",value:"ft_null",selected:!0});h(d,"dblclick",c.hitch(this,
function(){this._closeEditors();g.innerHTML="";var e=new E({options:f,style:{width:"100%"}});e.placeAt(g);this.emit("editor-show",{cell:d,editor:e,grid:this.grid});h(e,"blur",c.hitch(this,function(){var e=this._findFirst(this.layerInfo.types,"id",b[a.name]);g.innerHTML=e?e.name:null}));h(e,"keydown",function(a){13===a.keyCode&&e.focusNode.blur()});h(e,"change",c.hitch(this,function(c){var f={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};"ft_null"===c&&(c=null);b[a.name]=
c;c=this._findFirst(this.layerInfo.types,"id",c);g.innerHTML=c?c.name:null;e.destroy();this._applyEditsByRow(b,f);this.emit("editor-hide",{cell:d,editor:e,grid:this.grid})}));this._activeEditors.push({id:b[this.idProperty],widget:e})}))}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateSubtypeDomainColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(b){var e,d=this._findFirst(this.layerInfo.types,"id",
b[this.layerInfo.typeIdField]);return d&&d.domains&&d.domains[a.name]&&d.domains[a.name].codedValues&&(e=this._findFirst(d.domains[a.name].codedValues,"code",b[a.name])),e?e.name:b[a.name]}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateSubtypeDomainEditorColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,editOn:"dblclick",editor:"text",get:c.hitch(this,function(b){var d,c=this._findFirst(this.layerInfo.types,"id",b[this.layerInfo.typeIdField]);
return c&&c.domains&&c.domains[a.name]&&c.domains[a.name].codedValues&&(d=this._findFirst(c.domains[a.name].codedValues,"code",b[a.name])),d?d.name:b[a.name]}),renderCell:c.hitch(this,function(b,d,g){var f=k.create("div",{innerHTML:d},g),r=!1;return f.innerHTML=d,h(g,"dblclick",c.hitch(this,function(){this._closeEditors();var d,p,m=this._findFirst(this.layerInfo.types,"id",b[this.layerInfo.typeIdField]),k=[];if(m.domains[a.name]){d=m.domains[a.name].codedValues;p=this._findFirst(d,"code",b[a.name]);
n.forEach(d,function(d){k.push(b[a.name]===d.code?{label:d.name,value:d.code,selected:!0}:{label:d.name,value:d.code});d.code===p&&(r=!0)});null!==b[a.name]&&" "!==b[a.name]&&""!==b[a.name]||!a.nullable?null!==b[a.name]&&" "!==b[a.name]&&""!==b[a.name]||a.nullable?a.nullable&&k.push({label:"- empty -",value:"ft_null"}):k.push({label:"- empty -",value:"ft_null",selected:!0,disabled:!0}):k.push({label:"- empty -",value:"ft_null",selected:!0});r||p||null===b[a.name]||k.push({label:b[a.name],value:"N/A",
selected:!0,disabled:!0});f.innerHTML="";var t=new E({options:k,style:{width:"100%"}});t.placeAt(f);this.emit("editor-show",{cell:g,editor:t,grid:this.grid});h(t,"blur",c.hitch(this,function(){var c=this._findFirst(d,"code",b[a.name]);f.innerHTML=c?c.name:b[a.name]}));h(t,"keydown",function(a){13===a.keyCode&&t.focusNode.blur()});h(t,"change",c.hitch(this,function(c){var m={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};"ft_null"===c&&(c=null);b[a.name]=c;c=this._findFirst(d,
"code",c);f.innerHTML=c?c.name:null;t.destroy();this._applyEditsByRow(b,m);this.emit("editor-hide",{cell:g,editor:t,grid:this.grid})}));this._activeEditors.push({id:b[this.idProperty],widget:t})}else{f.innerHTML="";var l=new D({value:b[a.name],required:!a.nullable});l.placeAt(f);l.focus();l.textbox.select();this.emit("editor-show",{cell:g,editor:l,grid:this.grid});h(l,"blur",c.hitch(this,function(){f.innerHTML=b[a.name]}));h(l,"keydown",function(a){13===a.keyCode&&l.isValid()&&l.focusNode.blur()});
h(l,"change",c.hitch(this,function(d){var c={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};l.isValid()?(b[a.name]=d,f.innerHTML=d,l.destroy(),this._applyEditsByRow(b,c)):(f.innerHTML=b[a.name],l.destroy());this.emit("editor-hide",{cell:g,editor:l,grid:this.grid})}));this._activeEditors.push({id:b[this.idProperty],widget:l})}})),d}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})};return b.formatter=a.format&&a.format.embeddedHTML?c.hitch(this,
function(a){return a?a:null}):a.format&&a.format.template?c.hitch(this,function(b){var d;return b&&(d=u.substitute(a.format.template,{value:b})),d||null}):a.format&&!1===a.format.link?c.hitch(this,function(a){return a}):c.hitch(this,function(a){return this._generateLinkFromString(a)}),b},_generateStringColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})};return b.formatter=a.format&&a.format.embeddedHTML?
c.hitch(this,function(a){return a?a:null}):a.format&&a.format.template?c.hitch(this,function(b){var d;return b&&(d=u.substitute(a.format.template,{value:b})),d||null}):a.format&&!1===a.format.link?c.hitch(this,function(a){return a}):c.hitch(this,function(a){return this._generateLinkFromString(a)}),b},_generateStringEditorColumn:function(a){var b=new B({label:a.alias,field:a.name,type:a.type,hidden:a.hidden,editorArgs:{required:!a.nullable},editOn:"dblclick",editor:"text",renderHeaderCell:c.hitch(this,
function(b){return this._getColumnHeaderCell(b,a)})});return b.formatter=a.format&&a.format.embeddedHTML?c.hitch(this,function(a){return a?a:null}):a.format&&a.format.template?c.hitch(this,function(b){var d;return b&&(d=u.substitute(a.format.template,{value:b})),d||null}):a.format&&!1===a.format.link?c.hitch(this,function(a){return a}):c.hitch(this,function(a){return this._generateLinkFromString(a)}),b},_generateNumberColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,
renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})};return a.format&&a.format.template&&(b.formatter=c.hitch(this,function(b){var d;return b&&(d=u.substitute(a.format.template,{value:b})),d||null})),b},_generateNumberEditorColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)}),renderCell:c.hitch(this,function(b,d,g){var f=k.create("div",{innerHTML:d},g),r=null,
l={};"esriFieldTypeInteger"===a.type&&(l.places=0);r=a.format&&a.format.template&&null!==d?u.substitute(a.format.template,{value:d}):d;f.innerHTML=r;h(g,"dblclick",c.hitch(this,function(){this._closeEditors();f.innerHTML="";var d=new D({value:b[a.name],required:!a.nullable,constraints:l});d.placeAt(f);d.focus();d.textbox.select();this.emit("editor-show",{cell:g,editor:d,grid:this.grid});h(d,"blur",c.hitch(this,function(){var d=b[a.name],c=null,c=a.format&&a.format.template&&null!==d?u.substitute(a.format.template,
{value:d}):d;f.innerHTML=c}));h(d,"keydown",function(a){13===a.keyCode&&d.isValid()&&d.focusNode.blur()});h(d,"change",c.hitch(this,function(c){var k={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b},h=null;(""===c||isNaN(c))&&(c=null);d.isValid()?(b[a.name]=c,h=a.format&&a.format.template&&null!==c?u.substitute(a.format.template,{value:c}):c,f.innerHTML=h,d.destroy(),this._applyEditsByRow(b,k)):(h=a.format&&a.format.template&&null!==b[a.name]?u.substitute(a.format.template,
{value:b[a.name]}):b[a.name],f.innerHTML=h,d.destroy(),this.emit("editor-hide",{cell:g,editor:d,grid:this.grid}))}));this._activeEditors.push({id:b[this.idProperty],widget:d})}))})};return a.format&&a.format.template&&(b.formatter=c.hitch(this,function(b){var d;return b&&(d=u.substitute(a.format.template,{value:b})),d||null})),b},_generateDateTimeColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(b){return""===b[a.name]||null===b[a.name]?null:
this._generateDateFromLocale(new Date(b[a.name]),a)}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateDateTimeEditorColumn:function(a){return(a.dateOptions&&void 0!==a.dateOptions.timeEnabled?a.dateOptions.timeEnabled:this.dateOptions.timeEnabled)?{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:c.hitch(this,function(b){return""===b[a.name]||null===b[a.name]?null:this._generateDateFromLocale(new Date(b[a.name]),a)}),renderCell:c.hitch(this,function(b,
e,d){var g,f;e&&k.create("div",{innerHTML:e},d);h(d,"dblclick",c.hitch(this,function(){var h,l;this._closeEditors();g=new K({value:new Date(b[a.name]),constraints:{datePattern:a.dateOptions&&a.dateOptions.datePattern?a.dateOptions.datePattern:this.dateOptions.datePattern}});g.on("change",c.hitch(this,function(e){var d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b},c=f.value;if(!g.isValid())return void g.setValue(null);if(null===e||""===e)return f.setValue(null),b[a.name]=
null,void this._applyEditsByRow(b,d);null===c&&(c=new Date(0,0),f.setValue(c));e=this._getCombinedDateTime(e,c).getTime();b[a.name]=e;this._applyEditsByRow(b,d)}));f=new ka({value:new Date(b[a.name]),constraints:{timePattern:a.dateOptions&&a.dateOptions.timePattern?a.dateOptions.timePattern:this.dateOptions.timePattern}});f.on("change",c.hitch(this,function(e){var d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b},c=g.value;if(!f.isValid())return void f.setValue(null);if(null===
e||""===e)return g.setValue(null),void(b[a.name]=null);null===c&&(c=new Date(0,0),g.setValue(c));e=this._getCombinedDateTime(c,e).getTime();b[a.name]=e;this._applyEditsByRow(b,d)}));d.innerHTML="";h=k.create("div",{style:{"float":"left",display:"inline",width:"90%"}},d);l=k.create("div",{style:{"float":"right",display:"inline",width:"10%","margin-top":"5px"}},d);g.placeAt(h);f.placeAt(h);(new L({iconClass:"dijitIconSave",showLabel:!1,onClick:c.hitch(this,function(){var c,h={fieldName:a.name,oldValue:b[a.name],
rowId:b[this.idProperty],rowObject:b},k=g.value,l=f.value;f.isValid()&&g.isValid()?(k&&l?(c=this._getCombinedDateTime(k,l).getTime(),d.innerHTML=this._generateDateFromLocale(new Date(c),a)):(c=null,d.innerHTML=""),b[a.name]=c,this._applyEditsByRow(b,h)):d.innerHTML=e})},k.create("div",null,l))).startup();g.focus();g.textbox.select()}))}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}:new B({label:a.alias,field:a.name,type:a.type,editorArgs:{required:!a.nullable,
constraints:{datePattern:a.dateOptions&&a.dateOptions.datePattern?a.dateOptions.datePattern:this.dateOptions.datePattern}},editOn:"dblclick",hidden:a.hidden,formatter:c.hitch(this,function(b){return b?this._generateDateFromLocale(b,a):null}),get:c.hitch(this,function(b){return""===b[a.name]||null===b[a.name]?null:new Date(b[a.name])}),renderHeaderCell:c.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})},K)},_closeEditors:function(){n.forEach(this._activeEditors,function(a){a.widget.onBlur()});
this.set("_activeEditors",[])},_getColumnHeaderCell:function(a,b){var e=k.create("div",{className:this.css.featureTableColumnHeader});return k.create("div",{innerHTML:b.alias,className:this.css.featureTableColumnHeaderTitle},e),!b.editable&&this.editable&&this.layerInfo.editable&&k.create("span",{className:this.css.headerGear+" "+this.css.lockedIcon},e),k.create("div",{style:{clear:"both"}},e),this.showDataTypes&&k.create("div",{innerHTML:b.type,className:this.css.featureTableColumnHeaderType},e),
e},_selectFeaturesFromIds:function(a){if(a||0!==this.selectedRowIds.length){var b=new v;return b.returnGeometry=!!this.map,b.objectIds=a||this.selectedRowIds,b.where="1\x3d1",this.featureLayer.selectFeatures(b,na.SELECTION_NEW)}},_updateGridSelection:function(){var a,b,e=this.grid.selection,d=new z,c=[],f=[];for(a in e)e.hasOwnProperty(a)&&(b=parseInt(a,10),f.push(b),c.push(this.grid.row(b).data));return this.set({selectedRows:c,selectedRowIds:f,_featureSelectedCount:f.length}),d.resolve(),d},_showExpandoCallback:function(a,
b,e,d,c){b=b.element;var f=q.contains(b,"collapsed"),h=Y(".expando",b)[0],k=this._expandedNodes[0]?a===this._expandedNodes[0].grid:!1;c=this._expandedNodes[0]?q.contains(this._expandedNodes[0].textSpan,c):!1;return this._expandedNodes[0]&&this._expandedNodes[0].rowNode===b&&c?(d.innerHTML=this._i18nStrings.hide,this._expandedNodes[0].textSpan.innerHTML=this._i18nStrings.show,this._expandedNodes=[{grid:a,rowNode:b,textDiv:e,textSpan:d}]):!k&&this._expandedNodes[0]?q.toggle(b,"collapsed",!f):(n.forEach(this._expandedNodes,
function(a){q.add(a.rowNode,"collapsed");a.textSpan.innerHTML=this._i18nStrings.show},this),q.toggle(b,"collapsed",!f),this._expandedNodes=f?[{grid:a,rowNode:b,textDiv:e,textSpan:d}]:[],d.innerHTML=f?this._i18nStrings.hide:this._i18nStrings.show),h},_applyEdits:function(a,b){if(a=a||[],!(0>=a.length)){var e=[];n.forEach(a,function(a){a.layer&&e.push(a.layer.applyEdits(a.adds,a.updates,a.deletes))});0<e.length?X(e).then(c.hitch(this,function(){b&&b()})):this._toggleLoadingIndicator(!1)}},_applyEditsByRow:function(a,
b){b&&this._rollbackInfos.push({id:b.rowId,data:b});this.getFeatureDataById(a[this.idProperty]).then(c.hitch(this,function(b){this._toggleLoadingIndicator(!0);b=b.features[0];b.attributes=a;this._applyEdits([{layer:this.featureLayer,updates:[b]}],null)}))},_applyEditsListener:function(){return h(this.featureLayer,"edits-complete",c.hitch(this,function(a){this.emit("edits-complete",a);var b,e,d,c;a=a.updates||[];var f=this._rollbackInfos;a&&a.length&&n.forEach(a,function(a){b=this._findFirst(f,"id",
a.objectId);e=b.data;a.success||(a.error?this.emit("error",a.error):this.emit("error","Update failed."),e?(d=this.grid.row(e.rowId),c=d.data,c[this.idProperty]===a.objectId?(c[e.fieldName]=e.oldValue,this.grid.updateDirty(e.rowId,e.fieldName,e.oldValue),this.grid.refresh()):this.emit("error","Couldn't rollback value.")):this.emit("error","Couldn't rollback value."));this._rollbackInfos.splice(n.indexOf(this._rollbackInfos,b),1);this._toggleLoadingIndicator(!1)},this);this.layerInfo.isFeatureCollection&&
this._createStoreFromDataQuery();this._toggleLoadingIndicator(!1)}))},_layerClickCallback:function(){return h(this.featureLayer,"click",c.hitch(this,function(a){if(this.syncSelection&&a.graphic&&a.graphic.attributes&&a.graphic.attributes[this.idProperty]){this.grid.clearSelection();this.featureLayer.clearSelection();var b=a.graphic.attributes[this.idProperty];this._selectFeaturesFromIds([b]).then(c.hitch(this,function(a){if(a.length){if(this.map&&this.zoomToSelection){var d=this._calcGraphicsExtent(a);
d?(d=d.getCenter(),this.map.centerAt(d).then(function(){n.forEach(a,function(a){a.getDojoShape()&&a.getDojoShape().moveToFront()})})):this.emit("error","Could not generate valid extent.")}var d=this.dataStore.get(b),g=this.dataStore.data.indexOf(d);"undefined"!=typeof d&&-1!==g||this.emit("error","Could not load the row. Selection failed.");this.grid.select(b);this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText();h.once(this.grid,"scroll",c.hitch(this,function(){this.grid.row(b).element&&
this.grid.row(b).element.scrollIntoView()}));this.grid.scrollTo({x:0,y:this.grid.rowHeight*g})}))}}),function(){this.emit("error","Could not select features.")})}}))},_gridRefreshListener:function(){return h(this.grid,"dgrid-refresh-complete",c.hitch(this,function(a){this.grid.columns[0]&&this.emit("refresh",a)}))},_gridDataChangeListener:function(){return h(this.grid,"dgrid-datachange",c.hitch(this,function(a){var b=a.cell.column.field,e=a.value,d=parseInt(a.rowId,10),g=this.grid.row(d).data,f=this._findFirst(this.layerInfo.fieldInfos,
"name",b),h={oldValue:a.oldValue,fieldName:b,rowId:d,rowObject:g};this.emit("data-change",a);""===e&&(e=null);"esriFieldTypeInteger"!==f.type&&"esriFieldTypeSmallInteger"!==f.type||null===e||(e=parseInt(e,10));"esriFieldTypeDouble"!==f.type&&"esriFieldTypeSingle"!==f.type||null===e||(e=parseFloat(e));g[b]=e&&e.getTime&&e.getTime()?e.getTime():e;this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText();this._applyEditsByRow(g,h)}))}))},_gridSelectListener:function(){return h(this.grid,
"dgrid-select",c.hitch(this,function(a){this._activeEditors[0]&&this._activeEditors[0].id&&a.rows[0]&&Number(a.rows[0].id)!==Number(this._activeEditors[0].id)&&this._closeEditors();this.emit("row-select",a.rows);this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText();this.map&&this.syncSelection&&this._selectFeaturesFromIds().then(c.hitch(this,function(a){if(this.zoomToSelection){var e=this._calcGraphicsExtent(a);e?(e=e.getCenter(),this.map.centerAt(e).then(function(){n.forEach(a,
function(a){a.getDojoShape()&&a.getDojoShape().moveToFront()})})):this.emit("error","Could not generate valid extent.")}}),function(){this.emit("error","Could not select features")})}))}))},_gridDeselectListener:function(){return h(this.grid,"dgrid-deselect",c.hitch(this,function(a){this.emit("row-deselect",a.rows);this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText();this._selectFeaturesFromIds()}))}))},_gridColumnStateChangeListener:function(){return h(this.grid,
"dgrid-columnstatechange",c.hitch(this,function(a){this.emit("column-state-change",a)}))},_gridColumnResizeListener:function(){return h(this.grid,"dgrid-columnresize",c.hitch(this,function(a){this.emit("column-resize",a)}))},_gridErrorListener:function(){return h(this.grid,"dgrid-error",c.hitch(this,function(a){this.emit("error",a)}))},_gridSortListener:function(){return h(this.grid,"dgrid-sort",c.hitch(this,function(a){this.emit("sort",a)}))},_gridFilterListener:function(){return h(this.grid,"dgrid-filter",
c.hitch(this,function(a){this.emit("filter",a)}))},_gridEditorShowListener:function(){return h(this.grid,"dgrid-editor-show",c.hitch(this,function(a){this.emit("editor-show",a)}))},_gridEditorHideListener:function(){return h(this.grid,"dgrid-editor-hide",c.hitch(this,function(a){this.emit("editor-hide",a)}))},_columnClickCallback:function(){return this.grid.on(".dgrid-header .dgrid-cell:click",c.hitch(this,this._showColumnMenu))},_tableToggleClickCallback:function(){return h(this.tableCloseButton,
"click",c.hitch(this,function(){this._toggleOpened?(q.remove(this.tableCloseButton,"toggleOpened"),q.add(this.tableCloseButton,"toggleClosed"),this._toggler.hide(),this._gridContentPane.domNode.style.display="none",this._resize()):(q.remove(this.tableCloseButton,"toggleClosed"),q.add(this.tableCloseButton,"toggleOpened"),this._toggler.show(),this._gridContentPane.domNode.style.display="block",this._resize());this._toggleOpened=!this._toggleOpened}))},_resize:function(){this._gridBorderContainer.resize();
this._gridHeaderNode.resize();this._gridContentPane.resize();this.grid&&this.grid.resize()},_updateGridHeaderText:function(){this._gridTitleNode.innerHTML=u.substitute(this._i18nStrings.gridHeader,{gridTitle:this.featureLayer.name||this._i18nStrings.untitled,featureCount:this.featureCount,featureSelectedCount:this._featureSelectedCount})},_createTableToggle:function(){var a=new da({node:this.gridContentPaneId});return this._toggleOpened=!0,a},_toggleLoadingIndicator:function(a){this._gridLoadingIndicatorNode.style.display=
a?"block":"none"},_showLoadError:function(){this._toggleLoadingIndicator(!1);this._gridTitleNode.innerHTML=this._i18nStrings.dataError},_showInfoWindow:function(){},_hideInfoWindow:function(){},_showColumnMenu:function(a){var b=this.grid.cell(a),e=b.column;if(e){var d,g,f;d=this.get("columnMenu");var k=e.id,l=this.columns[k],e=this.layerInfo.fieldInfos[k],p=e.type;d&&this.set({_oldColumnMenu:d,columnMenu:null});var m=new J({});if(!1!==l.sortable){if(this.featureCount>this.featureLayer.maxRecordCount&&
!this.featureLayer.advancedQueryCapabilities.supportsPagination)return;d=[this._i18nStrings.sortAsc,this._i18nStrings.sortDesc];g=["iconSortAscending","iconSortDescending"];f=[this._sortAscending,this._sortDescending];n.forEach(d,function(a,b){var e=new C({label:a,iconClass:g[b],baseClass:this.css.menuItem,onClick:c.hitch(this,f[b],k)});m.addChild(e)},this)}!this.featureLayer.supportsStatistics||!e||e.domain||"esriFieldTypeDouble"!==p&&"esriFieldTypeSingle"!==p&&"esriFieldTypeInteger"!==p&&"esriFieldTypeSmallInteger"!==
p||(d=new C({label:this._i18nStrings.statistics,iconClass:"iconTableStatistics",baseClass:this.css.menuItem,onClick:c.hitch(this,this._getColumnStats,k)}),m.addChild(d));m.startup();m._openMyself({target:a.target,delegatedTarget:b,iframe:null,coords:{x:a.pageX,y:a.pageY}});h(m,"close",c.hitch(this,function(){this._oldColumnMenu&&(this._oldColumnMenu.destroyRecursive(),this._oldColumnMenu=null)}));this.set("columnMenu",m)}},_sortAscending:function(a){this.dataStore instanceof y&&(this.set("_orderByFields",
[this.columns[a].field+" ASC"]),this._createStoreFromDataQuery());this.grid.set("sort",[{attribute:this.columns[a].field,descending:!1}]);this.emit("sort",{field:this.columns[a].field,descending:!1})},_sortDescending:function(a){this.dataStore instanceof y&&(this.set("_orderByFields",[this.columns[a].field+" DESC"]),this._createStoreFromDataQuery());this.grid.set("sort",[{attribute:this.columns[a].field,descending:!0}]);this.emit("sort",{field:this.columns[a].field,descending:!0})},_getColumnStats:function(a){var b,
e=this.columns[a].field;a=[];var d="countField sumField minField maxField avgField stddevField".split(" ");b=new v;b.outFields=[e];b.outStatistics=[];b.where="1\x3d1";n.forEach("count sum min max avg stddev".split(" "),function(a,c){var h=new oa;h.statisticType=a;h.onStatisticField=e;h.outStatisticFieldName=d[c];h.displayFieldName=e;b.outStatistics.push(h)},this);0<this._filteredRowIds.length&&(a=this._filteredRowIds);b.where&&0<a.length&&(b.where="("+b.where+") AND ("+this.idProperty+" IN ("+a.toString()+
"))");(new pa(this.featureLayer.url)).execute(b).then(c.hitch(this,function(a){a.features&&a.features.length&&this._showStatisticsDialog(a,e)}),function(){this.emit("error","Could not get statistics.")})},_showStatisticsDialog:function(a,b){var e,d,c,f,h,l,n,m,u,t=a.features[0].attributes;m={};c={pattern:"#,###,###,##0.########"};var q="Number of Values;Sum of Values;Minimum;Maximum;Average;Standard Deviation".split(";");this.statisticsDialog&&this.statisticsDialog.destroy();e=k.create("div",{className:"esriAGOTableStatistics",
innerHTML:""});k.create("div",{className:"header",innerHTML:"Field: "+b},e);k.create("div",{className:"hzLine",innerHTML:""},e);d=k.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},e);for(f in t)t.hasOwnProperty(f)&&(m[f.toLowerCase()]=t[f]);h=x.isDefined(m.countfield)?w.format(m.countfield,c):"";u=x.isDefined(m.sumfield)?w.format(m.sumfield,c):"";n=x.isDefined(m.minfield)?w.format(m.minfield,c):"";l=x.isDefined(m.maxfield)?w.format(m.maxfield,c):"";f=x.isDefined(m.avgfield)?
w.format(w.round(m.avgfield,this._roundPos(m.avgfield)),c):"";m=x.isDefined(m.stddevfield)?w.format(w.round(m.stddevfield,this._roundPos(m.stddevfield)),c):"";d=k.create("tbody",{},d);c=k.create("tr",{valign:"top"},d);k.create("td",{"class":"attrName",innerHTML:q[0]},c);k.create("td",{"class":"attrValue",innerHTML:h},c);c=k.create("tr",{valign:"top"},d);k.create("td",{"class":"attrName",innerHTML:q[1]},c);k.create("td",{"class":"attrValue",innerHTML:u},c);c=k.create("tr",{valign:"top"},d);k.create("td",
{"class":"attrName",innerHTML:q[2]},c);k.create("td",{"class":"attrValue",innerHTML:n},c);c=k.create("tr",{valign:"top"},d);k.create("td",{"class":"attrName",innerHTML:q[3]},c);k.create("td",{"class":"attrValue",innerHTML:l},c);c=k.create("tr",{valign:"top"},d);k.create("td",{"class":"attrName",innerHTML:q[4]},c);k.create("td",{"class":"attrValue",innerHTML:f},c);c=k.create("tr",{valign:"top"},d);k.create("td",{"class":"attrName",innerHTML:q[5]},c);k.create("td",{"class":"attrValue",innerHTML:m},
c);k.create("div",{className:"break",innerHTML:""},e);this.statisticsDialog=new ia({title:this._i18nStrings.statistics,content:e,baseClass:this.css.dialog});e=k.create("button",{type:"button"},this.statisticsDialog.containerNode);var v=this;this._closeButton=new L({label:this._i18nStrings.close,baseClass:"primary dijitButton",onClick:function(){var a=v.statisticsDialog;a.hide().then(function(){a.destroyRecursive()})}},e);this.statisticsDialog.show();this.emit("show-statistics",{dialog:this.statisticsDialog,
statistics:t})},_createTableMenu:function(){this.gridMenu=new J({});var a=[this._i18nStrings.defaultSort,this._i18nStrings.showSelected,this._i18nStrings.clearSelection,this._i18nStrings.toggleColumns],b=[this._defaultSortOrder,this._showSelectedRecords,this._clearSelection,this._showHideColumns];this.map&&this.syncSelection&&(a.push("Center on Selection"),b.push(this._centerOnSelection));0<this.menuFunctions.length&&n.forEach(this.menuFunctions,function(c){a.push(c.label);b.push(c.callback)},this);
n.forEach(a,function(a,d){var g=new C({label:a,baseClass:this.css.menuItem,onClick:c.hitch(this,b[d])});this.gridMenu.addChild(g)},this);this.gridMenuAnchor=new ja({label:l.widgets.geocodeMatch.match.tableOptionsLabel,dropDown:this.gridMenu},this.gridMenuNodeId);this.gridMenu.startup()},_defaultSortOrder:function(){this.dataStore instanceof y&&(this.set("_orderByFields",null),this._createStoreFromDataQuery());this.grid.set("sort",[{attribute:this.idProperty,descending:!1}]);this.emit("sort",{field:this.idProperty,
descending:!1})},_filterRows:function(){},_showSelectedRecords:function(){var a=this.selectedRowIds;this.set("_filteredRowIds",a);a&&0<a.length&&(this.dataStore instanceof y?this.emit("error","Unable to show current selection."):(this.grid.set("query",c.hitch(this,function(b){return-1!==a.indexOf(b[this.idProperty])?!0:!1})),this._gridQuery=!0),this.emit("filter",a))},_centerOnSelection:function(){var a=this.selectedRowIds,b=new v;b.objectIds=a;b.outFields=["*"];0<this.selectedRows.length&&0<this.selectedRowIds.length&&
this.featureLayer.queryFeatures(b,c.hitch(this,function(a){this.map.setExtent(this._calcGraphicsExtent(a.features))}))},_clearSelection:function(){this.set("_filteredRowIds",[]);this._gridQuery&&(this.grid.set("query",{}),this.set("_gridQuery",!1));this.grid.clearSelection();this._updateGridSelection().then(c.hitch(this,function(){this._updateGridHeaderText();this.featureLayer.clearSelection()}));this.emit("filter",{})},_showHideColumns:function(){this.grid._toggleColumnHiderMenu()},_exportToCSV:function(){},
_roundPos:function(a){return 1E3<=a?0:10<=a?2:0<=a?4:6},_generateLinkFromString:function(a){if(a&&"string"==typeof a){var b=a.indexOf("http:");if(-1===b&&(b=a.indexOf("https:")),-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var d=a.substring(b,c);a=a.substring(0,b)+"\x3ca href\x3d'"+d+"' target\x3d'_blank'\x3e"+d+"\x3c/a\x3e"+a.substring(c,a.length)}}return a||null},_calcGraphicsExtent:function(a){var b=a[0].geometry;if(null===b&&1===a.length)return null;for(var c=
a.length-1;0<=c;c--)null===a[c].geometry&&a.splice(c,1);var d,g,b=a[0].geometry,c=b.getExtent(),f=a.length;null===c&&(c=new T(b.x,b.y,b.x,b.y,b.spatialReference));for(g=1;f>g;g+=1)b=a[g].geometry,d=b.getExtent(),null===d&&(d=new T(b.x,b.y,b.x,b.y,b.spatialReference)),c=c.union(d);return c},_generateDateFromLocale:function(a,b){var c=!1,d=!1,g={},f=b&&b.dateOptions?b.dateOptions:!1;return f?("undefined"!=typeof f.datePattern&&!1!==f.datePattern?(g.datePattern=f.datePattern||this.dateOptions.datePattern,
c=!0):this.dateOptions&&null!==this.dateOptions.datePattern&&(g.datePattern=this.dateOptions.datePattern,c=!1===f.datePattern?!1:!0),f.timeEnabled||this.dateOptions.timeEnabled?(g.timePattern=f.timePattern||this.dateOptions.timePattern,d="undefined"!=typeof f.timeEnabled?f.timeEnabled:this.dateOptions.timeEnabled):this.dateOptions&&"undefined"!=typeof this.dateOptions.timeEnabled&&null!==this.dateOptions.timePattern&&(g.timePattern=this.dateOptions.timePattern,d=this.dateOptions.timeEnabled)):(this.dateOptions&&
null!==this.dateOptions.datePattern&&(g.datePattern=this.dateOptions.datePattern,c=!0),this.dateOptions&&"undefined"!=typeof this.dateOptions.timeEnabled&&null!==this.dateOptions.timePattern&&(g.timePattern=this.dateOptions.timePattern,d=this.dateOptions.timeEnabled)),c&&d?g.selector="date and time":c&&!d?g.selector="date":!c&&d?g.selector="time":g.selecter="date",W.format(new Date(a),g)},_getCombinedDateTime:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.getHours(),b.getMinutes(),
b.getSeconds())},_findFirst:function(a,b,c){return(a=n.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===c}))&&a.length?a[0]:null}});return V("extend-esri")&&c.setObject("dijit.FeatureTable",A,ma),A});