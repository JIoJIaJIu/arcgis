//>>built
define("esri/dijit/Scalebar","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/query ../kernel ../lang ../domUtils ../units ../SpatialReference ../WKIDUnitConversion ../geometry/Point ../geometry/ScreenPoint ../geometry/Polyline ../geometry/geodesicUtils ../geometry/webMercatorUtils ../geometry/screenUtils ../geometry/normalizeUtils dojo/i18n!../nls/jsapi".split(" "),function(n,l,m,h,p,q,F,u,G,k,
H,v,w,x,y,r,z,A,B,C,t,D,E,I){n=n(null,{declaredClass:"esri.dijit.Scalebar",map:null,mapUnit:null,scalebarUnit:null,unitsDictionary:[],domNode:null,screenPt1:null,screenPt2:null,localStrings:I.widgets.scalebar,constructor:function(a,c){if(this.metricScalebar=q.create("div",{innerHTML:"\x3cdiv class\x3d'esriScaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLine esriScalebarMetricLine'\x3e\x3c/div\x3e"}),
this.englishScalebar=q.create("div",{innerHTML:"\x3cdiv class\x3d'esriScalebarLine esriScalebarEnglishLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e"}),this.domNode=q.create("div"),a=a||{},!a.map)return void console.error("scalebar: unable to find the 'map' property in parameters");if(a.scalebarUnit){if("english"!==a.scalebarUnit&&"metric"!==a.scalebarUnit&&"dual"!==a.scalebarUnit)return void console.error("scalebar unit only accepts english or metric or dual");
this.scalebarUnit=a.scalebarUnit}else this.scalebarUnit="english";if(a.scalebarStyle){if("ruler"!==a.scalebarStyle&&"line"!==a.scalebarStyle)return void console.error("scalebar style must be ruler or line");this.scalebarStyle=a.scalebarStyle}else this.scalebarStyle="ruler";switch(this.background=a.background,this.scalebarUnit){case "english":"ruler"===this.scalebarStyle&&(this.englishScalebar.innerHTML="\x3cdiv class\x3d'esriScalebarRuler'\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_secondpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_secondpiece'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'scaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel' style\x3d'left: -3%'\x3e0\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarFirstNumber'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e");
this.domNode.appendChild(this.englishScalebar);break;case "metric":"ruler"===this.scalebarStyle&&(this.metricScalebar.innerHTML="\x3cdiv class\x3d'esriScalebarRuler'\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_secondpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_secondpiece'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'scaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel' style\x3d'left: -3%'\x3e0\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarFirstNumber'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e");
this.domNode.appendChild(this.metricScalebar);break;case "dual":this.domNode.appendChild(this.metricScalebar),this.domNode.appendChild(this.englishScalebar)}if(this.map=a.map,c?c.appendChild(this.domNode):(this.map.container.appendChild(this.domNode),a.attachTo?p.add(this.domNode,"scalebar_"+a.attachTo):p.add(this.domNode,"scalebar_bottom-left")),p.add(this.domNode,"esriScalebar"),this.map.loaded)this._getDistance(this.map.extent),this._checkBingMaps();else var b=h.connect(this.map,"onLoad",this,
function(){h.disconnect(b);b=null;this._getDistance(this.map.extent);this._checkBingMaps()});this._mapOnPan=h.connect(this.map,"onPan",this,this._getDistance);this._mapOnExtentChange=h.connect(this.map,"onExtentChange",this,this._getDistance);m.forEach(this.map.layerIds,function(a){"esri.virtualearth.VETiledLayer"===this.map.getLayer(a).declaredClass&&h.connect(this.map.getLayer(a),"onVisibilityChange",l.hitch(this,function(){this._checkBingMaps()}))},this);this._mapOnLayerAdd=h.connect(this.map,
"onLayerAdd",l.hitch(this,function(a){"esri.virtualearth.VETiledLayer"===a.declaredClass&&h.connect(a,"onVisibilityChange",l.hitch(this,function(){this._checkBingMaps()}));this._checkBingMaps()}));this._mapOnLayerRemove=h.connect(this.map,"onLayerRemove",l.hitch(this,this._checkBingMaps))},hide:function(){this._hidden=!0;w.hide(this.domNode)},show:function(){this._hidden=!1;w.show(this.domNode)},destroy:function(){h.disconnect(this._mapOnPan);h.disconnect(this._mapOnExtentChange);h.disconnect(this._mapOnLayerAdd);
h.disconnect(this._mapOnLayerRemove);this.hide();this.map=null;q.destroy(this.domNode)},_checkBingMaps:function(){p.contains(this.domNode,"scalebar_bottom-left")&&(u.set(this.domNode,"left","25px"),m.forEach(this.map.layerIds,function(a){"esri.virtualearth.VETiledLayer"===this.map.getLayer(a).declaredClass&&this.map.getLayer(a).visible&&(a="95px",this.map._mapParams.nav&&(a="115px"),u.set(this.domNode,"left",a))},this))},_getDistance:function(a){var c=F.position(this.domNode,!0).y-this.map.position.y,
c=c>this.map.height?this.map.height:c,c=0>c?0:c,b,e,f=new A(0,c),c=new A(this.map.width,c);this.mapUnit="esriDecimalDegrees";var d=D.toMapPoint(a,this.map.width,this.map.height,f),g=D.toMapPoint(a,this.map.width,this.map.height,c),f=new z(a.xmin,(a.ymin+a.ymax)/2,this.map.spatialReference),c=new z(a.xmax,(a.ymin+a.ymax)/2,this.map.spatialReference);if(3857===this.map.spatialReference.wkid||102100===this.map.spatialReference.wkid||102113===this.map.spatialReference.wkid||this.map.spatialReference.wkt&&
-1!=this.map.spatialReference.wkt.indexOf("WGS_1984_Web_Mercator"))d=t.webMercatorToGeographic(d,!0),g=t.webMercatorToGeographic(g,!0),f=t.webMercatorToGeographic(f,!0),c=t.webMercatorToGeographic(c,!0);else if(v.isDefined(r[this.map.spatialReference.wkid])||this.map.spatialReference.wkt&&0===this.map.spatialReference.wkt.indexOf("PROJCS")){this.mapUnit="linearUnit";a=Math.abs(a.xmax-a.xmin);if(v.isDefined(r[this.map.spatialReference.wkid]))e=r.values[r[this.map.spatialReference.wkid]];else{e=this.map.spatialReference.wkt;
b=e.lastIndexOf(",")+1;var h=e.lastIndexOf("]]");e=parseFloat(e.substring(b,h))}a*=e;e=a/1609;b=a/1E3}"esriDecimalDegrees"===this.mapUnit&&(a=new B(new y({wkid:4326})),a.addPath([d,g]),d=E._straightLineDensify(a,10),a=C.geodesicLengths([d],x.KILOMETERS)[0],d=new B(new y({wkid:4326})),d.addPath([f,c]),f=E._straightLineDensify(d,10),C.geodesicLengths([f],x.KILOMETERS),e=a/1.609,b=a);"english"===this.scalebarUnit?this._getScaleBarLength(e,"mi"):"metric"===this.scalebarUnit?this._getScaleBarLength(b,
"km"):"dual"===this.scalebarUnit&&(this._getScaleBarLength(e,"mi"),this._getScaleBarLength(b,"km"))},_getScaleBarLength:function(a,c){var b=50*a/this.map.width,e=0,f=c;for(.1>b&&("mi"===c?(b*=5280,f="ft"):"km"===c&&(b*=1E3,f="m"));1<=b;)b/=10,e++;var d,g;.5<b?(d=1,g=.5):.3<b?(d=.5,g=.3):.2<b?(d=.3,g=.2):.15<b?(d=.2,g=.15):.1<=b&&(d=.15,g=.1);d=d/b>=b/g?g:d;b=d/b*50;e=Math.pow(10,e)*d;this._drawScaleBar(b,e,f)},_drawScaleBar:function(a,c,b){var e,f,d,g=2*Math.round(a);"mi"===b||"ft"===b?(this.englishScalebar.style.width=
g+"px",e=k(".esriScalebarFirstNumber",this.englishScalebar),f=k(".esriScalebarSecondNumber",this.englishScalebar),d=k(".esriScalebarMetricLineBackground",this.englishScalebar)):(this.metricScalebar.style.width=g+"px",e=k(".esriScalebarFirstNumber",this.metricScalebar),f=k(".esriScalebarSecondNumber",this.metricScalebar),d=k(".esriScalebarMetricLineBackground",this.metricScalebar));m.forEach(d,function(a){a.style.width=g-2+"px"},this);m.forEach(e,function(a){a.innerHTML=c},this);m.forEach(f,function(a){a.innerHTML=
"esriUnknown"!==this.mapUnit?2*c+this.localStrings[b]:2*c+"Unknown Unit"},this)}});return G("extend-esri")&&l.setObject("dijit.Scalebar",n,H),n});