//>>built
define("esri/request","require dojo/_base/array dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/_base/url dojo/_base/xhr dojo/io/script dojo/io/iframe dojo/dom-construct dojo/io-query ./kernel ./config ./sniff ./lang ./urlUtils ./deferredUtils".split(" "),function(Q,D,N,S,r,Y,u,Z,aa,T,U,h,ba,q,z,p,ca){function v(a){return a=new Y(a),(a.host+(a.port?":"+a.port:"")).toLowerCase()}function A(a,d,e,f){var k,n=!1,t=!1;z.isDefined(d)&&(r.isObject(d)?(n=!!d.useProxy,t=!!d.usePost,k=d.crossOrigin):
n=!!d);a=r.mixin({},a);a._ssl&&(a.url=a.url.replace(/^http:/i,"https:"));d=a.content;var l=a.url,g=e&&a.form,w=m;k=z.isDefined(k)?k:w.useCors;a.load=function(a){var b;return a&&(a.error?(b=r.mixin(Error(),a.error),b.log=N.isDebug):"error"===a.status&&(b=r.mixin(Error(),a),b.log=N.isDebug),b&&!z.isDefined(b.httpCode)&&(b.httpCode=b.code)),b||a};a.error=function(a,b){return b&&b.xhr&&b.xhr.abort(),a instanceof Error||(a=r.mixin(Error(),a)),a.log=N.isDebug,w.errorHandler(a,b),a};a._token&&(a.content=
a.content||{},a.content.token=a._token);var E,B=0;d&&l&&(E=U.objectToQuery(d),B=E.length+l.length+1,q("esri-url-encodes-apostrophe")&&(B=E.replace(/'/g,"%27").length+l.length+1));a.timeout=z.isDefined(a.timeout)?a.timeout:w.timeout;a.handleAs=a.handleAs||"json";try{var x,y,b=k&&p.canUseXhr(a.url)&&!/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i.test(a.url),c=p.hasSameOrigin(a.url,window.location.href)||b,F=t||e||B>w.postLength?!0:!1,V=c||-1===a.handleAs.indexOf("json")||!a.callbackParamName||e?!1:
!0,G=p.getProxyRule(a.url)||w.alwaysUseProxy||n||(!V||F)&&!c?!0:!1;if(e&&!q("esri-file-upload")&&!G&&b&&(G=!0),G)if(x=p.getProxyUrl(l,k),y=x.path,x._xo&&(b=!0),!F&&y.length+1+B>w.postLength&&(F=!0),a.url=y+"?"+l,F)a.content=r.mixin(x.query||{},d);else{var W=U.objectToQuery(r.mixin(x.query||{},d));W&&(a.url+="?"+W);a.content=null}if(V&&!F)return!z.isDefined(a.isAsync)&&4>q("ff")&&(a.isAsync=!0),Z.get(C?C(a):a);var I=a.headers;if(!b||I&&I.hasOwnProperty("X-Requested-With")||(I=a.headers=I||{},I["X-Requested-With"]=
null),e){var J,v,K,O,A,P=a.callbackParamName||"callback.html",H=a.callbackElementName||"textarea",L=g.elements?g.elements.length:0;if(d=a.content)for(J in d)if(K=d[J],z.isDefined(K)){v=null;for(O=0;L>O;O++)if(A=g.elements[O],A.name===J){v=A;break}v?v.value=K:f?g.append(J,K):g.appendChild(T.create("input",{type:"hidden",name:J,value:K}))}q("esri-file-upload")?(D.forEach(g.elements,function(a){a.name===P&&g.removeChild(a)}),a.contentType=!1,a.postData=f?g:new FormData(g),delete a.form):(g.enctype="multipart/form-data",
9>q("ie")&&(g.encoding="multipart/form-data"),g.method="post",D.some(g.elements,function(a){return a.name===P})||g.appendChild(T.create("input",{type:"hidden",name:P,value:H})),(-1!==l.toLowerCase().indexOf("addattachment")||-1!==l.toLowerCase().indexOf("updateattachment"))&&(a.url=l+(-1===l.indexOf("?")?"?":"\x26")+P+"\x3d"+H,G&&(a.url=y+"?"+a.url)),delete a.content)}if(b&&!a.hasOwnProperty("withCredentials")&&"with-credentials"===m.useCors){f=G?y:l;var M=p.canUseXhr(f,!0),R=-1<M?m.corsEnabledServers[M]:
null;if(R&&R.hasOwnProperty("withCredentials"))R.withCredentials&&(a.withCredentials=!0);else if(h.id){var X=h.id.findServerInfo(f);X&&X.webTierAuth&&(a.withCredentials=!0)}}return a=C?C(a):a,F?e&&!q("esri-file-upload")?aa.send(a):(!G&&q("safari")&&(a.url+=(-1===a.url.indexOf("?")?"?":"\x26")+"_ts\x3d"+(new Date).getTime()+da++),u.post(a)):u.get(a)}catch(Q){return e=new S,e.errback(a.error(Q)),e}}function H(a){var d=m.corsStatus,e=p.canUseXhr(a,!0);return-1<e&&m.corsEnabledServers.splice(e,1),d[v(a)]=
1,e}function L(a){var d=m.corsStatus;if(m.corsDetection&&m.useCors)try{var e=v(a);!q("esri-cors")||!a||-1===a.toLowerCase().indexOf("/rest/services")||p.hasSameOrigin(a,window.location.href)||p.canUseXhr(a)||d[e]||(d[e]=-1,u.get({url:a.substring(0,a.toLowerCase().indexOf("/rest/")+6)+"info",content:{f:"json"},failOk:!0,handleAs:"json",headers:{"X-Requested-With":null}}).then(function(f){f?(d[e]=2,p.canUseXhr(a)||m.corsEnabledServers.push(e)):d[e]=1},function(){d[e]=1}))}catch(f){console.log("esri._detectCors: an unknown error occurred while detecting CORS support")}}
function M(a){C=a}function n(a,d){function e(b){if(b._pendingDfd=A(a,d,E,w),!b._pendingDfd){b.ioArgs=b._pendingDfd&&b._pendingDfd.ioArgs;var c=Error("Deferred object is missing");return c.log=N.isDebug,a._usrDfd=null,b.errback(c),b._pendingDfd=null,b}b._pendingDfd.addCallback(function(d){b.ioArgs=b._pendingDfd&&b._pendingDfd.ioArgs;a._usrDfd=null;b.callback(d);b._pendingDfd=null}).addErrback(function(c){var e,f,g;if(c&&(e=c.code,f=c.subcode,g=c.messageCode,g=g&&g.toUpperCase()),c&&403==e&&(4==f||
c.message&&-1<c.message.toLowerCase().indexOf("ssl")&&-1===c.message.toLowerCase().indexOf("permission"))){if(!a._ssl)return a._ssl=a._sslFromServer=!0,a._usrDfd=b,void n(a,d)}else if(c&&415==c.status){if(H(a.url),!a._err415)return a._err415=1,a._usrDfd=b,void n(a,d)}else if(h.id&&-1!==D.indexOf(h.id._errorCodes,e)&&!h.id._isPublic(a.url)&&!r&&(403!=e||-1===D.indexOf(ea,g)&&(!z.isDefined(f)||2==f&&a._token)))return b._pendingDfd=h.id.getCredential(a.url,{token:a._token,error:c}),void b._pendingDfd.addCallback(function(c){a._token=
c.token;a._usrDfd=b;a._credential=c;a._ssl=a._sslFromServer||c.ssl;n(a,d)}).addErrback(function(c){a._usrDfd=null;b.errback(c);b._pendingDfd=null});b.ioArgs=b._pendingDfd&&b._pendingDfd.ioArgs;a._usrDfd=null;b.errback(c);b._pendingDfd=null})}a.url=p.fixUrl(a.url);"file:"!==window.location.protocol&&(a.url=p.getAbsoluteUrl(a.url));d=d||{};var f,k=a.form,r=d.disableIdentityLookup,C=d._preLookup,l=!1;if(q("esri-workers")&&!1!==m.useWorkers)if(!0===d.useWorkers||!0===m.useWorkers)l=!0;else if(d.workerOptions){var g=
d.workerOptions;(g.callback||g.worker&&g.worker.worker instanceof Worker)&&(l=!0)}var w=k&&k.append,E=k&&(k.elements?D.some(k.elements,function(a){return"file"===a.type}):w),B=-1!==a.url.toLowerCase().indexOf("token\x3d")||a.content&&a.content.token||E&&D.some(k.elements,function(a){return"token"===a.name})?1:0;if(L(a.url),a._usrDfd)f=a._usrDfd;else{f=new S(ca._dfdCanceller);f.addCallback(function(b){if((/\/sharing\/rest\/accounts\/self/i.test(a.url)||/\/sharing\/rest\/portals\/self/i.test(a.url))&&
!B&&!a._token&&b.user&&b.user.username){m.webTierAuthServers.push(v(a.url));b=m.corsEnabledServers;var c=p.canUseXhr(a.url,!0),d={host:v(a.url),withCredentials:!0};if(-1===c)b.push(d);else{var e=b[c];"object"==typeof e?e.withCredentials=!0:b.splice(c,1,d)}}if(b=a._credential){var f;(c=(c=h.id.findServerInfo(b.server))&&c.owningSystemUrl)&&(c=c.replace(/\/?$/,"/sharing"),f=h.id.findCredential(c,b.userId),f&&-1===h.id._getIdenticalSvcIdx(c,f)&&f.resources.splice(0,0,c))}});f.addBoth(function(b){delete a._credential;
!b||q("ie")&&b.nodeType||(b._ssl=a._ssl)});var x=a.load,y=a.error;x&&f.addCallback(function(a){var c=f._pendingDfd,c=c&&c.ioArgs;return x.call(c&&c.args,a,c)});y&&f.addErrback(function(a){var c=f._pendingDfd,c=c&&c.ioArgs;return y.call(c&&c.args,a,c)})}!h.id||B||a._token||h.id._isPublic(a.url)||r&&!C||(k=h.id.findCredential(a.url))&&(a._token=k.token,a._ssl=k.ssl);return l?d.workerOptions&&d.workerOptions.worker?(t||(t=u),u=d.workerOptions.worker,e(f)):Q(["./workers/RequestClient"],function(a){if(t||
(t=u),d.workerOptions){var c=d.workerOptions;u=a.getClient(c.callback,c.cbFunction)}else u=a.getClient();e(f)}):(t&&(u=t,t=null),e(f)),f}var C,t=null,m=ba.defaults.io,ea=["COM_0056","COM_0057"],da=0;return n._request=A,n._disableCors=H,n._detectCors=L,n.setRequestPreCallback=M,q("extend-esri")&&(h.request=n,h._request=A,h._disableCors=H,h._detectCors=L,h.setRequestPreCallback=M),n});