//>>built
define("esri/renderers/BlendRenderer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/has ../kernel ../Color ./Renderer".split(" "),function(e,l,f,n,p,q,m,r){e=e(r,{declaredClass:"esri.renderer.BlendRenderer",constructor:function(a){l.mixin(this,a);this.blendMode=this.blendMode||"source-over";(this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1)||console.log("BlendRenderer requires a Canvas enabled Browser. Internet Explorer versions 8 and earlier do not support Canvas.");
this._updateCache()},setFields:function(a){this.fields=a;this._updateCache()},setSymbol:function(a){this.symbol=a},setBlendMode:function(a){this.blendMode=a},setOpacityStops:function(a){this.opacityStops=a;this._updateCache()},setNormalizationField:function(a){this.normalizationField=a;this._updateCache()},toJson:function(){},getSymbol:function(a){var b=this.fields,c=this._dataCache,d=this._opacityInfos;if(this._supportsCanvas&&c&&d){var g,h,e=[],k={};return f.forEach(b,function(b,f){this._getColorComponent(a,
d[f],c[f],!0,k);h=b.color.toRgba();h[3]=k.value||0;g=new m(h);g._data=k.data;e.push(g)},this),e.sort(this._colorSorter),this.symbol.setColor(this._getBlendedColor(e)),this.symbol}},_colorSorter:function(a,b){var c=null!=a._data,d=null!=b._data;return c&&d?a._data-b._data:c?1:d?-1:0},_getBlendedColor:function(a){var b,c,d=this._canvas;return d||(d=this._canvas=this._createCanvas(1,1)),b=d.getContext("2d"),b.globalCompositeOperation=this.blendMode,f.forEach(a,function(a){b.fillStyle=a.toCss(!0);b.fillRect(0,
0,1,1)}),c=b.getImageData(0,0,1,1).data,b.clearRect(0,0,d.width,d.height),new m([c[0],c[1],c[2],c[3]/255])},_createCanvas:function(a,b){return n.create("canvas",{width:a+"px",height:b+"px",style:"position: absolute; left: -10000px; top: 0px;"},document.body)},_updateCache:function(){var a=this.fields,b=this.opacityStops;if(this._dataCache=this._opacityInfos=null,a&&b){var c,d=this._dataCache=[],e=this._opacityInfos=[];f.forEach(a,function(a){c={field:a.field,normalizationField:this.normalizationField,
stops:b};e.push(c);d.push(this._processOpacityInfo(c))},this)}}});return p("extend-esri")&&l.setObject("renderer.BlendRenderer",e,q),e});