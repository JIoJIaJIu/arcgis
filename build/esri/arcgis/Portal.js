//>>built
define("esri/arcgis/Portal","dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../Evented ../IdentityManager".split(" "),function(h,c,z,l,g,A,v,w,B,C,D){var f={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},k=function(a){function b(b){a[b]||(a[b]=function(){var c=arguments;return l.when(a,function(a){return Array.prototype.unshift.call(c,a.results||a),k(g[b].apply(g,c))})})}return a?(a.then&&
(a=c.delegate(a)),a.total||(a.total=l.when(a,function(a){return B.isDefined(a.total)?a.total:a.length||0})),b("forEach"),b("filter"),b("map"),b("some"),b("every"),a):a},e={useSSL:function(a,b){var d=f&&f.self||{};if(d&&!d.isPortal)return-1!==a.indexOf("https:")||d.allSSL?b.replace("http:","https:"):b;var c=e.getLocation(b);if(-1<d.portalHostname.toLowerCase().indexOf(c.hostname.toLowerCase())&&c.port&&"80"!==c.port&&"443"!==c.port){var g=c.pathname;return g=0===g.indexOf("/")?g:"/"+g,d.allSSL||-1<
a.indexOf("https:")?"https://"+c.hostname+(d.httpsPort&&"443"!==d.httpsPort?":"+d.httpsPort:"")+g+c.search:"http://"+c.hostname+(d.httpPort&&"80"!==d.httpPort?":"+d.httpPort:"")+g+c.search}return-1!==a.indexOf("https:")||d.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=f.currentToken;return-1!==a.indexOf("null")?null:e.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?"\x26":"?")+("token\x3d"+b):a)},getLocation:function(a){var b=document.createElement("a");return b.href=
a,{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,d){return d=d?d.listings||d.notifications||d.userInvitations||d.tags||d.items||d.groups||d.comments||d.provisions||d.results||d:[],g.map(d,function(d){return d=c.mixin(d,b||{}),a?new a(d):d})},clearFieldsFromObject:function(a,b){var d,e=a.length;if(c.isArray(a))for(d=0;e>d;d++)delete b[a[d]];else for(d in a)delete b[d];return b},requestToTypedArray:function(a,
b,d,f,g){return k(e.request(a,b,d).then(c.partial(e.resultsToTypedArray,f,g)))},request:function(a,b,d){var g,h,n;return b&&b.portal&&delete b.portal,b&&b.form&&(g=b.form,delete b.form),h=c.mixin(c.mixin({},b||{}),f.requestParams),n=c.mixin(d||{},f.options),C({url:e.useSSL(window.location.protocol,a.url||a),content:h,callbackParamName:"callback",timeout:n&&n.timeout||0,form:g},n)},formatQueryParams:function(a,b,d){a=c.mixin(c.mixin({},a),c.isString(b)?{q:b}:b||{});return a.q=!d&&f.extraQuery?"("+
a.q+")"+f.extraQuery:a.q,a}},p=h([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){c.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),q=h([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){c.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),m=h([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){c.mixin(this,a);this.folderId=
this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("content","content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")):null;this.itemDataUrl=e.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=e.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();
this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a,b=this.type;return a=-1<g.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===b?b:null,{source:a,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(a){var b=c.isString(a)?{comment:a}:
a;return e.request(this.itemUrl+"/addComment",b,{usePost:!0}).then(c.hitch(this,function(a){return new p(c.mixin(b,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return e.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){return a.id=b.commentId,a});throw Error();},getComments:function(){return e.requestToTypedArray(this.itemUrl+"/comments",null,null,p,{item:this})},deleteComment:function(a){if(a&&a.url)return e.request(a.url+"/delete",null,
{usePost:!0});throw Error();},addRating:function(a){var b=c.isObject(a)?a:{rating:parseFloat(a)};return e.request(this.itemUrl+"/addRating",b,{usePost:!0}).then(c.hitch(this,function(a){return new q(c.mixin(b,{id:a.ratingId,item:this}))}))},getRating:function(){return e.request(this.itemUrl+"/rating").then(c.hitch(this,function(a){return new q(c.mixin(a,{item:this}))}))},deleteRating:function(){return e.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var a=this.type,
b=this.typeKeywords||[],d=a;return"Feature Service"===a||"Feature Collection"===a?d=-1<g.indexOf(b,"Table")?"Table":"Feature Layer":"Image Service"===a?d=-1<g.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?d="Scene Layer":"Stream Service"===a?d="Feature Layer":"Microsoft Powerpoint"===a?d="Microsoft PowerPoint":"GeoJson"===a?(d="GeoJSON",this.type="GeoJSON"):"Globe Service"===a?d="Globe Layer":"Vector Tile Service"===a?d="Tile Layer":"Map Service"===a?d=-1<g.indexOf(b,
"Hosted Service")||-1<g.indexOf(b,"Tiled")?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")&&(d=a.replace(/(add in)/gi,"Add-In")),d},_getIconUrl:function(){var a,b=this.type&&this.type.toLowerCase()||"",d=this.typeKeywords||[],c=!1,e=!1;return 0<b.indexOf("service")||"feature collection"===b||"kml"===b||"wms"===b||"wmts"===b?(c=-1<g.indexOf(d,"Hosted Service"),"feature service"===b||"feature collection"===b||"kml"===b?(e=-1<g.indexOf(d,"Table"),a=e?"table":c?"featureshosted":
"features"):a="map service"===b||"wms"===b||"wmts"===b?c||-1<g.indexOf(d,"Tiled")?"maptiles":"mapimages":"scene service"===b?"sceneweblayer":"image service"===b?-1<g.indexOf(d,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===b?"streamlayer":"vector tile service"===b?"vectortile":"datastore catalog service"===b?"datastorecollection":"layers"):a="web map"===b||"cityengine web scene"===b?"maps":"web scene"===b?-1<g.indexOf(d,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===
b||"mobile application"===b||"application"===b||"operation view"===b||"desktop application"===b?"apps":"map document"===b||"map package"===b||"published map"===b||"scene document"===b||"globe document"===b||"basemap package"===b||"mobile basemap package"===b||"mobile map package"===b||"project package"===b||"project template"===b||"pro map"===b||"layout"===b||"layer"===b&&-1<g.indexOf(d,"ArcGIS Pro")||"explorer map"===b&&g.indexOf(d,"Explorer Document")?"mapsgray":"service definition"===b||"csv"===
b||"shapefile"===b||"cad drawing"===b||"geojson"===b?"datafiles":"explorer add in"===b||"desktop add in"===b||"windows viewer add in"===b||"windows viewer configuration"===b?"appsgray":"rule package"===b||"file geodatabase"===b||"csv collection"===b||"kml collection"===b||"windows mobile package"===b||"map template"===b||"desktop application template"===b||"arcpad package"===b||"code sample"===b||"form"===b||"document link"===b||"tile package"===b||"vector tile package"===b||"scene package"===b||
"operations dashboard add in"===b||"rules package"===b||"image"===b||"workflow manager package"===b||"desktop style"===b||"explorer map"===b&&-1<g.indexOf(d,"Explorer Mapping Application")||-1<g.indexOf(d,"Document")?"datafilesgray":"geocoding service"===b||"network analysis service"===b||"geoprocessing service"===b||"geodata service"===b||"geometry service"===b||"geoprocessing package"===b||"locator package"===b||"geoprocessing sample"===b||"workflow manager service"===b||"raster function template"===
b?"toolsgray":"layer"===b||"layer package"===b||"explorer layer"===b?"layersgray":"task file"===b?"taskfile":"report template"===b?"report-template":"maps",a?v.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;return-1<g.indexOf(a,"Service")&&(-1<g.indexOf(a,"Requires Subscription")||-1<g.indexOf(this.typeKeywords,"Requires Credits"))&&(b=!0),b},_getPremiumIconUrl:function(){var a,b=this.typeKeywords;return this.isPremiumContent&&
(a=-1<g.indexOf(b,"Requires Credits")?"premiumcredits":"premiumitem"),a?v.toUrl("../css/images/item_type_icons/"+a+"16.png"):null}}),r=h([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){c.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?e.formatUrl(this.url+"/info/"+this.banner):
"";this.thumbnail=this.thumbnail?e.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?e.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var b in this.listingProperties)this[b]&&(this.listingProperties[b]=
this[b]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=g.map(this.screenshots,c.hitch(this,function(a){return e.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?e.formatUrl(this.userItemUrl?this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail:this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return e.requestToTypedArray(this.commentsUrl,
null,null,p,{item:this})},getVendor:function(){return this.vendor}}),t=h([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){c.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new r(c.mixin(a.listing,{portal:this.portal})):null}}),u=h([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){c.mixin(this,
a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=e.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return e.request(this.url+"/users")},queryItems:function(a,b){return a=e.formatQueryParams({},a,b),a.q="group:"+this.id+(a.q?" "+a.q:""),this.portal.queryItems(a)}}),x=h([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){c.mixin(this,
a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return e.requestToTypedArray(this.url,null,null,m,{portal:this.portal,folderId:this.id})}}),y=h([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){c.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;
this.thumbnailUrl=e.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return k(e.request(this.url).then(c.hitch(this,function(a){return e.resultsToTypedArray(u,{portal:this.portal},a.groups)})))},getNotifications:function(){return e.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return e.requestToTypedArray(this.url+
"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return e.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return k(this.getContent().then(function(a){return a.folders}))},getItems:function(a){return k(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return e.request(this.portal.portalUrl+"content/items/"+a).then(c.hitch(this,function(a){return new m(c.mixin(a,{portal:this.portal}))}))},getContent:function(a){var b=
this.url.replace("community","content")+(a?"/"+a:"");return e.request(b).then(c.hitch(this,function(b){return b.folders=e.resultsToTypedArray(x,{portal:this.portal},b.folders),b.items=e.resultsToTypedArray(m,{portal:this.portal,folderId:a},b.items),b}))}});h={Portal:h([D],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=c.isObject(a)?a:{url:a};(this.registerConnectEvents(),f={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},a.self)?
(f.self=a.self,c.mixin(this,{url:a.url||window.location.protocol+"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&c.mixin(this,{url:a.url}),a=this.init(this.url));a.then(c.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,b){a=(a||this.portalUrl).replace(/\/+$/,"");return this.portalUrl=
-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/",this._getSelf(this.portalUrl).then(c.hitch(this,function(a){f.self=c.mixin({},a);a=a.user;return a&&b&&(f.currentToken=b&&b.token,f.loggedInUser=new y(c.mixin(a,{portal:this,credential:b}))),f.self.id&&!1===f.self.canSearchPublic&&(f.extraQuery=" AND orgid:"+f.self.id),c.mixin(this,f.self),this.thumbnailUrl=e.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail),this.isOrganization=this.access&&this.access.length||!1,this.created=this.created?
new Date(this.created):null,this.modified=this.modified?new Date(this.modified):null,this}),c.hitch(this,function(a){throw this.onError(a),a;}))},signIn:function(){var a=new l,b=c.hitch(this,function(){this._onSignIn().then(c.hitch(this,function(){a.resolve(f.loggedInUser)}),c.hitch(this,function(b){a.reject(b)}))});return f&&f.self?f&&f.loggedInUser?setTimeout(function(){a.resolve(f.loggedInUser)},0):b():this.on("load",c.hitch(this,function(){b()})),a},signOut:function(){return f.loggedInUser.credential&&
f.loggedInUser.credential.destroy(),f.loggedInUser=null,f.options.disableIdentityLookup=!0,e.clearFieldsFromObject(f.self,this),f.self=null,this.init(this.url)},getPortalUser:function(){return f.loggedInUser},addResource:function(a,b){return e.request(this.portalUrl+"portals/self/addResource",{key:a,text:b},{usePost:!0})},update:function(a){return e.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",e.formatQueryParams({},
a,b),u)},queryItems:function(a,b){return this._queryPortal(this.portalUrl+"search",e.formatQueryParams({},a,b),m)},queryListings:function(a){a=e.formatQueryParams({},a,!0);var b="";return a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",""),b="?mylistings\x3dtrue"):a.q||(a.q='""'),this._queryPortal(this.portalUrl+"content/listings"+b,a,r)},queryCustomerList:function(a){a=e.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",
a)},getProvisions:function(){return this.getCustomers().then(c.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(c.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(c.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return e.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},
getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return e.request(this.portalUrl+"portals/self/purchases").then(c.hitch(this,function(a){return a.interests=g.map(a.interests,function(a){return c.mixin(a.provision,{listing:a.listing})}),a.purchases=g.map(a.purchases,function(a){return c.mixin(a.provision,{listing:a.listing})}),a.trials=g.map(a.trials,function(a){return c.mixin(a.provision,{listing:a.listing})}),a.interests=e.resultsToTypedArray(t,
{portal:this},a.interests),a.trials=e.resultsToTypedArray(t,{portal:this},a.trials),a.purchases=e.resultsToTypedArray(t,{portal:this},a.purchases),a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+"community/users",e.formatQueryParams({sortField:"username"},a,b),y)},_onSignIn:function(){return f.options.disableIdentityLookup=!1,f.self&&f.self.user||(f.self=null),w.id.getCredential(this.portalUrl).then(c.hitch(this,"init",this.url)).then(function(){return f.loggedInUser},c.hitch(this,
function(a){throw f.options.disableIdentityLookup=!0,this.onError(a),a;}))},_getSelf:function(a){var b;a+="portals/self";return f.self?(b=new l,setTimeout(function(){b.resolve(f.self)},0)):b=e.request(a,{culture:z.locale}),b},_queryPortal:function(a,b,d){var f=c.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},b),g=["start","query","num","nextStart"];a=e.request(a,f).then(c.hitch(this,function(a){return a.results=e.resultsToTypedArray(d,{portal:this},a),a.queryParams=c.mixin({},f),a.nextQueryParams=
c.mixin(f,{start:a.nextStart}),e.clearFieldsFromObject(g,a)}));return a=c.delegate(a),a.queryParams=c.mixin({},f),a.nextQueryParams=l.when(a,function(a){return a.nextQueryParams}),k(a)}}),PortalFolder:x,PortalGroup:u,PortalItem:m,PortalComment:p,PortalRating:q,PortalUtil:e,PortalResult:k,PortalListing:r};return A("extend-esri")&&c.mixin(c.getObject("arcgis",!0,w),h),h});