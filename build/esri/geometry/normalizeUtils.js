//>>built
define("esri/geometry/normalizeUtils","dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/has ../kernel ../config ../deferredUtils ./Polyline ./Polygon ./webMercatorUtils ./jsonUtils".split(" "),function(f,l,F,M,N,O,z,x,B,A,P){function y(a,d){return Math.ceil((a-d)/(2*d))}function C(a,d){var e,c,b,m=a.paths||a.rings,p=m.length;for(e=0;p>e;e++)for(b=m[e].length,c=0;b>c;c++){var g=a.getPoint(e,c);a.setPoint(e,c,g.offset(d,0))}return a}function G(a,d){if(!(a instanceof x||a instanceof B))throw console.error("_straightLineDensify: the input geometry is neither polyline nor polygon"),
Error("_straightLineDensify: the input geometry is neither polyline nor polygon");var e,c=a instanceof x,b=[];return f.forEach(c?a.paths:a.rings,function(a){b.push(e=[]);e.push([a[0][0],a[0][1]]);var c,g,h,k,u,q,f,n,r,t,l,v;for(u=0;u<a.length-1;u++){if(c=a[u][0],g=a[u][1],h=a[u+1][0],k=a[u+1][1],f=Math.sqrt((h-c)*(h-c)+(k-g)*(k-g)),n=(k-g)/f,r=(h-c)/f,t=f/d,1<t){for(q=1;t-1>=q;q++)v=q*d,l=r*v+c,v=n*v+g,e.push([l,v]);q=(f+Math.floor(t-1)*d)/2;l=r*q+c;v=n*q+g;e.push([l,v])}e.push([h,k])}}),c?new x({paths:b,
spatialReference:a.spatialReference}):new B({rings:b,spatialReference:a.spatialReference})}function D(a,d,e){d&&(a=G(a,1E6),a=A.webMercatorToGeographic(a,!0));return e&&(a=C(a,e)),a}function E(a,d,e){var c,b=a.x||a[0];return b>d?(c=y(b,d),a.x?a=a.offset(-2*c*d,0):a[0]=b+-2*c*d):e>b&&(c=y(b,e),a.x?a=a.offset(-2*c*e,0):a[0]=b+-2*c*e),a}function H(a,d){var e=-1;return f.forEach(d.cutIndexes,function(c,b){var m=d.geometries[b];f.forEach(m.rings||m.paths,function(a,c){f.some(a,function(b){if(180>b[0])return!0;
var e,d=0,f=a.length;for(b=0;f>b;b++)e=a[b][0],d=e>d?e:d;d=Number(d.toFixed(9));e=-360*y(d,180);d=a.length;for(b=0;d>b;b++)f=m.getPoint(c,b),m.setPoint(c,b,f.offset(e,0));return!0})});c===e?m.rings?f.forEach(m.rings,function(b){a[c]=a[c].addRing(b)}):f.forEach(m.paths,function(b){a[c]=a[c].addPath(b)}):(e=c,a[c]=m)}),a}function I(a,d,e,c){var b=new F;b.addCallbacks(e,c);d=d||O.defaults.geometryService;var m,p,g,h,k,u,q,l,n=[],r=[],t=0;f.forEach(a,function(a){if(!a||(m||(m=a.spatialReference,p=m._getInfo(),
g=m._isWebMercator(),h=g?2.0037508342788905E7:180,k=g?-2.0037508342788905E7:-180,u=g?102100:4326,q=new x({paths:[[[h,k],[h,h]]],spatialReference:{wkid:u}}),l=new x({paths:[[[k,k],[k,h]]],spatialReference:{wkid:u}})),!p))return void n.push(a);var b=P.fromJson(a.toJson()),c=a.getExtent();"point"===a.type?n.push(E(b,h,k)):"multipoint"===a.type?(b.points=f.map(b.points,function(a){return E(a,h,k)}),n.push(b)):"extent"===a.type?(b=c._normalize(null,null,p),n.push(b.rings?new B(b):b)):c?(a=2*y(c.xmin,k)*
h,b=0===a?b:C(b,a),c=c.offset(a,0),c.intersects(q)&&c.xmax!==h?(t=c.xmax>t?c.xmax:t,b=D(b,g),r.push(b),n.push("cut")):c.intersects(l)&&c.xmin!==k?(t=2*c.xmax*h>t?2*c.xmax*h:t,b=D(b,g,360),r.push(b),n.push("cut")):n.push(b)):n.push(b)});e=new x;c=y(t,h);for(var w=-90,v=c;0<c;){var z=-180+360*c;e.addPath([[z,w],[z,-1*w]]);w*=-1;c--}return 0<r.length&&0<v?d?d.cut(r,e,function(c){r=H(r,c);var e=[];f.forEach(n,function(b,c){if("cut"===b){var d=r.shift();a[c].rings&&1<a[c].rings.length&&d.rings.length>=
a[c].rings.length?(n[c]="simplify",e.push(d)):n[c]=!0===g?A.geographicToWebMercator(d):d}});0<e.length?d.simplify(e,function(a){f.forEach(n,function(b,c){"simplify"===b&&(n[c]=!0===g?A.geographicToWebMercator(a.shift()):a.shift())});b.callback(n)},function(a){b.errback(a)}):b.callback(n)},function(a){b.errback(a)}):b.errback(Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing.")):(f.forEach(n,function(a,b){if("cut"===a){var c=r.shift();n[b]=!0===g?A.geographicToWebMercator(c):
c}}),b.callback(n)),b}function w(a,d,e,c){var b,m=!1;l.isObject(a)&&a&&(l.isArray(a)?a.length&&(b=a[0]&&a[0].declaredClass,b&&-1!==b.indexOf("Graphic")?(a=f.map(a,function(a){return a.geometry}),m=a.length?!0:!1):b&&-1!==b.indexOf("esri.geometry.")&&(m=!0)):(b=a.declaredClass,b&&-1!==b.indexOf("FeatureSet")?(a=f.map(a.features||[],function(a){return a.geometry}),m=a.length?!0:!1):b&&-1!==b.indexOf("esri.geometry.")&&(m=!0)));m&&d.push({index:e,property:c,value:a})}function J(a,d){var e=[];return f.forEach(d,
function(c){var b,d=c.i,p=a[d];c=c.p;if(l.isObject(p)&&p)if(c)if("*"===c[0])for(b in p)p.hasOwnProperty(b)&&w(p[b],e,d,b);else f.forEach(c,function(a){w(l.getObject(a,!1,p),e,d,a)});else w(p,e,d)}),e}function K(a,d){var e=0,c={};return f.forEach(d,function(b){var d=b.index,f=b.property,g=b.value,h=g.length||1,k=a.slice(e,e+h);l.isArray(g)||(k=k[0]);e+=h;delete b.value;f?(c[d]=c[d]||{},c[d][f]=k):c[d]=k}),c}var L={normalizeCentralMeridian:I,_foldCutResults:H,_prepareGeometryForCut:D,_offsetMagnitude:y,
_pointNormalization:E,_updatePolyGeometry:C,_straightLineDensify:G,_createWrappers:function(a){var d=l.isObject(a)?a.prototype:l.getObject(a+".prototype");f.forEach(d.__msigns,function(a){var c=d[a.n];d[a.n]=function(){var b,d=this,p=[],g=new F(z._dfdCanceller);a.f&&z._fixDfd(g);for(b=0;b<a.c;b++)p[b]=arguments[b];var h={dfd:g};p.push(h);var k,l,q=[];return d.normalization&&!d._isTable&&(k=J(p,a.a),f.forEach(k,function(a){q=q.concat(a.value)}),q.length&&(l=I(q))),l?(g._pendingDfd=l,l.addCallbacks(function(a){g.canceled||
(h.assembly=K(a,k),g._pendingDfd=c.apply(d,p))},function(b){var c=d.declaredClass;c&&-1!==c.indexOf("FeatureLayer")?d._resolve([b],null,p[a.e],g,!0):d._errorHandler(b,p[a.e],g)})):g._pendingDfd=c.apply(d,p),g}})},_disassemble:J,_addToBucket:w,_reassemble:K};return M("extend-esri")&&l.mixin(l.getObject("geometry",!0,N),L),L});