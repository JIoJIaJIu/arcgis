//>>built
define("esri/PointerEvents","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),function(h,e,m,q,t,u,k,p){h=h([u],{declaredClass:"esri.PointerEvents",tapRadius:8,clickRadius:2,doubleTapRadius:10,tapStartTolerance:50,doubleTapDuration:300,minWheelValue:1,maxWheelValue:1,mozWheelDivisor:-1!==q("mac")?1:3,wheelDivisor:120,preventPageScroll:!0,_dragging:!1,constructor:function(a,b){this.node=a;e.mixin(this,b);void 0!==a.style.msTouchAction?
a.style.msTouchAction="none":void 0!==a.style.touchAction&&(a.style.touchAction="none");var c=navigator.msPointerEnabled,f=function(a){a.preventDefault()};a.addEventListener("selectstart",f,!1);a.addEventListener("dragstart",f,!1);this._pointerDown=e.hitch(this,this._pointerDown);this._pointerMove=e.hitch(this,this._pointerMove);this._pointerUp=e.hitch(this,this._pointerUp);this._pointerCancel=e.hitch(this,this._pointerCancel);a.addEventListener(c?"MSPointerDown":"pointerdown",this._pointerDown,!1);
a.addEventListener(c?"MSPointerMove":"pointermove",this._pointerMove,!1);a.addEventListener(c?"MSPointerUp":"pointerup",this._pointerUp,!1);a.addEventListener(c?"MSPointerCancel":"pointercancel",this._pointerCancel,!1);this.map&&(this._mouseOver=e.hitch(this,this._mouseOver),this._mouseOut=e.hitch(this,this._mouseOut),this._mouseLeave=e.hitch(this,this._mouseLeave),this._mouseDown=e.hitch(this,this._mouseDown),this._mouseUp=e.hitch(this,this._mouseUp),this._mouseClick=e.hitch(this,this._mouseClick),
this._mouseWheel=e.hitch(this,this._mouseWheel),this._mouseMove=e.hitch(this,this._mouseMove),this._mouseEnter=e.hitch(this,this._mouseEnter),this._onKeyDown=e.hitch(this,this._onKeyDown),this._onKeyUp=e.hitch(this,this._onKeyUp),a.addEventListener("mouseover",this._mouseOver,!1),a.addEventListener("mouseout",this._mouseOut,!1),a.addEventListener("mouseleave",this._mouseLeave,!1),a.addEventListener("mousedown",this._mouseDown,!1),a.addEventListener("mouseup",this._mouseUp,!1),a.addEventListener("click",
this._mouseClick,!1),a.addEventListener("mousewheel",this._mouseWheel,!1),a.addEventListener("mousemove",this._mouseMove,!1),a.addEventListener("mouseenter",this._mouseEnter,!1));this._numTouches=0;this._touches={};this._touchIds=[];this._taps=[];this._immediate=!1},_pointerDown:function(a){if(-1<m.indexOf(this._touchIds,a.pointerId))return void this._pointerUp(a);var b,c;c=this._touches;var f=a.target,d=a.pointerId,g=this._touchIds,e=(new Date).getTime();b=c[d]={};b.pointerId=d;b.startX=b.pageX=
a.pageX;b.startY=b.pageY=a.pageY;b.startTS=e;g.push(d);this._numTouches++;f.setPointerCapture?f.setPointerCapture(d):f.msSetPointerCapture&&f.msSetPointerCapture(d);b=c[g[0]];c=c[g[1]];1===this._numTouches||(2===this._numTouches?this._swipeActive&&(b&&(b.startX=b.pageX,b.startY=b.pageY,b.moved=!1),this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(a,b))):this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(a,b))):this._pinchActive&&(this._pinchActive=
!1,this._fire("onPinchEnd",this._processTouchEvent(a,[b,c]))))},_pointerMove:function(a){var b,c,f,d=this._touches,g=this._touchIds;if(b=d[a.pointerId],b&&(b.pageX!==a.pageX||b.pageY!==a.pageY))if(b.pageX=a.pageX,b.pageY=a.pageY,c=Math.abs(b.pageX-b.startX),f=Math.abs(b.pageY-b.startY),!b.moved&&(c>=this.tapRadius||f>=this.tapRadius)&&(b.moved=b.absMoved=!0),1===this._numTouches)this._swipeActive?this._fire("onSwipeMove",this._processTouchEvent(a,a)):b.moved&&(this._swipeActive=!0,this._fire("onSwipeStart",
this._processTouchEvent(a,a)));else if(2===this._numTouches)if(b=d[g[0]],d=d[g[1]],this._pinchActive)this._fire("onPinchMove",this._processTouchEvent(a,[b,d]));else if(b.moved||d.moved)g=Math.abs(b.startX-d.startX),c=Math.abs(b.startY-d.startY),g=Math.sqrt(g*g+c*c),c=Math.abs(b.pageX-d.pageX),f=Math.abs(b.pageY-d.pageY),c=Math.sqrt(c*c+f*f),Math.abs(c-g)>=2*this.tapRadius&&(this._pinchActive=!0,this._fire("onPinchStart",this._processTouchEvent(a,[b,d])))},_pointerUp:function(a){var b,c=this._touches,
f=this.node,d=a.target,g=a.pointerId,e=this._touchIds,n=e.slice(0),r=m.map(n,function(a){return c[a]}),l=(new Date).getTime();if(b=c[g])if(b.pageX=a.pageX,b.pageY=a.pageY,b.endTS=l,this._numTouches--,d.releasePointerCapture?d.releasePointerCapture(g):d.msReleasePointerCapture&&d.msReleasePointerCapture(g),0===this._numTouches)if(this._touches={},this._touchIds=[],this._swipeActive)this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(a,a));else if(this._pinchActive)this._pinchActive=
!1,this._fire("onPinchEnd",this._processTouchEvent(a,a));else{if(!b.absMoved){for(var g=1/0,e=-1/0,l=1/0,h=-1/0,k=this.tapStartTolerance,d=0;d<n.length;d++)b=r[d],b.startTS<g&&(g=b.startTS),b.startTS>e&&(e=b.startTS),b.endTS<l&&(l=b.endTS),b.endTS>h&&(h=b.endTS);Math.abs(e-g)<=k&&Math.abs(h-l)<=k&&this._basicTap(a,r)}}else if(1===this._numTouches&&this._pinchActive){e.splice(m.indexOf(e,a.pointerId),1);delete c[a.pointerId];b=c[e[0]];if(b.startX=b.pageX,b.startY=b.pageY,b.moved=!1,document.msElementsFromPoint)n=
document.msElementsFromPoint(b.pageX,b.pageY),m.some(n,function(a){return a===f})||(this._touches={},this._touchIds=[],this._numTouches=0);this._pinchActive=!1;this._fire("onPinchEnd",this._processTouchEvent(a,[a,b]))}},_pointerCancel:function(a){this._numTouches&&this._pointerUp(a)},_basicTap:function(a,b){var c=(new Date).getTime(),f=this,d=this._immediate;a=this._processTouchEvent(a,b);this._taps.push({touchInfos:b,ts:c,event:a});2<this._taps.length&&this._taps.shift();this._fire("onBasicTap",
a);clearTimeout(this._tapTimer);c=2===this._taps.length?this.doubleTapDuration/2:this.doubleTapDuration;this._tapTimer=setTimeout(function(){var a=f;f=null;clearTimeout(a._tapTimer);a._analyzeTap(d)},d?0:c)},_analyzeTap:function(a){var b=this._taps,c=b[0],f=b[1],d=c.touchInfos,g=f&&f.touchInfos;if(b.length)if(a||(this._taps=[]),c&&f)if(d.length===g.length)if(f.ts-c.ts<=this.doubleTapDuration){var e,h,k;1===d.length?(h=Math.abs(d[0].startX-g[0].startX),k=Math.abs(d[0].startY-g[0].startY),e=h<=this.doubleTapRadius&&
k<=this.doubleTapRadius):e=!0;e?this._processedDoubleTap(b):this._processedTap(f)}else this._processedTap(f);else this._processedTap(f);else this._processedTap(c||f)},_processedTap:function(a){var b=a.event;this._fire("onProcessedTap",b);1===a.touchInfos.length?this._fire("onTap",this._fixEvent(b)):2===a.touchInfos.length&&this._fire("onTwoFingerTap",b)},_processedDoubleTap:function(a){var b,c=1===a[1].touchInfos.length;c&&(b=[this._fixEvent(a[0].event),this._fixEvent(a[1].event)],b[1].relatedEvents=
b);a=[a[0].event,a[1].event];a[1].relatedEvents=a;this._fire("onProcessedDoubleTap",a[1]);c&&(this._fire("onDoubleTap",b[1]),this._fire("onDblClick",b[1]))},_mouseOver:function(a){this._fire("onMouseOver",this._processMouseEvent(a))},_mouseMove:function(a){this._dragging?this._fire("onMouseDrag",this._processMouseEvent(a)):this._fire("onMouseMove",this._processMouseEvent(a))},_mouseOut:function(a){this._fire("onMouseOut",this._processMouseEvent(a))},_mouseLeave:function(){document.removeEventListener("keydown",
this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseOut",this._processMouseEvent(event))},_mouseDown:function(a){this._downX=a.pageX;this._downY=a.pageY;this._fire("onMouseDown",this._processMouseEvent(a));0===a.button&&(this._dragging=!0,this._fire("onMouseDragStart",this._processMouseEvent(a)))},_mouseUp:function(a){this._dragging&&(this._dragging=!1,this._fire("onMouseDragEnd",this._processMouseEvent(a)));this._fire("onMouseUp",this._processMouseEvent(a))},
_mouseClick:function(a){Math.abs(a.pageX-this._downX)<=this.clickRadius&&Math.abs(a.pageY-this._downY)<=this.clickRadius&&this._fire("onClick",this._processMouseEvent(a))},_mouseWheel:function(a){var b=this.map;(b?b.isScrollWheelZoom||b.isScrollWheelPan:this.preventPageScroll)&&a.preventDefault();var b=a.wheelDelta?a.wheelDelta/this.wheelDivisor:-a.detail/this.mozWheelDivisor,c=Math.abs(b),c=c<=this.minWheelValue?this.minWheelValue:this.maxWheelValue;a.value=0>b?-c:c;this._fire("onMouseWheel",this._processMouseEvent(a))},
_mouseEnter:function(a){document.removeEventListener("keydown",this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);document.addEventListener("keydown",this._onKeyDown,!1);document.addEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseEnter",this._processMouseEvent(a))},_onKeyDown:function(a){this._fire("onKeyDown",a)},_onKeyUp:function(a){this._fire("onKeyUp",a)},_fire:function(a,b){this[a]&&this[a](b);this.map&&this.map[a]&&this.map[a](b)},_fixEvent:function(a){var b,
c={};for(b in a)c[b]=a[b];return c.preventDefault=function(){a.preventDefault()},c.stopPropagation=function(){a.stopPropagation()},this.map&&(c.screenPoint=c.screenPoints[0],c.mapPoint=c.mapPoints[0]),c},_processTouchEvent:function(a,b){var c=this.map,f=c&&c.position,d=0;if(f&&b)if(e.isArray(b)){var g,h;a.screenPoints=[];a.mapPoints=[];for(g=0;g<b.length;g++)b[g]?(h=new p(b[g].pageX-f.x,b[g].pageY-f.y),a.screenPoints.push(h),a.mapPoints.push(c.extent?c.toMap(h):new k)):d++}else a.screenPoint=new p(b.pageX-
f.x,b.pageY-f.y),a.mapPoint=c.extent?c.toMap(a.screenPoint):new k;return a.numPoints=b?e.isArray(b)?b.length-d:1:0,a},_processMouseEvent:function(a){var b=this.map,c=b&&b.position;return c&&(a.screenPoint=new p(a.pageX-c.x,a.pageY-c.y),a.mapPoint=b.extent?b.toMap(a.screenPoint):new k),a},setImmediateTap:function(a){this._immediate=a},destroy:function(){var a=this.node;a.removeEventListener("MSPointerDown",this._pointerDown,!1);a.removeEventListener("MSPointerMove",this._pointerMove,!1);a.removeEventListener("MSPointerUp",
this._pointerUp,!1);a.removeEventListener("MSPointerCancel",this._pointerCancel,!1);this.map&&(a.removeEventListener("mouseover",this._mouseOver,!1),a.removeEventListener("mousemove",this._mouseMove,!1),a.removeEventListener("mouseout",this._mouseOut,!1),a.removeEventListener("mouseleave",this._mouseLeave,!1),a.removeEventListener("mousedown",this._mouseDown,!1),a.removeEventListener("mouseup",this._mouseUp,!1),a.removeEventListener("click",this._mouseClick,!1),a.removeEventListener("mouseenter",
this._mouseEnter,!1));clearTimeout(this._tapTimer);this.node=this.map=this._numTouches=this._touches=this._touchIds=this._taps=null}});return q("extend-esri")&&(t.PointerEvents=h),h});