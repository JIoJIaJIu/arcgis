//>>built
define("esri/tasks/FeatureSet","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(l,t,v,x,y,z,A,B,C,p,D){l=l(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){t.mixin(this,a);var b=this.features,c=a.spatialReference,u=p.getGeometryType(a.geometryType),c=this.spatialReference=new B(c);this.geometryType=a.geometryType;a.fields&&(this.fields=
a.fields);v.forEach(b,function(a,m){var q=a.geometry&&a.geometry.spatialReference;b[m]=new A(u&&a.geometry?new u(a.geometry):null,a.symbol&&D.fromJson(a.symbol),a.attributes);b[m].geometry&&!q&&b[m].geometry.setSpatialReference(c)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(a){var b={};return this.displayFieldName&&(b.displayFieldName=this.displayFieldName),this.fields&&(b.fields=this.fields),this.spatialReference?
b.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(b.geometryType=p.getJsonType(this.features[0].geometry)),b.features=C._encodeGraphics(this.features,a)),b.exceededTransferLimit=this.exceededTransferLimit,b.transform=this.transform,z.fixJson(b)},_hydrate:function(){var a=this.transform,b=this.geometryType;if(!a||!b)return void(this.transform=
null);for(var c=this.features,u=a.translate[0],l=a.translate[1],m=a.scale[0],q=a.scale[1],n=function(a,b,r){return"esriGeometryPoint"===a?function(a){a.x=b(a.x);a.y=r(a.y)}:"esriGeometryPolyline"===a||"esriGeometryPolygon"===a?function(a){var w,e,f,g,d,h,k,c=a.rings||a.paths;a=0;for(w=c.length;w>a;a++)for(g=c[a],e=0,f=g.length;f>e;e++)d=g[e],0<e?(h+=d[0],k+=d[1]):(h=d[0],k=d[1]),d[0]=b(h),d[1]=r(k)}:"esriGeometryEnvelope"===a?function(a){a.xmin=b(a.xmin);a.ymin=r(a.ymin);a.xmax=b(a.xmax);a.ymax=r(a.ymax)}:
"esriGeometryMultipoint"===a?function(a){var c,e,f,g,d=a.points;a=0;for(c=d.length;c>a;a++)e=d[a],0<a?(f+=e[0],g+=e[1]):(f=e[0],g=e[1]),e[0]=b(f),e[1]=r(g)}:void 0}(b,function(a){return a*m+u},function(a){return l-a*q}),a=0,b=c.length;b>a;a++)c[a].geometry&&n(c[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b,c,l=a.translate[0],t=a.translate[1],m=a.scale[0],q=a.scale[1],n=this.features,p=function(a,b,c){var e,f,g,d,h,k,l,m=[];e=0;for(f=
a.length;f>e;e++)g=a[e],0<e?(k=b(g[0]),l=c(g[1]),(k!==d||l!==h)&&(m.push([k-d,l-h]),d=k,h=l)):(d=b(g[0]),h=c(g[1]),m.push([d,h]));return 0<m.length?m:null},v=function(a,b,c){return"esriGeometryPoint"===a?function(a){return a.x=b(a.x),a.y=c(a.y),a}:"esriGeometryPolyline"===a||"esriGeometryPolygon"===a?function(a){var f,g,d,h,k;d=a.rings||a.paths;k=[];f=0;for(g=d.length;g>f;f++)h=d[f],(h=p(h,b,c))&&k.push(h);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null}:"esriGeometryMultipoint"===a?function(a){var f;
return f=p(a.points,b,c),0<f.length?(a.points=f,a):null}:"esriGeometryEnvelope"===a?function(a){return a}:void 0}(this.geometryType,function(a){return Math.round((a-l)/m)},function(a){return Math.round((t-a)/q)});b=0;for(c=n.length;c>b;b++)n[b].geometry&&(v(n[b].geometry)||n[b].setGeometry(null));return this.transform=a,this}});return x("extend-esri")&&t.setObject("tasks.FeatureSet",l,y),l});