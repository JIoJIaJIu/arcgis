//>>built
define("esri/tasks/locator","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(n,k,x,t,p,y,z,u,v,A,r){n=n(A,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(){this._geocodeHandler=
k.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=k.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=k.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(a){this.outSpatialReference=a},_geocodeHandler:function(a,b,h,g,c){try{var d,e,f,m=a.candidates;b=[];var l=m.length,q=a.spatialReference;for(e=0;l>e;e++)d=m[e],(f=d.location)&&(f.spatialReference=q),b[e]=new r(d);this._successHandler([b],
"onAddressToLocationsComplete",h,c)}catch(k){this._errorHandler(k,g,c)}},_geocodeAddressesHandler:function(a,b,h,g,c){try{var d,e,f=a.locations;b=[];var m=f.length,l=a.spatialReference;for(d=0;m>d;d++)(e=f[d].location)&&(e.spatialReference=l),b[d]=new r(f[d]);this._successHandler([b],"onAddressesToLocationsComplete",h,c)}catch(q){this._errorHandler(q,g,c)}},addressToLocations:function(a,b,h,g,c){var d,e,f,m,l,q,n;a.address&&(g=h,h=b,b=a.outFields,c=a.searchExtent,n=a.countryCode,d=a.magicKey,e=a.distance,
q=a.categories,a.location&&this.normalization&&(f=a.location.normalize()),m=a.maxLocations,l=a.forStorage,a=a.address);c&&(c=c.shiftCentralMeridian());var r=this.outSpatialReference;a=this._encode(k.mixin({},this._url.query,a,{f:"json",outSR:r&&p.toJson(r.toJson()),outFields:b&&b.join(",")||null,searchExtent:c&&p.toJson(c.toJson()),category:q&&q.join(",")||null,countryCode:n||null,magicKey:d||null,distance:e||null,location:f||null,maxLocations:m||null,forStorage:l||null}));var x=this._geocodeHandler,
y=this._errorHandler,w=new t(v._dfdCanceller);return w._pendingDfd=u({url:this._url.path+"/findAddressCandidates",content:a,callbackParamName:"callback",load:function(a,b){x(a,b,h,g,w)},error:function(a){y(a,g,w)}}),w},suggestLocations:function(a){var b;b=new t(v._dfdCanceller);a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a=this._encode(k.mixin({},this._url.query,{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,
searchExtent:a.searchExtent&&p.toJson(a.searchExtent.toJson()),category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"}));a=u({url:this._url.path+"/suggest",content:a,callbackParamName:"callback"});return b._pendingDfd=a,a.then(k.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);b.resolve(a)}),k.hitch(this,function(a){this._errorHandler(a);b.reject(a)})),b},addressesToLocations:function(a,
b,h){var g=this.outSpatialReference,c=[],d=a.categories,e=a.countryCode;x.forEach(a.addresses,function(a){c.push({attributes:a})});a=this._encode(k.mixin({},this._url.query,{category:d&&d.join(",")||null,sourceCountry:e||null},{addresses:p.toJson({records:c})},{f:"json",outSR:g&&p.toJson(g.toJson())}));var f=this._geocodeAddressesHandler,m=this._errorHandler,l=new t(v._dfdCanceller);return l._pendingDfd=u({url:this._url.path+"/geocodeAddresses",content:a,callbackParamName:"callback",load:function(a,
c){f(a,c,b,h,l)},error:function(a){m(a,h,l)}}),l},_reverseGeocodeHandler:function(a,b,h,g,c){try{var d=new r({address:a.address,location:a.location,score:100});this._successHandler([d],"onLocationToAddressComplete",h,c)}catch(e){this._errorHandler(e,g,c)}},locationToAddress:function(a,b,h,g){a&&this.normalization&&(a=a.normalize());var c=this.outSpatialReference;a=this._encode(k.mixin({},this._url.query,{outSR:c&&p.toJson(c.toJson()),location:a&&p.toJson(a.toJson()),distance:b,f:"json"}));var d=this._reverseGeocodeHandler,
e=this._errorHandler,f=new t(v._dfdCanceller);return f._pendingDfd=u({url:this._url.path+"/reverseGeocode",content:a,callbackParamName:"callback",load:function(a,b){d(a,b,h,g,f)},error:function(a){e(a,g,f)}}),f},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});return y("extend-esri")&&k.setObject("tasks.Locator",n,z),n});