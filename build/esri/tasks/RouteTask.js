//>>built
define("esri/tasks/RouteTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(e,g,n,p,q,C,r,t,u,D,E,v){e=e([u,v],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=g.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",
c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(a,e,l,h,k){try{var b,m,d=[],c=[],g=a.directions||[],p=a.routes?a.routes.features:[],x=a.stops?a.stops.features:[],q=a.barriers?a.barriers.features:[],r=a.polygonBarriers?a.polygonBarriers.features:[],t=a.polylineBarriers?a.polylineBarriers.features:[],w=a.messages,f=n.forEach,y=n.indexOf,z=!0,A=a.routes&&a.routes.spatialReference||a.stops&&a.stops.spatialReference||
a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||a.polylineBarriers&&a.polylineBarriers.spatialReference;this._chk=a.checksum;f(g,function(a){d.push(b=a.routeName);c[b]={directions:a}});f(p,function(a){-1===y(d,b=a.attributes.Name)&&(d.push(b),c[b]={});c[b].route=a});f(x,function(a){m=a.attributes;-1===y(d,b=m.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(d.push(b),c[b]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==b&&(z=!1);void 0===c[b].stops&&
(c[b].stops=[]);c[b].stops.push(a)});0<x.length&&!0===z&&(c[d[0]].stops=c["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete c["esri.tasks.RouteTask.NULL_ROUTE_NAME"],d.splice(n.indexOf(d,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var B=[];f(d,function(a){c[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;c[a].spatialReference=A;B.push(new D(c[a]))});a=function(a){return f(a,function(b,c){b.geometry&&(b.geometry.spatialReference=A);a[c]=new C(b)}),a};f(w,function(a,b){w[b]=new E(a)});
var u={routeResults:B,barriers:a(q),polygonBarriers:a(r),polylineBarriers:a(t),messages:w};this._successHandler([u],"onSolveComplete",l,k)}catch(v){this._errorHandler(v,h,k)}},solve:function(a,e,l,h){var k=h.assembly;a=this._encode(g.mixin({},this._url.query,{f:"json"},a.toJson(k&&k[0]),this._chk?{checksum:this._chk}:{}));var b=this._handler,m=this._errorHandler;return r({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,c){b(a,c,e,l,h.dfd)},error:function(a){m(a,l,h.dfd)}})},
onSolveComplete:function(){}});return t._createWrappers(e),p("extend-esri")&&g.setObject("tasks.RouteTask",e,q),e});