//>>built
define("esri/tasks/datareviewer/_DRSBaseTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../../request ../../urlUtils ../../kernel ../Task ./ReviewerSession".split(" "),function(k,h,n,l,t,m,p,u,v,q){k=k(v,{declaredClass:"esri.tasks.datareviewer.DRSBaseTask",_url:null,_queryParams:null,_reviewerMapServerUrl:null,constructor:function(a){"/"==a[a.length-1]&&(a=a.slice(0,-1));a=p.urlToObject(a);this._url=a.path;this._queryParams=a.query;a=this._url.toLowerCase().lastIndexOf("/exts/");
0<a&&(this._reviewerMapServerUrl=this._url.substring(0,a));this._successHandler=h.hitch(this,this._successHandler);this._errorHandler=h.hitch(this,this._errorHandler);this._appendQueryParams=h.hitch(this,this._appendQueryParams);this.onError=h.hitch(this,this.onError)},_appendQueryParams:function(a){if(this._queryParams)for(var b in this._queryParams){var g=p.urlToObject(a);a+=g.query?"\x26"+b+"\x3d"+this._queryParams[b]:"?"+b+"\x3d"+this._queryParams[b]}return a},_successHandler:function(a,b,g){b&&
this[b].apply(this,[a]);g&&g.resolve(a)},_errorHandler:function(a,b){null===a&&(a=Error("Unexpected response received from server"),a.code=500);this.onError(a);b&&b.reject(a)},getReviewerMapServerUrl:function(){var a=null;if(a=this._reviewerMapServerUrl){if(this._queryParams)for(var b in this._queryParams)var g=p.urlToObject(a),a=a+(g.query?"\x26"+b+"\x3d"+this._queryParams[b]:"?"+b+"\x3d"+this._queryParams[b]);return a}return null},getLifecycleStatusStrings:function(){var a=this._successHandler,
b=this._errorHandler,g=this._appendQueryParams,f=this._url+"/Utilities/getLifecycleStatusStrings",f=g(f),d=new l;return m({callbackParamName:"callback",url:f,content:{f:"json"}}).then(h.hitch(this,function(e){if(void 0!==e.error){var c=Error();return c.message=e.error.message,c.code=e.error.code,void b(c,d)}try{if(c=e.lifecycleStatusString,void 0===c)b(null,d);else{var r=[];n.forEach(c,function(a){r[a.descriptionCode]=a.descriptionString});a({lifecycleStatusStrings:r},"onGetLifecycleStatusStringsComplete",
d)}}catch(w){b(w,d)}}),function(a){b(a,d)}),d},createReviewerSession:function(a,b){var g=this._successHandler,f=this._errorHandler,d=this._appendQueryParams,e=this._url+"/Utilities/createReviewerSession",e=d(e),c=new l;return m({callbackParamName:"callback",url:e,content:{sessionName:a,sessionProperties:b.toJsonSessionOptions(),f:"json"}}).then(h.hitch(this,function(a){if(void 0!==a.error){var b=Error();return b.message=a.error.message,b.code=a.error.code,void f(b,c)}try{if(void 0===a.sessionAttributes)f(null,
c);else{var b=a.sessionAttributes,e=new q(b.sessionId,b.sessionName,b.userName,b.versionName);g({reviewerSession:e},"onCreateReviewerSessionComplete",c)}}catch(d){f(d,c)}}),function(a){f(a,c)}),c},getReviewerSessions:function(){var a=this._successHandler,b=this._errorHandler,g=this._appendQueryParams,f=this._url+"/Utilities/getReviewerSessions",f=g(f),d=new l;return m({callbackParamName:"callback",url:f,content:{f:"json"}}).then(h.hitch(this,function(e){if(void 0!==e.error){var c=Error();return c.message=
e.error.message,c.code=e.error.code,void b(c,d)}try{if(c=e.sessionAttributes,void 0===c)b(null,d);else{var g=[];n.forEach(c,function(a,b){g[b]=new q(a.sessionId,a.sessionName,a.userName,a.versionName)});a({reviewerSessions:g},"onGetReviewerSessionsComplete",d)}}catch(f){b(f,d)}}),function(a){b(a,d)}),d},getCustomFieldNames:function(){var a=this._successHandler,b=this._errorHandler,g="BATCHJOBCHECKGROUP CHECKTITLE FEATUREOBJECTCLASS LIFECYCLEPHASE LIFECYCLESTATUS SESSIONID SEVERITY SUBTYPE".split(" "),
f=this._appendQueryParams,d=this._url+"/Dashboard",d=f(d),e=new l;return m({callbackParamName:"callback",url:d,content:{f:"json"}}).then(h.hitch(this,function(c){if(void 0!==c.error){var d=Error();return d.message=c.error.message,d.code=c.error.code,void b(d,e)}try{var f=[];void 0===c.reviewerResultsBy&&b(null,e);n.forEach(c.reviewerResultsBy,function(a){-1===g.indexOf(a.name)&&f.push(a.name)});a({customFieldNames:f},"onGetCustomFieldNamesComplete",e)}catch(h){b(h,e)}}),function(a){b(a,e)}),e},onGetLifecycleStatusStringsComplete:function(){},
onGetReviewerSessionsComplete:function(){},onCreateReviewerSessionComplete:function(){},onGetCustomFieldNamesComplete:function(){},onError:function(){}});return t("extend-esri")&&h.setObject("tasks.datareviewer.DRSBaseTask",k,u),k});