//>>built
define("esri/_coremap","require module dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/_base/event dojo/_base/unload dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/sniff dijit/registry dojox/gfx/matrix ./kernel ./config ./basemaps ./lang ./Evented ./fx ./deferredUtils ./tileUtils ./urlUtils ./PluginTarget ./geometry/Point ./geometry/ScreenPoint ./geometry/Extent ./geometry/Rect ./geometry/mathUtils ./geometry/scaleUtils ./geometry/screenUtils ./geometry/webMercatorUtils ./layers/GraphicsLayer ./layers/TileInfo ./layers/LOD ./layers/ArcGISTiledMapServiceLayer ./layers/MapImageLayer ./layers/OpenStreetMapLayer ./layers/VectorTileLayer ./dijit/Popup ./plugins/popupManager dojo/uacss".split(" "),
function(K,la,ma,V,z,da,F,q,Ia,na,oa,pa,Z,I,W,S,O,qa,ra,sa,ta,G,y,ua,ea,va,fa,wa,xa,Q,E,A,R,ya,B,ga,aa,v,za,Aa,Ba,Ca,ha,Da,Ea){function ia(a,b){var c=a.lods;c.sort(function(a,b){return a.scale>b.scale?-1:a.scale<b.scale?1:0});var d=[],c=q.filter(c,function(a){return-1===L(d,a.scale)?(d.push(a.scale),!0):void 0}),e,f=b.lods=[];q.forEach(c,function(a,b){e=f[b]=new Aa(a);e.level=b});b.tileInfo=new za(T(a,{lods:f}))}var ba,U=ga.toMapPoint,ca=ga.toScreenPoint,X=z.connect,M=z.disconnect,w=F.hitch,N=S.set,
L=q.indexOf,T=F.mixin,Y=0,J=ta.defaults.map,ja=J.layerNamePrefix,ka=J.graphicsLayerNamePrefix,Fa=new RegExp("^"+ja+"(\\d+)$"),Ga=new RegExp("^"+ka+"(\\d+)$"),Ha=function(){};V=V([ua,xa],{declaredClass:"esri._CoreMap",resizeDelay:300,invalidExtent:"Map does not have a valid extent.",invalidGeometry:"Geometry (wkid: ${geometry}) cannot be converted to spatial reference of the map (wkid: ${map})",unknownBasemap:'Unable to find basemap definition for: "${basemapName}". Try one of these: ${list}',invalidBasemap:'Unable to add basemap: "${basemapName}".',
unknownLayerType:'Unknown basemap layer type: "${type}" found in basemap definition for: "${basemapName}".',visible:!0,_eventMap:{"basemap-change":!0,"extent-change":["extent","delta","levelChange","lod"],"layer-add":["layer"],"layer-add-result":["layer","error"],"layer-remove":["layer"],"layer-reorder":["layer","index"],"layer-resume":["layer"],"layer-suspend":["layer"],"layers-add-result":["layers"],"layers-removed":!0,"layers-reordered":["layerIds"],load:["map"],pan:["extent","delta"],"pan-end":["extent",
"delta"],"pan-start":["extent","screenPoint"],reposition:["x","y"],resize:["extent","width","height"],scale:["matrix","immediate"],"time-extent-change":["timeExtent"],"before-unload":["map"],unload:["map"],"update-end":["error"],"update-start":!0,zoom:["extent","zoomFactor","anchor"],"zoom-end":["extent","zoomFactor","anchor","level"],"zoom-start":["extent","zoomFactor","anchor","level"],click:!0,"dbl-click":!0,"key-down":!0,"key-up":!0,"mouse-down":!0,"mouse-drag":!0,"mouse-drag-end":!0,"mouse-drag-start":!0,
"mouse-move":!0,"mouse-out":!0,"mouse-over":!0,"mouse-up":!0,"mouse-wheel":!0,"basic-tap":!0,"double-tap":!0,"pinch-end":!0,"pinch-move":!0,"pinch-start":!0,"processed-double-tap":!0,"processed-tap":!0,"swipe-end":!0,"swipe-move":!0,"swipe-start":!0,tap:!0,"two-finger-tap":!0},constructor:function(a,b){var c=this;this.registerConnectEvents();T(this,{_internalLayerIds:[],_layers:[],_layerDivs:[],_layerSize:0,_connects:[],_zoomAnimDiv:null,_zoomAnim:null,_layersDiv:null,_firstLayerId:null,_delta:null,
_cursor:null,_ratioW:1,_ratioH:1,_params:null,cursor:null,layerIds:[],graphicsLayerIds:[],graphics:null,_labels:null,loaded:!1,__panning:!1,__zooming:!1,__container:null,root:null,__LOD:null,__tileInfo:null,__visibleRect:null,__visibleDelta:null,_rids:[]});var d=this.container=oa.byId(a),e=this.id=pa.get(d,"id")||qa.getUniqueId(this.declaredClass);Z.add(d,"map");var f=W.getContentBox(d),g=Z.add,k=I.create;this.position=new E(0,0);this._reposition();var h=this.width=0<f.w?f.w:J.width,p=this.height=
0<f.h?f.h:J.height,l=this.root=k("div",{id:e+"_root",style:{width:h+"px",height:p+"px",direction:"ltr"}});g(l,"esriMapContainer");f=this.__container=k("div",{id:e+"_container"},l);N(f,"position","absolute");g(f,"esriMapContainer");d.appendChild(l);d=this._params=T({slider:!0,nav:!1,zoom:-1,minZoom:-1,maxZoom:-1,scale:-1,minScale:0,maxScale:0,showInfoWindowOnClick:!0,displayGraphicsOnPan:!0,wrapAround180:!0,fitExtent:!1,optimizePanAnimation:!0},b||{});this.wrapAround180=d.wrapAround180;this.optimizePanAnimation=
d.optimizePanAnimation;y.isDefined(d.resizeDelay)&&(this.resizeDelay=d.resizeDelay);d.lods&&(ia({rows:512,cols:512,dpi:96,format:"JPEG",compressionQuality:75,origin:{x:-180,y:90},spatialReference:{wkid:4326},lods:d.lods},d),this.__tileInfo=d.tileInfo);this.extent=d.extent;this._extentUtil({mapCenter:d.center,targetLevel:d.zoom,targetScale:d.scale});this.__visibleRect=new R(0,0,h,p);this.__visibleDelta=new R(0,0,h,p);e=this._layersDiv=k("div",{id:e+"_layers"});(g(e,"esriMapLayers"),f.appendChild(e),
this._zoomAnimDiv=k("div",{style:{position:"absolute"}}),d.infoWindow)?this.infoWindow=d.infoWindow:(g=this.infoWindow=new Ea(d.popupOptions,k("div")),g.startup(),g._ootb=!0,N(g.domNode,"zIndex",40));d.showLabels&&(K(["./layers/LabelLayer"],function(a){ba=a;c._createLabelLayer()}),this.on("load",function(){c._createLabelLayer()}));this.addPlugin(this._getAbsMid("./plugins/popupManager"),{enabled:d.showInfoWindowOnClick});this._zoomStartHandler=w(this,this._zoomStartHandler);this._zoomingHandler=w(this,
this._zoomingHandler);this._zoomEndHandler=w(this,this._zoomEndHandler);this._panningHandler=w(this,this._panningHandler);this._panEndHandler=w(this,this._panEndHandler);this._endTranslate=w(this,this._endTranslate);this._timedResize=w(this,this._timedResize);this._execResize=w(this,this._execResize);this.resize=w(this,this.resize);na.addOnWindowUnload(this,this.destroy)},_getAbsMid:function(a){return K.toAbsMid?K.toAbsMid(a):la.id.replace(/\/[^\/]*$/gi,"/")+a},_cleanUp:function(){var a=this.infoWindow;
a&&(a._ootb&&a.destroy?a.destroy():a.unsetMap(this),delete this.infoWindow);M(this._tsTimeExtentChange_connect);this.removePlugin("./plugins/popupManager");I.destroy(this.root);this.root=null},_addLayer:function(a,b,c){if(a.id){var d=a.id.match(a instanceof v?Ga:Fa);d&&d[1]&&(d=Number(d[1]),d>=Y&&(Y=d+1))}var e=a.id||(a instanceof v?ka:ja)+Y++;a.id=e;this._layers[e]=a;var f,g;if((b===this.layerIds||b===this.graphicsLayerIds)&&(f=this._layerSize,this._layerSize++),a._isRefLayer="top"===c,c=!y.isDefined(c)||
0>c||c>b.length||"top"===c?b.length:c,0===f&&(this._firstLayerId=e),!a._isRefLayer)for(;(g=this.getLayer(b[c-1]))&&g._isRefLayer;)c--;b.splice(c,0,e);var k=w(this,this._addLayerHandler),h=this;c=this._connects;d=function(){a.loaded?h._onLoadFix?(h._onLoadFix=!1,setTimeout(function(){k(a)},0)):k(a):(h["_"+e+"_addtoken_load"]=X(a,"onLoad",h,"_addLayerHandler"),h["_"+e+"_addtoken_err"]=X(a,"onError",h,function(c){k(a,c,b)}))};return this.loaded||0===f||a.loaded&&-1===L(this.graphicsLayerIds,e)?d():c.push(X(this,
"onLoad",d)),a},_addLayerHandler:function(a,b,c){var d,e,f,g,k=this.id,h=a.id,p=L(a instanceof v?this.graphicsLayerIds:this.layerIds,h),l=p,C=!1,m=this._params;if(M(this["_"+h+"_addtoken_load"]),M(this["_"+h+"_addtoken_err"]),b)return delete this._layers[h],void(-1!==p&&(c.splice(p,1),this.onLayerAddResult(a,b)));if(-1===p&&(p=L(this._internalLayerIds,h),l=20+p,C=!0),h===this._firstLayerId){if(e=a.spatialReference,f=this.extent&&this.extent.spatialReference,!f||f.equals(e)||!a.tileInfo&&a.url||(f=
null),d=this.spatialReference=f||e,this.wrapAround180=this.wrapAround180&&d&&d._isWrappable()?!0:!1,a.tileInfo&&(this.__tileInfo?(g=this.__tileInfo.lods,this.__tileInfo=T({},a.tileInfo),this.__tileInfo.lods=g):(ia(T({},a.tileInfo),m),this.__tileInfo=m.tileInfo)),this.wrapAround180)b=this.__tileInfo,d=d._getInfo(),(!b||Math.abs(d.origin[0]-b.origin.x)>d.dx)&&(this.wrapAround180=!1),this.wrapAround180&&b&&fa._addFrameInfo(b,d);if(m.units=a.units,g=this.__tileInfo&&this.__tileInfo.lods,g&&g.length){b=
m.minScale;c=m.maxScale;f=e=-1;var u=p=!1;for(d=0;d<g.length;d++)0<b&&!p&&b>=g[d].scale&&(e=g[d].level,p=!0),0<c&&!u&&c>=g[d].scale&&(f=0<d?g[d-1].level:-1,u=!0);-1===m.minZoom&&(m.minZoom=0===b?g[0].level:e);-1===m.maxZoom&&(m.maxZoom=0===c?g[g.length-1].level:f);for(d=0;d<g.length;d++)m.minZoom===g[d].level&&(m.minScale=g[d].scale),m.maxZoom===g[d].level&&(m.maxScale=g[d].scale)}else m.minZoom=m.maxZoom=m.zoom=-1}a instanceof v?(this._gc||(this._gc=new v._GraphicsContainer,this._gc._setMap(this,
this._layersDiv).id=k+"_gc"),g=a._setMap(this,this._gc._surface),g.id=k+"_"+h,this._layerDivs[h]=g,this._reorderLayers(this.graphicsLayerIds)):(g=a._setMap(this,this._layersDiv,l,this.__LOD),g.id=k+"_"+h,this._layerDivs[h]=g,this._reorderLayers(this.layerIds),C||-1===a.declaredClass.indexOf("VETiledLayer")||this._onBingLayerAdd(a));if(h===this._firstLayerId&&(this.graphics=new v({id:k+"_graphics",displayOnPan:m.displayGraphicsOnPan}),this._addLayer(this.graphics,this._internalLayerIds,20)),a===this.graphics){var t;
d=this._layers[this._firstLayerId];k=m.zoom;g=m.scale;l=m.center;d=d.initialExtent||d.fullExtent;if(this._firstLayerId=null,this.extent&&(this.extent=this._convertGeometry(this,this.extent)),!this.extent&&d&&(l&&(l=this._convertGeometry(d,l)),l&&(d=d.centerAt(l))),t=this.extent||d&&new A(d.toJson()),t&&(-1<k?t=this.__getExtentForLevel(k,null,t).extent:0<g&&(t=B.getExtentForScale(this,g,t))),!t)return void console.log("Map: "+this.invalidExtent);m=this._fixExtent(t,m.fitExtent);this.extent=m.extent;
this.__LOD=m.lod;this.__setExtent(this.extent);this.loaded=!0;this.attr("data-loaded","");this.infoWindow.setMap(this);this.onLoad(this)}C||(this.onLayerAdd(a),this.onLayerAddResult(a));M(this[h+"_addLayerHandler_connect"])},_convertGeometry:function(a,b){var c=a&&a.spatialReference,d=b&&b.spatialReference;return c&&d&&!c.equals(d)&&(c._canProject(d)?c.isWebMercator()?b=aa.geographicToWebMercator(b):4326===c.wkid&&(b=aa.webMercatorToGeographic(b,!0)):(console.log("Map: "+y.substitute({geometry:d.wkid||
d.wkt,map:c.wkid||c.wkt},this.invalidGeometry)),b=null)),b},_reorderLayers:function(a){var b=this.onLayerReorder,c=I.place,d=this._layerDivs,e=this._layers,f=this._gc?this._gc._surface.getEventSource():null;if(a===this.graphicsLayerIds)q.forEach(a,function(a,g){var h=d[a];h&&(c(h.getEventSource(),f,g),b(e[a],g))});else{var g,k=this.graphics,h=k?k.id:null,p=this._layersDiv;q.forEach(a,function(a,f){g=d[a];a!==h&&g&&(c(g,p,f),b(e[a],f))});this._mapImageLyr&&this._placeMapImageLyr();f&&(f=9>O("ie")?
f.parentNode:f,c(f,f.parentNode,a.length))}this.onLayersReordered([].concat(a))},_zoomStartHandler:function(){this.__zoomStart(this._zoomAnimDiv.startingExtent,this._zoomAnimDiv.anchor)},_zoomingHandler:function(a){var b=parseFloat(a.left),c=parseFloat(a.top);a=new A(b,c-parseFloat(a.height),b+parseFloat(a.width),c,this.spatialReference);b=this.extent.getWidth()/a.getWidth();this.__zoom(a,b,this._zoomAnimDiv.anchor)},_zoomEndHandler:function(){var a=this._zoomAnimDiv,b=a.extent,c=this.extent.getWidth()/
b.getWidth(),d=a.anchor,e=a.newLod,f=a.levelChange;a.extent=a.anchor=a.levelChange=a.startingExtent=a.newLod=this._delta=this._zoomAnim=null;this.__zoomEnd(b,c,d,e,f)},_panningHandler:function(a){if(isNaN(parseFloat(a.left))||isNaN(parseFloat(a.top))){var b=Math.round,c=this._panAnim.node;a.left=-1*(this._delta.x-b(this.width/2))+"px";a.top=-1*(this._delta.y-b(this.height/2))+"px";S.set(c,"left",a.left);S.set(c,"top",a.top)}a=new E(parseFloat(a.left),parseFloat(a.top));b=this.toMap(a);this.onPan(this.extent.offset(this.extent.xmin-
b.x,this.extent.ymax-b.y),a)},_panEndHandler:function(a){this.__panning=!1;var b=Math.round;a=new E(-b(parseFloat(a.style.left)),-b(parseFloat(a.style.top)));var b=a.x,c=a.y,d=this.__visibleRect,e=this.__visibleDelta;d.x+=-b;d.y+=-c;e.x+=-b;e.y+=-c;N(this._zoomAnimDiv,{left:"0px",top:"0px"});var d=this.extent,e=this._ratioW,f=this._ratioH,d=new A(d.xmin+b/e,d.ymin-c/f,d.xmax+b/e,d.ymax-c/f,this.spatialReference);a.setX(-a.x);a.setY(-a.y);this._delta=this._panAnim=null;this._updateExtent(d);this.onPanEnd(d,
a);this._fireExtChg([d,a,!1,this.__LOD])},_fixExtent:function(a,b){for(var c=this._reshapeExtent(a),d=1.25;!0===b&&(c.extent.getWidth()<a.getWidth()||c.extent.getHeight()<a.getHeight())&&0<c.lod.level&&3>=d;)c=this._reshapeExtent(a.expand(d)),d+=.25;return c},_getFrameWidth:function(){var a=-1,b=this.spatialReference._getInfo();this.__LOD?(b=this.__LOD._frameInfo)&&(a=b[3]):b&&(a=Math.round(2*b.valid[1]/(this.extent.getWidth()/this.width)));return a},_fixAspectRatio:function(a){var b=a.getWidth(),
c=a.getHeight(),d=b/c,e=this.width/this.height,f=0,g=0;return this.width>this.height?b>c?e>d?f=c*e-b:g=b/e-c:f=c*e-b:this.width<this.height?c>b&&e>d?f=c*e-b:g=b/e-c:c>b?f=c-b:b>c&&(g=b/e-c),f&&(a.xmin-=f/2,a.xmax+=f/2),g&&(a.ymin-=g/2,a.ymax+=g/2),a},_reshapeExtent:function(a){return a=this._fixAspectRatio(a),this._getAdjustedExtent(a)},_getAdjustedExtent:function(a){if(this.__tileInfo)return fa.getCandidateTileInfo(this,this.__tileInfo,a);var b=B.getScale(this,a),c=this.getMinScale(),d=this.getMaxScale();
return!c||c>=b?!d||b>=d||(a=B.getExtentForScale(this,d,a)):a=B.getExtentForScale(this,c,a),{extent:a}},_onBingLayerAdd:function(a){this["__"+a.id+"_vis_connect"]=z.connect(a,"onVisibilityChange",this,"_toggleBingLogo");this._toggleBingLogo(a.visible)},_onBingLayerRemove:function(a){z.disconnect(this["__"+a.id+"_vis_connect"]);delete this["__"+a.id+"_vis_connect"];var b=q.some(this.layerIds,function(b){return a=this._layers[b],a&&a.visible&&-1!==a.declaredClass.indexOf("VETiledLayer")},this);this._toggleBingLogo(b)},
_toggleBingLogo:function(a){a&&!this._bingLogo?(a={left:this._mapParams&&this._mapParams.nav?"25px":""},6===O("ie")&&(a.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+K.toUrl("./images/map/bing-logo-lg.png")+"')"),a=this._bingLogo=I.create("div",{style:a},this.root),Z.add(a,"bingLogo-lg")):!a&&this._bingLogo&&(I.destroy(this._bingLogo),delete this._bingLogo)},__panStart:function(a,b){var c=this._zoomAnim,d=this._panAnim;if(c&&c._active)c.stop(),
c._fire("onEnd",[c.node]);else if(d&&d._active){d.stop();this._panAnim=null;var d=d.curve.getValue(d._getStep()),c=Math.round(parseFloat(d.left)),d=Math.round(parseFloat(d.top)),e=this.navigationManager._dragOrigin;return this.__pan(c,d),void(e&&(e.x-=c,e.y-=d))}this.__panning=!0;this.onPanStart(this.extent,new E(a,b))},__pan:function(a,b){var c=this.extent,d=this._ratioW,e=this._ratioH;this.onPan(new A(c.xmin-a/d,c.ymin+b/e,c.xmax-a/d,c.ymax+b/e,this.spatialReference),new E(a,b))},__panEnd:function(a,
b){var c=this.__visibleRect,d=this.__visibleDelta;c.x+=a;c.y+=b;d.x+=a;d.y+=b;var c=new E(a,b),d=this.extent,e=this._ratioW,f=this._ratioH,d=new A(d.xmin-a/e,d.ymin+b/f,d.xmax-a/e,d.ymax+b/f,this.spatialReference);this.__panning=!1;this._updateExtent(d);this.onPanEnd(d,c);this._fireExtChg([d,c,!1,this.__LOD])},__zoomStart:function(a,b){this.__zooming=!0;this.onZoomStart(a,1,b,this.__LOD?this.__LOD.level:null)},__zoom:function(a,b,c){this.onZoom(a,b,c)},__zoomEnd:function(a,b,c,d,e){N(this._layersDiv,
{left:"0px",top:"0px"});this._delta=new E(0,0);this.__visibleRect.x=this.__visibleRect.y=0;a=new A(a);this.__LOD=d;this._ratioW=this.width/a.getWidth();this._ratioH=this.height/a.getHeight();var f=this._delta;this._delta=null;this.__zooming=!1;this._updateExtent(a,e);this.onZoomEnd(a,b,c,d?d.level:null);this._fireExtChg([a,f,e,d])},_extentUtil:function(a,b,c,d,e){var f,g,k,h,p,l,C,m,u,t,q,w,x,P=new da,n=this.width,r=this.height;a&&(f=a.numLevels,g=a.targetLevel,q=y.isDefined(g),k=a.factor,h=a.mapAnchor,
p=a.screenAnchor,l=a.mapCenter,w=a.levelOrFactor,C=a.targetScale,m=y.isDefined(C)&&0<C);b&&(u=b.dx,t=b.dy,l=b.mapCenter);F.isArray(l)&&(l=new Q(l));var z=this._panAnim;b=(a=this._stopAnim())?a.divExtent:this.extent;var v=this.__tileInfo,H=this._params;if(!this.loaded)return c?(b&&(c=this._convertGeometry(b,c)),c&&(this.extent=c,H.zoom=H.scale=-1,H.center=null)):(l||q||m)&&(l&&(b?(l=this._convertGeometry(b,l),l&&(this.extent=b.centerAt(l),H.center=null)):H.center=l),q&&-1<g?(H.zoom=g,H.scale=-1):m&&
(H.scale=C,H.zoom=-1)),P.resolve(),P;if(l&&(l=this._convertGeometry(this,l),!l)||h&&(h=this._convertGeometry(this,h),!h)||c&&(c=this._convertGeometry(this,c),!c))return P.reject(),P;if(z&&h&&p&&(h=U(this.extent,n,r,p)),a&&h&&p&&(h=U(a.divExtent,n,r,p)),q)v?(f=this.getMinZoom(),q=this.getMaxZoom(),f>g?g=f:g>q&&(g=q),f=g-(a?a.level:this.getLevel())):(f=0<g?-1:1,x=w?g:null);if(!c)if(y.isDefined(f))v?(n=a?a.level:this.getLevel(),r=this.__getExtentForLevel(n+f,l,b).extent):(r=(a?a.end:this.extent).expand(x||
(0<f?.5*f:2*-f)),x&&l&&(r=r.centerAt(l))),r&&(l?c=r:(n=h||b.getCenter(),u=b.ymax-(r.getHeight()-b.getHeight())*(n.y-b.ymax)/b.getHeight(),n=b.xmin-(r.getWidth()-b.getWidth())*(n.x-b.xmin)/b.getWidth(),c=new A(n,u-r.getHeight(),n+r.getWidth(),u,this.spatialReference)));else if(m)c=B.getExtentForScale(this,C,b);else if(y.isDefined(k))c=b.expand(k);else if(u||t)a?(c=a.end,h=c.getCenter(),x=ca(c,n,r,h),x.x+=u,x.y+=t,x=U(c,n,r,x),c=c.offset(x.x-h.x,x.y-h.y)):(u=new E(n/2+u,r/2+t),t=U(b,n,r,u),r=b.getWidth(),
u=b.getHeight(),n=t.x-r/2,t=t.y-u/2,c=new A(n,t,n+r,t+u,this.spatialReference));c||(l?(b=a?a.end:b,r=b.getWidth(),u=b.getHeight(),n=l.x-r/2,t=l.y-u/2,c=new A(n,t,n+r,t+u,this.spatialReference)):a&&(c=a.end));return c?(this._extentDfd&&-1===this._extentDfd.fired&&(this._extentDfd.then(null,Ha),this._extentDfd.reject()),this._extentDfd=P,this.__setExtent(c,null,p,d,a,e)):P.reject(),P},__setExtent:function(a,b,c,d,e,f){try{if(this._firstLayerId)return void(this.extent=a);var g=!0,k=this.spatialReference,
h=e?e.divExtent:this.extent,p=this._fixExtent(a,d||!1);a=p.extent;var l=a.getWidth(),C=a.getHeight(),m=Math.round;if(h)var q=m(1E6*h.getWidth()),t=m(1E6*l),w=m(1E6*h.getHeight()),y=m(1E6*C),g=q!==t||w!==y;var x,v,n=e&&e.rect,r=e&&e.divExtent;if(J.zoomDuration&&g&&h){r=r||new A(h);n=n||{left:h.xmin,top:h.ymax,width:h.getWidth(),height:h.getHeight()};v={left:a.xmin,top:a.ymax,width:l,height:C};var z=new Q(a.xmin,a.ymax,k),G=new Q(a.xmin,a.ymin,k),H=new Q(this.extent.xmin,this.extent.ymax,k),I=new Q(this.extent.xmin,
this.extent.ymin,k);(x=ya.getLineIntersection(H,z,I,G,k))||e||(g=!1)}this._ratioW=this.width/l;this._ratioH=this.height/C;var D=this._zoomAnimDiv;if(g)if(N(this._layersDiv,{left:"0px",top:"0px"}),b=new E(0,0),this.__visibleRect.x=this.__visibleRect.y=0,n&&v){this._delta=b;D.id="_zAD";D.startingExtent=r;D.extent=a;D.levelChange=g;D.newLod=p.lod;D.anchor=c?c:!x&&e?e.anchor:ca(this.extent,this.width,this.height,x);var B=this.extent.getWidth()/a.getWidth();b=1024<(1>B?1/B:B);O("chrome")&&b?(this.__zoomStart(r,
D.anchor),this.__zoom(r,1,D.anchor),this._fireOnScale(1,D.anchor,!0),this.__zoomEnd(a,B,D.anchor,p.lod,g)):(this._zoomAnim=ea.resize({node:D,start:n,end:v,duration:J.zoomDuration,rate:J.zoomRate,beforeBegin:e?null:this._zoomStartHandler,onAnimate:this._zoomingHandler,onEnd:this._zoomEndHandler}).play(),this._fireOnScale(B,D.anchor,f))}else this._updateExtent(a,g),this._fireExtChg([this.extent,b,g,this.__LOD=p.lod]);else if(!this.__panning)if(!1===this.loaded||f)this._updateExtent(a,g),this._fireExtChg([this.extent,
b,g,this.__LOD=p.lod]);else{this.__panning=!0;n=(new R(0,0,this.width,this.height,this.spatialReference)).getCenter();n.x=m(n.x);n.y=m(n.y);var F=this._delta=this.toScreen(a.getCenter()),L=Math.abs(n.x-F.x),M=Math.abs(n.y-F.y);this.optimizePanAnimation&&(L>2*this.width||M>2*this.height)?(this.__panStart(0,0),this.__pan(0,0),this.__visibleRect.x=this.__visibleRect.y=this.__visibleDelta.x=this.__visibleDelta.y=0,this.__panning=!1,this._delta=null,this._updateExtent(a,!1),this.onPanEnd(this.extent,new E(0,
0)),this._fireExtChg([this.extent,new E(0,0),!0,this.__LOD])):(this.onPanStart(this.extent,new E(0,0)),this._panAnim=ea.slideTo({node:D,left:n.x-F.x,top:n.y-F.y,duration:J.panDuration,rate:J.panRate,onAnimate:this._panningHandler,onEnd:this._panEndHandler}),this._panAnim.play())}}catch(K){console.log(K.stack),console.error(K)}},_fireOnScale:function(a,b,c){if("css-transforms"===this.navigationMode){var d=this.__visibleDelta;this.onScale(ra.scaleAt(a,{x:-1*(this.width/2-(b.x-d.x)),y:-1*(this.height/
2-(b.y-d.y))}),c)}},_stopAnim:function(){var a=this._zoomAnim,b=this._panAnim;if(a&&a._active){a.stop();var b=a.curve.getValue(a._getStep()),c=parseFloat(b.left),d=parseFloat(b.top),a=a.node;return{anchor:a.anchor,start:a.startingExtent,end:a.extent,level:a.newLod&&a.newLod.level,rect:b,divExtent:new A(c,d-parseFloat(b.height),c+parseFloat(b.width),d,this.spatialReference)}}b&&b._active&&(b.stop(),b._fire("onEnd",[b.node]))},__getExtentForLevel:function(a,b,c){var d=this.__tileInfo,d=d&&d.lods;if(a=
y.isDefined(a)?a:0,c=c||this.extent,b=b||c&&c.getCenter(),d){if(!b)return void console.log("Map: "+this.invalidExtent);c=this.getMinZoom();var e=this.getMaxZoom();a>e&&(a=e);c>a&&(a=c);a=d[a];d=this.width*a.resolution/2;c=this.height*a.resolution/2;return{extent:new A(b.x-d,b.y-c,b.x+d,b.y+c,b.spatialReference),lod:a}}return c?(a=!a||1>a?1:a,{extent:c.expand(a).centerAt(b)}):void console.log("Map: "+this.invalidExtent)},_jobs:0,_incr:function(){1===++this._jobs&&(this.updating=!0,this.attr("data-updating",
""),this.onUpdateStart())},_decr:function(){var a=--this._jobs;a?0>a&&(this._jobs=0):(this.updating=!1,this.attr("data-updating"),this.onUpdateEnd())},_fireEvent:function(a,b){this[a]&&this[a].apply(this,b)},_updateExtent:function(a,b){this.extent=a;b&&this._setClipRect();var c=this.spatialReference;c&&(c.isWebMercator()?this.geographicExtent=aa.webMercatorToGeographic(this._getAvailExtent(),!0):4326===c.wkid&&(this.geographicExtent=new A(this._getAvailExtent().toJson())))},_fireExtChg:function(a){this.attr("data-zoom",
this.getZoom());this.attr("data-scale",this.getScale());this._fireEvent("onExtentChange",a);(a=this._extentDfd)&&(delete this._extentDfd,a.resolve())},attr:function(a,b){var c=this.container;return c&&(null==b?c.removeAttribute(a):c.setAttribute(a,b)),this},onUpdateStart:function(){},onUpdateEnd:function(){},onLoad:function(){this._setClipRect()},onBeforeUnload:function(){},onUnload:function(){},onExtentChange:function(){},onTimeExtentChange:function(){},onLayerAdd:function(){},onLayerAddResult:function(){},
onLayersAddResult:function(){},onLayerRemove:function(){},onLayersRemoved:function(){},onLayerReorder:function(){},onLayersReordered:function(){},onLayerSuspend:function(){},onLayerResume:function(){},onPanStart:function(){},onPan:function(){},onPanEnd:function(){},onScale:function(){},onZoomStart:function(){},onZoom:function(){},onZoomEnd:function(){},onResize:function(){this._setClipRect()},onReposition:function(){},destroy:function(){this._destroyed||(this.onBeforeUnload(this),this.removeAllLayers(),
this._cleanUp(),clearTimeout(this._resizeT),this._gc&&this._gc._cleanUp(),this._destroyed=!0,this.onUnload(this))},setCursor:function(a){N(this.__container,"cursor",this.cursor=a)},setMapCursor:function(a){this.setCursor(this._cursor=a)},resetMapCursor:function(){this.setCursor(this._cursor)},setInfoWindow:function(a){var b=this.infoWindow;b&&b.unsetMap(this);this.infoWindow=a;this.loaded&&a&&a.setMap(this)},setInfoWindowOnClick:function(a){this._params.showInfoWindowOnClick=a;this.popupManager&&
this.popupManager.set("enabled",a)},getInfoWindowAnchor:function(a){return this.infoWindow&&this.infoWindow._getAnchor&&this.infoWindow._getAnchor(a)||"upperright"},toScreen:function(a,b){return ca(this.extent,this.width,this.height,a,b)},toMap:function(a){return U(this.extent,this.width,this.height,a)},addLayer:function(a,b){return a&&!this.getLayer(a.id)&&this._addLayer(a,a instanceof v?this.graphicsLayerIds:this.layerIds,b),a},addLayers:function(a){var b,c,d=[],e=a.length,f=a.length;b=z.connect(this,
"onLayerAddResult",function(c,f){-1!==q.indexOf(a,c)&&(e--,d.push({layer:c,success:!f,error:f}),e||(z.disconnect(b),this.onLayersAddResult(d)))});for(c=0;f>c;c++)this.addLayer(a[c]);return this},removeLayer:function(a,b){var c=a.id,d=a instanceof v?this.graphicsLayerIds:this.layerIds,e=L(d,c);0<=e&&(d.splice(e,1),a instanceof v?(M(this["_gl_"+a.id+"_click_connect"]),a.loaded&&a._unsetMap(this,this._gc._surface)):a.loaded&&(a._unsetMap(this,this._layersDiv),-1!==a.declaredClass.indexOf("VETiledLayer")&&
this._onBingLayerRemove(a)),delete this._layers[c],delete this._layerDivs[c],b||this._reorderLayers(d),this.onLayerRemove(a))},removeAllLayers:function(){var a,b=this.layerIds;for(a=b.length-1;0<=a;a--)this.removeLayer(this._layers[b[a]],1);b=this.graphicsLayerIds;for(a=b.length-1;0<=a;a--)this.removeLayer(this._layers[b[a]],1);this.onLayersRemoved()},reorderLayer:function(a,b){F.isString(a)&&(ma.deprecated(this.declaredClass+": Map.reorderLayer(/*String*/ id, /*Number*/ index) deprecated. Use Map.reorderLayer(/*Layer*/ layer, /*Number*/ index).",
null,"v2.0"),a=this.getLayer(a));var c,d=a.id,e=a instanceof v?this.graphicsLayerIds:this.layerIds;0>b?b=0:b>=e.length&&(b=e.length-1);c=L(e,d);-1!==c&&c!==b&&(e.splice(c,1),e.splice(b,0,d),this._reorderLayers(e))},getLayer:function(a){return this._layers[a]},setExtent:function(a,b){a=new A(a.toJson());var c=a.getWidth(),d=a.getHeight();return 0===c&&0===d?this.centerAt(new Q({x:a.xmin,y:a.ymin,spatialReference:a.spatialReference&&a.spatialReference.toJson()})):this._extentUtil(null,null,a,b)},centerAt:function(a){return this._extentUtil(null,
{mapCenter:a})},centerAndZoom:function(a,b){return this._extentUtil({targetLevel:b,mapCenter:a,levelOrFactor:!0})},getScale:function(){return this.__LOD?this.__LOD.scale:B.getScale(this)},getResolution:function(){return this.__LOD?this.__LOD.resolution:this.extent?this.extent.getWidth()/this.width:0},getResolutionInMeters:function(){return this.getResolution()*B.getUnitValueForSR(this.spatialReference)},getMinScale:function(){return this._params.minScale},getMaxScale:function(){return this._params.maxScale},
setScale:function(a){return this._extentUtil({targetScale:a})},getLayersVisibleAtScale:function(a){var b=[];return a=a||this.getScale(),a&&q.forEach(this.layerIds.concat(this.graphicsLayerIds),function(c){c=this.getLayer(c);c.isVisibleAtScale(a)&&b.push(c)},this),b},getNumLevels:function(){var a=this.getMinZoom(),b=this.getMaxZoom();return a===b&&0>a?0:b-a+1},getLevel:function(){return this.__LOD?this.__LOD.level:-1},setLevel:function(a){return-1<a?this._extentUtil({targetLevel:a}):void 0},getZoom:function(){return this.getLevel()},
setZoom:function(a){return this.setLevel(a)},getMinZoom:function(){return this._params.minZoom},getMaxZoom:function(){return this._params.maxZoom},setBasemap:function(a){var b;if(F.isObject(a)?(b=a,a=b.title):b=G&&G[a],b){this._basemapDfd&&-1===this._basemapDfd.fired&&this._basemapDfd.cancel();var c=[],d=[],e=0;if(q.forEach(b.baseMapLayers||b.layers,function(b){var f,g={id:b.id,displayLevels:b.displayLevels,opacity:y.isDefined(b.opacity)?b.opacity:null,visible:y.isDefined(b.visibility)?b.visibility:
null};if(b.type)switch(b.type){case "OpenStreetMap":f=new ha(g);break;case "VectorTile":f=wa._ensureProperProtocolForAGOResource(b.url);f=new Da(f,g);break;default:console.log("Map.setBasemap: "+y.substitute({basemapName:a,type:b.type},this.unknownLayerType))}else f=b.url,"https:"!==window.location.protocol||-1===f.search(/^http\:\/\/server\.arcgisonline\.com/i)&&-1===f.search(/^http\:\/\/services\.arcgisonline\.com/i)&&-1===f.search(/^http\:\/\/.+\.arcgis\.com/i)||(f=f.replace(/http:/i,"https:")),
f=new Ba(f,g);f&&(c.push(f),d.push(b),b.isReference||e++)},this),!c.length||!e)return void console.log("Map.setBasemap: "+y.substitute({basemapName:a},this.invalidBasemap));var f={basemapName:a,infos:d,layers:c};if(!this.loaded)return void this._basemapLoaded(f);var g=this,k=new da(va._dfdCanceller),h=function(){k._pendingLayers--;var a=q.indexOf(f.layers,this);-1<a&&(a=k._layerEvents[a])&&(z.disconnect(a[0]),z.disconnect(a[1]));0>=k._pendingLayers&&(delete k._layerEvents,delete g._basemapDfd,0>k.fired&&
k.callback(f))};this._basemapDfd=k;k._pendingLayers=0;k._layerEvents={};q.forEach(c,function(a,b){a&&(k._pendingLayers++,a.loaded?h(a):k._layerEvents[b]=[z.connect(a,"onLoad",a,h),z.connect(a,"onError",a,h)])});k.addCallback(w(this,this._basemapLoaded))}else{var p;b=[];for(p in G)b.push(p);console.log("Map.setBasemap: "+y.substitute({basemapName:a,list:b.join(",")},this.unknownBasemap))}},_basemapLoaded:function(a){var b,c=a.layers,d=a.infos,e=0,f=!0;this.loaded&&(q.forEach(c,function(a,b){a.loaded&&
(d[b].isReference||e++)}),f=e);f&&(this.basemapLayerIds&&(b={basemapName:this._basemap,infos:G&&G[this._basemap]&&G[this._basemap].baseMapLayers},b.basemapName||(q.forEach(this.basemapLayerIds,function(a){return this.getLayer(a)instanceof ha?(b.basemapName="osm",b.infos=G&&G.osm&&G.osm.baseMapLayers,!1):void 0},this),b.basemapName||(b=null))),this._removeBasemap(),this._basemap=a.basemapName,this.basemapLayerIds=this._addBasemap(c,d),this.attr("data-basemap",this.getBasemap()),this.emit("basemap-change",
{current:a,previous:b}))},_addBasemap:function(a,b){var c=[],d=[],e=0;return q.forEach(a,function(a,g){b[g].isReference?c.push(a):(this.addLayer(a,e++),d.push(a.id))},this),c.length&&q.forEach(c,function(a){a.attr("data-reference",!0);this.addLayer(a,"top");d.push(a.id)},this),d},_removeBasemap:function(){var a,b=this.basemapLayerIds;b&&b.length&&q.forEach(b,function(b){(a=this.getLayer(b))&&this.removeLayer(a)},this)},getBasemap:function(){return this._basemap||""},translate:function(a,b){if(a=a||
0,b=b||0,!this._txTimer){this._tx=this._ty=0;var c=this.toScreen(this.extent.getCenter());this.__panStart(c.x,c.y)}this._tx+=a;this._ty+=b;this.__pan(this._tx,this._ty);clearTimeout(this._txTimer);this._txTimer=setTimeout(this._endTranslate,150)},_endTranslate:function(){clearTimeout(this._txTimer);this._txTimer=null;var a=this._tx,b=this._ty;this._tx=this._ty=0;this.__panEnd(a,b)},setTimeExtent:function(a){a=(this.timeExtent=a)?new a.constructor(a.toJson()):null;this.onTimeExtentChange(a)},setTimeSlider:function(a){this.timeSlider&&
(M(this._tsTimeExtentChange_connect),this._tsTimeExtentChange_connect=null,this.timeSlider=null);a&&(this.timeSlider=a,this.setTimeExtent(a.getCurrentTimeExtent()),this._tsTimeExtentChange_connect=X(a,"onTimeExtentChange",this,"setTimeExtent"))},setVisibility:function(a){if(this.visible!==a){if(this.visible=a,a||(this._display=this.container.style.display),this.container.style.display=a?this._display:"none",this.autoResize){var b=a?"resume":"pause";this._rszSignal[b]();this._oriSignal[b]()}a&&this.resize()}return this},
resize:function(a){clearTimeout(this._resizeT);this._destroyed||(!0===a?this._execResize():this._resizeT=setTimeout(this._execResize,this.resizeDelay))},_timedResize:function(){this._resizeT||this._execResize()},_execResize:function(){clearTimeout(this._resizeT);this._resizeT=null;this.reposition();this._resize();this.autoResize&&this._startResizeTimer()},_resize:function(){var a=this.width,b=this.height,c=S.get(this.container,"display"),d=W.getContentBox(this.container);if(!("none"===c||0>=d.w||
0>=d.h||a===d.w&&b===d.h)){(c=this._zoomAnim||this._panAnim)&&(c.stop(),c._fire("onEnd",[c.node]));N(this.root,{width:(this.width=d.w)+"px",height:(this.height=d.h)+"px"});d=this.width;c=this.height;this.attribution&&this.attribution.domNode&&S.set(this.attribution.domNode,"maxWidth",Math.floor(d*this._mapParams.attributionWidth)+"px");this.__visibleRect.update(this.__visibleRect.x,this.__visibleRect.y,d,c);this.__visibleDelta.update(this.__visibleDelta.x,this.__visibleDelta.y,d,c);var e=new R(this.extent),
a=(new R(e.x,e.y,d/a*e.width,c/b*e.height,this.spatialReference)).getExtent();this.onResize(a,d,c);this._extentUtil(null,null,a,null,!0)}},reposition:function(){var a=this.position,b=a.x,c=a.y;this._reposition();a=this.position;b===a.x&&c===a.y||this.onReposition(a.x,a.y)},_reposition:function(){var a=W.position(this.container,!0),b=W.getPadBorderExtents(this.container);this.position.update(a.x+b.l,a.y+b.t)},_setClipRect:function(){delete this._clip;var a=7>=O("ie")||void 0===O("ie")&&7<=O("trident")?
"rect(auto,auto,auto,auto)":"auto";if(this.wrapAround180){var b=this.width,c=this.height,d=this._getFrameWidth(),e=b-d;0<e&&(a=e/2,a="rect(0px,"+(a+d)+"px,"+c+"px,"+a+"px)",c=this.extent.getWidth(),b=d/b*c,this._clip=[(c-b)/2,b])}N(this.__container,"clip",a)},_getAvailExtent:function(){var a=this.extent,b=this._clip;if(b){if(!a._clip){var c=new R(a);c.width=b[1];c.x+=b[0];a._clip=c.getExtent()}return a._clip}return a},_fixedPan:function(a,b){return this._extentUtil(null,{dx:a,dy:b})},panUp:function(){return this._fixedPan(0,
-.75*this.height)},panUpperRight:function(){return this._fixedPan(.75*this.width,-.75*this.height)},panRight:function(){return this._fixedPan(.75*this.width,0)},panLowerRight:function(){return this._fixedPan(.75*this.width,.75*this.height)},panDown:function(){return this._fixedPan(0,.75*this.height)},panLowerLeft:function(){return this._fixedPan(-.75*this.width,.75*this.height)},panLeft:function(){return this._fixedPan(-.75*this.width,0)},panUpperLeft:function(){return this._fixedPan(-.75*this.width,
-.75*this.height)},enableSnapping:function(a){if(a=a||{},"esri.SnappingManager"===a.declaredClass)this.snappingManager=a;else{var b=Y++,c=this;this._rids&&this._rids.push(b);K(["./SnappingManager"],function(d){var e=c._rids?q.indexOf(c._rids,b):-1;-1!==e&&(c._rids.splice(e,1),c.snappingManager=new d(F.mixin({map:c},a)))})}return this.snappingManager},disableSnapping:function(){this.snappingManager&&this.snappingManager.destroy();this.snappingManager=null},_createLabelLayer:function(){function a(){b._labels.removeAllFeatureLayers();
q.forEach(b.graphicsLayerIds,function(a){a=b.getLayer(a);"function"==typeof a.applyEdits&&b._labels.addFeatureLayer(a)})}var b=this;!this._labels&&ba&&this.loaded&&(this._labels=new ba({id:"_internal_LabelLayer"}),this._labels._setMap(this,this._gc._surface),a(),this.on("layers-reordered",a))},_getMapImageLyr:function(){return this.loaded&&!this._mapImageLyr&&(this._mapImageLyr=new Ca,this._mapImageLyr._setMap(this,this._layersDiv),this._placeMapImageLyr()),this._mapImageLyr},_placeMapImageLyr:function(){for(var a,
b,c=this.layerIds,d=this._layerDivs,e=!1,f=c.length-1;0<=f;f--){var g=c[f];if(b=this.getLayer(g),a=d[g],b&&a&&!b._isReference){I.place(this._mapImageLyr._div,a,"after");e=!0;break}}e||I.place(this._mapImageLyr._div,this._layersDiv,"first")}});return O("extend-esri")&&(sa._CoreMap=V),V});